<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilha de Precifica√ß√£o de Pizzas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab.active {
            background: #007bff;
            color: white;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active:hover {
            background: #0056b3;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-export {
            background: linear-gradient(45deg, #007bff, #0056b3);
            font-size: 18px;
            padding: 15px 30px;
        }

        .btn-export:hover {
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            background: #e7f3ff;
            color: #004085;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .export-section {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçï Planilha de Precifica√ß√£o de Pizzas</h1>
            <p>Sistema completo para delivery direto e iFood</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('custos-base')">Custos Base</button>
            <button class="tab" onclick="showTab('receitas')">Receitas das Pizzas</button>
            <button class="tab" onclick="showTab('operacionais')">Custos Operacionais</button>
            <button class="tab" onclick="showTab('delivery-direto')">Delivery Direto</button>
            <button class="tab" onclick="showTab('ifood')">iFood</button>
            <button class="tab" onclick="showTab('comparativo')">Comparativo</button>
            <button class="tab" onclick="showTab('exportar')">Exportar</button>
        </div>

        <!-- Aba Custos Base -->
        <div id="custos-base" class="tab-content active">
            <h2>üìã Custos Base dos Ingredientes</h2>
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label>Nome do Ingrediente:</label>
                        <input type="text" id="ingrediente-nome" placeholder="Ex: Mussarela">
                    </div>
                    <div>
                        <label>Unidade de Medida:</label>
                        <select id="ingrediente-unidade">
                            <option value="kg">Quilograma (kg)</option>
                            <option value="g">Gramas (g)</option>
                            <option value="l">Litros (l)</option>
                            <option value="ml">Mililitros (ml)</option>
                            <option value="unidade">Unidade</option>
                        </select>
                    </div>
                    <div>
                        <label>Pre√ßo por Unidade (R$):</label>
                        <input type="number" id="ingrediente-preco" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Rendimento por Pizza:</label>
                        <input type="number" id="ingrediente-rendimento" step="0.001" placeholder="Ex: 0.15">
                    </div>
                </div>
                <button class="btn" onclick="adicionarIngrediente()">‚ûï Adicionar Ingrediente</button>
            </div>
            
            <div class="table-container">
                <table id="tabela-ingredientes">
                    <thead>
                        <tr>
                            <th>Ingrediente</th>
                            <th>Unidade</th>
                            <th>Pre√ßo/Unidade</th>
                            <th>Rendimento/Pizza</th>
                            <th>Custo/Pizza</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Aba Receitas -->
        <div id="receitas" class="tab-content">
            <h2>üçï Receitas das Pizzas</h2>
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label>Nome da Pizza:</label>
                        <input type="text" id="pizza-nome" placeholder="Ex: Marguerita">
                    </div>
                    <div>
                        <label>Tamanho:</label>
                        <select id="pizza-tamanho">
                            <option value="Pequena">Pequena</option>
                            <option value="M√©dia">M√©dia</option>
                            <option value="Grande">Grande</option>
                            <option value="Fam√≠lia">Fam√≠lia</option>
                        </select>
                    </div>
                </div>
                
                <div id="ingredientes-pizza">
                    <h3>Ingredientes da Pizza</h3>
                    <div class="form-row">
                        <div>
                            <label>Ingrediente:</label>
                            <select id="select-ingrediente"></select>
                        </div>
                        <div>
                            <label>Quantidade:</label>
                            <input type="number" id="quantidade-ingrediente" step="0.001" placeholder="0.000">
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button class="btn" onclick="adicionarIngredientePizza()">‚ûï Adicionar</button>
                        </div>
                    </div>
                </div>
                
                <div id="lista-ingredientes-pizza"></div>
                
                <button class="btn" onclick="salvarPizza()">üíæ Salvar Pizza</button>
            </div>
            
            <div class="table-container">
                <table id="tabela-pizzas">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Tamanho</th>
                            <th>Ingredientes</th>
                            <th>Custo Total</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Aba Custos Operacionais -->
        <div id="operacionais" class="tab-content">
            <h2>üè™ Custos Operacionais Mensais</h2>
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label>Sal√°rios e Encargos (R$):</label>
                        <input type="number" id="custo-salarios" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Aluguel (R$):</label>
                        <input type="number" id="custo-aluguel" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Energia El√©trica (R$):</label>
                        <input type="number" id="custo-energia" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>G√°s (R$):</label>
                        <input type="number" id="custo-gas" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Telefone/Internet (R$):</label>
                        <input type="number" id="custo-telefone" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Marketing (R$):</label>
                        <input type="number" id="custo-marketing" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Manuten√ß√£o (R$):</label>
                        <input type="number" id="custo-manutencao" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Outros Custos (R$):</label>
                        <input type="number" id="custo-outros" step="0.01" placeholder="0.00">
                    </div>
                    <div>
                        <label>Pizzas Vendidas/M√™s:</label>
                        <input type="number" id="pizzas-mes" placeholder="Ex: 1000">
                    </div>
                    <div>
                        <label>Impostos (%):</label>
                        <input type="number" id="impostos" step="0.01" placeholder="Ex: 15.5">
                    </div>
                </div>
                <button class="btn" onclick="calcularCustosOperacionais()">üìä Calcular Custos</button>
            </div>
            
            <div class="summary-cards">
                <div class="card">
                    <h3>Custo Operacional Total</h3>
                    <div class="value" id="custo-total-mensal">R$ 0,00</div>
                </div>
                <div class="card">
                    <h3>Custo por Pizza</h3>
                    <div class="value" id="custo-por-pizza">R$ 0,00</div>
                </div>
            </div>
        </div>

        <!-- Aba Delivery Direto -->
        <div id="delivery-direto" class="tab-content">
            <h2>üõµ Precifica√ß√£o Delivery Direto</h2>
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label>Margem Desejada (%):</label>
                        <input type="number" id="margem-direto" step="0.01" placeholder="Ex: 150" value="150">
                    </div>
                    <div>
                        <label>Taxa de Entrega (R$):</label>
                        <input type="number" id="taxa-entrega" step="0.01" placeholder="Ex: 5.00" value="5.00">
                    </div>
                </div>
                <button class="btn" onclick="calcularPrecosDirecto()">üí∞ Calcular Pre√ßos</button>
            </div>
            
            <div class="table-container">
                <table id="tabela-direto">
                    <thead>
                        <tr>
                            <th>Pizza</th>
                            <th>Tamanho</th>
                            <th>Custo Total</th>
                            <th>Margem (%)</th>
                            <th>Pre√ßo Base</th>
                            <th>Taxa Entrega</th>
                            <th>Pre√ßo Final</th>
                            <th>Lucro</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Aba iFood -->
        <div id="ifood" class="tab-content">
            <h2>üì± Precifica√ß√£o iFood</h2>
            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label>Taxa iFood (%):</label>
                        <input type="number" id="taxa-ifood" step="0.01" placeholder="Ex: 27" value="27">
                    </div>
                    <div>
                        <label>Margem Desejada (%):</label>
                        <input type="number" id="margem-ifood" step="0.01" placeholder="Ex: 150" value="150">
                    </div>
                </div>
                <button class="btn" onclick="calcularPrecosIfood()">üí∞ Calcular Pre√ßos iFood</button>
            </div>
            
            <div class="table-container">
                <table id="tabela-ifood">
                    <thead>
                        <tr>
                            <th>Pizza</th>
                            <th>Tamanho</th>
                            <th>Custo Total</th>
                            <th>Taxa iFood (%)</th>
                            <th>Margem (%)</th>
                            <th>Pre√ßo iFood</th>
                            <th>Lucro L√≠quido</th>
                            <th>Margem Real (%)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Aba Comparativo -->
        <div id="comparativo" class="tab-content">
            <h2>üìä Comparativo de Canais</h2>
            <button class="btn" onclick="gerarComparativo()">üîÑ Atualizar Comparativo</button>
            
            <div class="table-container">
                <table id="tabela-comparativo">
                    <thead>
                        <tr>
                            <th>Pizza</th>
                            <th>Tamanho</th>
                            <th>Pre√ßo Direto</th>
                            <th>Pre√ßo iFood</th>
                            <th>Lucro Direto</th>
                            <th>Lucro iFood</th>
                            <th>Diferen√ßa</th>
                            <th>Melhor Canal</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Aba Exportar -->
        <div id="exportar" class="tab-content">
            <h2>üì§ Exportar para Google Sheets</h2>
            <div class="export-section">
                <div class="alert">
                    <strong>Como usar:</strong> Clique no bot√£o abaixo para baixar um arquivo Excel (.xlsx) com todas as suas planilhas organizadas. 
                    Depois, voc√™ pode importar este arquivo diretamente no Google Sheets.
                </div>
                
                <button class="btn btn-export" onclick="exportarPlanilha()">üìä Baixar Planilha Completa (.xlsx)</button>
                
                <div style="margin-top: 30px;">
                    <h3>üìã Passos para importar no Google Sheets:</h3>
                    <ol style="text-align: left; max-width: 600px; margin: 20px auto;">
                        <li>Acesse <strong>sheets.google.com</strong></li>
                        <li>Clique em <strong>"Arquivo" ‚Üí "Importar"</strong></li>
                        <li>Selecione <strong>"Upload"</strong> e escolha o arquivo baixado</li>
                        <li>Escolha <strong>"Substituir planilha"</strong> ou <strong>"Criar nova planilha"</strong></li>
                        <li>Clique em <strong>"Importar dados"</strong></li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados globais
        let ingredientes = [];
        let pizzas = [];
        let custosOperacionais = {
            salarios: 0,
            aluguel: 0,
            energia: 0,
            gas: 0,
            telefone: 0,
            marketing: 0,
            manutencao: 0,
            outros: 0,
            pizzasMes: 0,
            impostos: 0,
            custoTotal: 0,
            custoPorPizza: 0
        };
        let precosDirecto = [];
        let precosIfood = [];
        let ingredientesPizzaAtual = [];

        // Fun√ß√µes de navega√ß√£o
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Fun√ß√µes de ingredientes
        function adicionarIngrediente() {
            const nome = document.getElementById('ingrediente-nome').value;
            const unidade = document.getElementById('ingrediente-unidade').value;
            const preco = parseFloat(document.getElementById('ingrediente-preco').value);
            const rendimento = parseFloat(document.getElementById('ingrediente-rendimento').value);

            if (!nome || !preco || !rendimento) {
                alert('Preencha todos os campos!');
                return;
            }

            const custoPorPizza = preco * rendimento;
            
            const ingrediente = {
                id: Date.now(),
                nome,
                unidade,
                preco,
                rendimento,
                custoPorPizza
            };

            ingredientes.push(ingrediente);
            atualizarTabelaIngredientes();
            atualizarSelectIngredientes();
            limparFormularioIngrediente();
        }

        function atualizarTabelaIngredientes() {
            const tbody = document.querySelector('#tabela-ingredientes tbody');
            tbody.innerHTML = '';

            ingredientes.forEach(ing => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${ing.nome}</td>
                    <td>${ing.unidade}</td>
                    <td>R$ ${ing.preco.toFixed(2)}</td>
                    <td>${ing.rendimento.toFixed(3)}</td>
                    <td>R$ ${ing.custoPorPizza.toFixed(3)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="removerIngrediente(${ing.id})">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        function atualizarSelectIngredientes() {
            const select = document.getElementById('select-ingrediente');
            select.innerHTML = '<option value="">Selecione um ingrediente</option>';
            
            ingredientes.forEach(ing => {
                const option = document.createElement('option');
                option.value = ing.id;
                option.textContent = `${ing.nome} (${ing.unidade})`;
                select.appendChild(option);
            });
        }

        function limparFormularioIngrediente() {
            document.getElementById('ingrediente-nome').value = '';
            document.getElementById('ingrediente-preco').value = '';
            document.getElementById('ingrediente-rendimento').value = '';
        }

        function removerIngrediente(id) {
            ingredientes = ingredientes.filter(ing => ing.id !== id);
            atualizarTabelaIngredientes();
            atualizarSelectIngredientes();
        }

        // Fun√ß√µes de pizzas
        function adicionarIngredientePizza() {
            const ingredienteId = parseInt(document.getElementById('select-ingrediente').value);
            const quantidade = parseFloat(document.getElementById('quantidade-ingrediente').value);

            if (!ingredienteId || !quantidade) {
                alert('Selecione um ingrediente e informe a quantidade!');
                return;
            }

            const ingrediente = ingredientes.find(ing => ing.id === ingredienteId);
            if (!ingrediente) return;

            const ingredientePizza = {
                ingredienteId,
                nome: ingrediente.nome,
                quantidade,
                custoUnitario: ingrediente.preco,
                custoTotal: ingrediente.preco * quantidade
            };

            ingredientesPizzaAtual.push(ingredientePizza);
            atualizarListaIngredientesPizza();
            
            document.getElementById('select-ingrediente').value = '';
            document.getElementById('quantidade-ingrediente').value = '';
        }

        function atualizarListaIngredientesPizza() {
            const lista = document.getElementById('lista-ingredientes-pizza');
            lista.innerHTML = '<h4>Ingredientes Adicionados:</h4>';

            let custoTotal = 0;
            ingredientesPizzaAtual.forEach((ing, index) => {
                custoTotal += ing.custoTotal;
                const div = document.createElement('div');
                div.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 5px;';
                div.innerHTML = `
                    <span>${ing.nome}: ${ing.quantidade.toFixed(3)} - R$ ${ing.custoTotal.toFixed(3)}</span>
                    <button class="btn btn-danger" onclick="removerIngredientePizza(${index})">üóëÔ∏è</button>
                `;
                lista.appendChild(div);
            });

            const totalDiv = document.createElement('div');
            totalDiv.style.cssText = 'font-weight: bold; font-size: 1.2em; color: #28a745; margin-top: 10px;';
            totalDiv.innerHTML = `<strong>Custo Total: R$ ${custoTotal.toFixed(3)}</strong>`;
            lista.appendChild(totalDiv);
        }

        function removerIngredientePizza(index) {
            ingredientesPizzaAtual.splice(index, 1);
            atualizarListaIngredientesPizza();
        }

        function salvarPizza() {
            const nome = document.getElementById('pizza-nome').value;
            const tamanho = document.getElementById('pizza-tamanho').value;

            if (!nome || ingredientesPizzaAtual.length === 0) {
                alert('Preencha o nome da pizza e adicione pelo menos um ingrediente!');
                return;
            }

            const custoIngredientes = ingredientesPizzaAtual.reduce((total, ing) => total + ing.custoTotal, 0);
            const custoEmbalagem = 0.50; // Custo fixo da embalagem
            const custoTotal = custoIngredientes + custoEmbalagem + custosOperacionais.custoPorPizza;

            const pizza = {
                id: Date.now(),
                nome,
                tamanho,
                ingredientes: [...ingredientesPizzaAtual],
                custoIngredientes,
                custoEmbalagem,
                custoOperacional: custosOperacionais.custoPorPizza,
                custoTotal
            };

            pizzas.push(pizza);
            atualizarTabelaPizzas();
            limparFormularioPizza();
        }

        function atualizarTabelaPizzas() {
            const tbody = document.querySelector('#tabela-pizzas tbody');
            tbody.innerHTML = '';

            pizzas.forEach(pizza => {
                const row = tbody.insertRow();
                const ingredientesStr = pizza.ingredientes.map(ing => `${ing.nome} (${ing.quantidade.toFixed(3)})`).join(', ');
                row.innerHTML = `
                    <td>${pizza.nome}</td>
                    <td>${pizza.tamanho}</td>
                    <td>${ingredientesStr}</td>
                    <td>R$ ${pizza.custoTotal.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="removerPizza(${pizza.id})">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        function limparFormularioPizza() {
            document.getElementById('pizza-nome').value = '';
            ingredientesPizzaAtual = [];
            atualizarListaIngredientesPizza();
        }

        function removerPizza(id) {
            pizzas = pizzas.filter(pizza => pizza.id !== id);
            atualizarTabelaPizzas();
        }

        // Fun√ß√µes de custos operacionais
        function calcularCustosOperacionais() {
            custosOperacionais.salarios = parseFloat(document.getElementById('custo-salarios').value) || 0;
            custosOperacionais.aluguel = parseFloat(document.getElementById('custo-aluguel').value) || 0;
            custosOperacionais.energia = parseFloat(document.getElementById('custo-energia').value) || 0;
            custosOperacionais.gas = parseFloat(document.getElementById('custo-gas').value) || 0;
            custosOperacionais.telefone = parseFloat(document.getElementById('custo-telefone').value) || 0;
            custosOperacionais.marketing = parseFloat(document.getElementById('custo-marketing').value) || 0;
            custosOperacionais.manutencao = parseFloat(document.getElementById('custo-manutencao').value) || 0;
            custosOperacionais.outros = parseFloat(document.getElementById('custo-outros').value) || 0;
            custosOperacionais.pizzasMes = parseInt(document.getElementById('pizzas-mes').value) || 1;
            custosOperacionais.impostos = parseFloat(document.getElementById('impostos').value) || 0;

            custosOperacionais.custoTotal = custosOperacionais.salarios + custosOperacionais.aluguel + 
                custosOperacionais.energia + custosOperacionais.gas + custosOperacionais.telefone + 
                custosOperacionais.marketing + custosOperacionais.manutencao + custosOperacionais.outros;

            custosOperacionais.custoPorPizza = custosOperacionais.custoTotal / custosOperacionais.pizzasMes;

            document.getElementById('custo-total-mensal').textContent = `R$ ${custosOperacionais.custoTotal.toFixed(2)}`;
            document.getElementById('custo-por-pizza').textContent = `R$ ${custosOperacionais.custoPorPizza.toFixed(2)}`;

            // Atualizar custos das pizzas
            pizzas.forEach(pizza => {
                pizza.custoOperacional = custosOperacionais.custoPorPizza;
                pizza.custoTotal = pizza.custoIngredientes + pizza.custoEmbalagem + pizza.custoOperacional;
            });
            atualizarTabelaPizzas();
        }

        // Fun√ß√µes de precifica√ß√£o
        function calcularPrecosDirecto() {
            const margem = parseFloat(document.getElementById('margem-direto').value) || 150;
            const taxaEntrega = parseFloat(document.getElementById('taxa-entrega').value) || 5.00;

            precosDirecto = pizzas.map(pizza => {
                const margemDecimal = margem / 100;
                const precoBase = pizza.custoTotal * (1 + margemDecimal);
                const precoFinal = precoBase + taxaEntrega;
                const lucro = precoFinal - pizza.custoTotal;

                return {
                    pizza: pizza.nome,
                    tamanho: pizza.tamanho,
                    custoTotal: pizza.custoTotal,
                    margem: margem,
                    precoBase: precoBase,
                    taxaEntrega: taxaEntrega,
                    precoFinal: precoFinal,
                    lucro: lucro
                };
            });

            atualizarTabelaDirecto();
        }

        function atualizarTabelaDirecto() {
            const tbody = document.querySelector('#tabela-direto tbody');
            tbody.innerHTML = '';

            precosDirecto.forEach(item => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.pizza}</td>
                    <td>${item.tamanho}</td>
                    <td>R$ ${item.custoTotal.toFixed(2)}</td>
                    <td>${item.margem.toFixed(1)}%</td>
                    <td>R$ ${item.precoBase.toFixed(2)}</td>
                    <td>R$ ${item.taxaEntrega.toFixed(2)}</td>
                    <td>R$ ${item.precoFinal.toFixed(2)}</td>
                    <td>R$ ${item.lucro.toFixed(2)}</td>
                `;
            });
        }

        function calcularPrecosIfood() {
            const taxaIfood = parseFloat(document.getElementById('taxa-ifood').value) || 27;
            const margem = parseFloat(document.getElementById('margem-ifood').value) || 150;

            precosIfood = pizzas.map(pizza => {
                const taxaDecimal = taxaIfood / 100;
                const margemDecimal = margem / 100;
                
                // Pre√ßo = (Custo / (1 - Taxa)) * (1 + Margem)
                const precoIfood = (pizza.custoTotal / (1 - taxaDecimal)) * (1 + margemDecimal);
                const lucroLiquido = precoIfood - pizza.custoTotal - (precoIfood * taxaDecimal);
                const margemReal = (lucroLiquido / precoIfood) * 100;

                return {
                    pizza: pizza.nome,
                    tamanho: pizza.tamanho,
                    custoTotal: pizza.custoTotal,
                    taxaIfood: taxaIfood,
                    margem: margem,
                    precoIfood: precoIfood,
                    lucroLiquido: lucroLiquido,
                    margemReal: margemReal
                };
            });

            atualizarTabelaIfood();
        }

        function atualizarTabelaIfood() {
            const tbody = document.querySelector('#tabela-ifood tbody');
            tbody.innerHTML = '';

            precosIfood.forEach(item => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.pizza}</td>
                    <td>${item.tamanho}</td>
                    <td>R$ ${item.custoTotal.toFixed(2)}</td>
                    <td>${item.taxaIfood.toFixed(1)}%</td>
                    <td>${item.margem.toFixed(1)}%</td>
                    <td>R$ ${item.precoIfood.toFixed(2)}</td>
                    <td>R$ ${item.lucroLiquido.toFixed(2)}</td>
                    <td>${item.margemReal.toFixed(1)}%</td>
                `;
            });
        }

        function gerarComparativo() {
            const tbody = document.querySelector('#tabela-comparativo tbody');
            tbody.innerHTML = '';

            pizzas.forEach(pizza => {
                const precoDirectoItem = precosDirecto.find(p => p.pizza === pizza.nome && p.tamanho === pizza.tamanho);
                const precoIfoodItem = precosIfood.find(p => p.pizza === pizza.nome && p.tamanho === pizza.tamanho);

                if (precoDirectoItem && precoIfoodItem) {
                    const diferenca = precoDirectoItem.lucro - precoIfoodItem.lucroLiquido;
                    const melhorCanal = diferenca > 0 ? 'Delivery Direto' : 'iFood';

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${pizza.nome}</td>
                        <td>${pizza.tamanho}</td>
                        <td>R$ ${precoDirectoItem.precoFinal.toFixed(2)}</td>
                        <td>R$ ${precoIfoodItem.precoIfood.toFixed(2)}</td>
                        <td>R$ ${precoDirectoItem.lucro.toFixed(2)}</td>
                        <td>R$ ${precoIfoodItem.lucroLiquido.toFixed(2)}</td>
                        <td style="color: ${diferenca > 0 ? 'green' : 'red'}">R$ ${Math.abs(diferenca).toFixed(2)}</td>
                        <td style="font-weight: bold; color: ${diferenca > 0 ? 'green' : 'blue'}">${melhorCanal}</td>
                    `;
                }
            });
        }

        // Fun√ß√£o de exporta√ß√£o
        function exportarPlanilha() {
            const wb = XLSX.utils.book_new();

            // Aba 1: Custos Base
            const wsIngredientes = XLSX.utils.json_to_sheet(ingredientes.map(ing => ({
                'Ingrediente': ing.nome,
                'Unidade': ing.unidade,
                'Pre√ßo por Unidade': ing.preco,
                'Rendimento por Pizza': ing.rendimento,
                'Custo por Pizza': ing.custoPorPizza
            })));
            XLSX.utils.book_append_sheet(wb, wsIngredientes, 'Custos Base');

            // Aba 2: Receitas das Pizzas
            const wsPizzas = XLSX.utils.json_to_sheet(pizzas.map(pizza => ({
                'Nome': pizza.nome,
                'Tamanho': pizza.tamanho,
                'Ingredientes': pizza.ingredientes.map(ing => `${ing.nome} (${ing.quantidade.toFixed(3)})`).join(', '),
                'Custo Ingredientes': pizza.custoIngredientes,
                'Custo Embalagem': pizza.custoEmbalagem,
                'Custo Operacional': pizza.custoOperacional,
                'Custo Total': pizza.custoTotal
            })));
            XLSX.utils.book_append_sheet(wb, wsPizzas, 'Receitas das Pizzas');

            // Aba 3: Custos Operacionais
            const wsCustos = XLSX.utils.json_to_sheet([
                { 'Item': 'Sal√°rios e Encargos', 'Valor': custosOperacionais.salarios },
                { 'Item': 'Aluguel', 'Valor': custosOperacionais.aluguel },
                { 'Item': 'Energia El√©trica', 'Valor': custosOperacionais.energia },
                { 'Item': 'G√°s', 'Valor': custosOperacionais.gas },
                { 'Item': 'Telefone/Internet', 'Valor': custosOperacionais.telefone },
                { 'Item': 'Marketing', 'Valor': custosOperacionais.marketing },
                { 'Item': 'Manuten√ß√£o', 'Valor': custosOperacionais.manutencao },
                { 'Item': 'Outros', 'Valor': custosOperacionais.outros },
                { 'Item': 'Total Mensal', 'Valor': custosOperacionais.custoTotal },
                { 'Item': 'Pizzas por M√™s', 'Valor': custosOperacionais.pizzasMes },
                { 'Item': 'Custo por Pizza', 'Valor': custosOperacionais.custoPorPizza },
                { 'Item': 'Impostos (%)', 'Valor': custosOperacionais.impostos }
            ]);
            XLSX.utils.book_append_sheet(wb, wsCustos, 'Custos Operacionais');

            // Aba 4: Delivery Direto
            if (precosDirecto.length > 0) {
                const wsDirecto = XLSX.utils.json_to_sheet(precosDirecto.map(item => ({
                    'Pizza': item.pizza,
                    'Tamanho': item.tamanho,
                    'Custo Total': item.custoTotal,
                    'Margem (%)': item.margem,
                    'Pre√ßo Base': item.precoBase,
                    'Taxa Entrega': item.taxaEntrega,
                    'Pre√ßo Final': item.precoFinal,
                    'Lucro': item.lucro
                })));
                XLSX.utils.book_append_sheet(wb, wsDirecto, 'Delivery Direto');
            }

            // Aba 5: iFood
            if (precosIfood.length > 0) {
                const wsIfood = XLSX.utils.json_to_sheet(precosIfood.map(item => ({
                    'Pizza': item.pizza,
                    'Tamanho': item.tamanho,
                    'Custo Total': item.custoTotal,
                    'Taxa iFood (%)': item.taxaIfood,
                    'Margem (%)': item.margem,
                    'Pre√ßo iFood': item.precoIfood,
                    'Lucro L√≠quido': item.lucroLiquido,
                    'Margem Real (%)': item.margemReal
                })));
                XLSX.utils.book_append_sheet(wb, wsIfood, 'iFood');
            }

            // Gerar comparativo para exporta√ß√£o
            const comparativo = [];
            pizzas.forEach(pizza => {
                const precoDirectoItem = precosDirecto.find(p => p.pizza === pizza.nome && p.tamanho === pizza.tamanho);
                const precoIfoodItem = precosIfood.find(p => p.pizza === pizza.nome && p.tamanho === pizza.tamanho);

                if (precoDirectoItem && precoIfoodItem) {
                    const diferenca = precoDirectoItem.lucro - precoIfoodItem.lucroLiquido;
                    const melhorCanal = diferenca > 0 ? 'Delivery Direto' : 'iFood';

                    comparativo.push({
                        'Pizza': pizza.nome,
                        'Tamanho': pizza.tamanho,
                        'Pre√ßo Delivery Direto': precoDirectoItem.precoFinal,
                        'Pre√ßo iFood': precoIfoodItem.precoIfood,
                        'Lucro Delivery Direto': precoDirectoItem.lucro,
                        'Lucro iFood': precoIfoodItem.lucroLiquido,
                        'Diferen√ßa de Lucro': Math.abs(diferenca),
                        'Melhor Canal': melhorCanal
                    });
                }
            });

            if (comparativo.length > 0) {
                const wsComparativo = XLSX.utils.json_to_sheet(comparativo);
                XLSX.utils.book_append_sheet(wb, wsComparativo, 'Comparativo');
            }

            // Baixar arquivo
            XLSX.writeFile(wb, 'Planilha_Precificacao_Pizzas.xlsx');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar alguns ingredientes exemplo
            const ingredientesExemplo = [
                { nome: 'Massa', unidade: 'kg', preco: 8.00, rendimento: 0.15 },
                { nome: 'Molho de Tomate', unidade: 'kg', preco: 4.50, rendimento: 0.08 },
                { nome: 'Queijo Mussarela', unidade: 'kg', preco: 28.00, rendimento: 0.12 },
                { nome: 'Embalagem', unidade: 'unidade', preco: 0.50, rendimento: 1 }
            ];

            ingredientesExemplo.forEach(ing => {
                ingredientes.push({
                    id: Date.now() + Math.random(),
                    nome: ing.nome,
                    unidade: ing.unidade,
                    preco: ing.preco,
                    rendimento: ing.rendimento,
                    custoPorPizza: ing.preco * ing.rendimento
                });
            });

            atualizarTabelaIngredientes();
            atualizarSelectIngredientes();
        });
    </script>
</body>
</html>