<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzaria Pro - Sistema de Gest√£o Completo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* SIDEBAR LATERAL */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h1 {
            font-size: 1.4em;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .sidebar-header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-section {
            margin-bottom: 30px;
        }

        .menu-section-title {
            padding: 0 20px 10px 20px;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            font-weight: 600;
        }

        .menu-item {
            display: block;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            position: relative;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            padding-left: 25px;
        }

        .menu-item.active {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-left: 4px solid #fff;
        }

        .menu-item .badge {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.7em;
            float: right;
            margin-top: 2px;
        }

        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 0;
            transition: margin-left 0.3s ease;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1em;
        }

        .content {
            padding: 30px;
            background: #f8f9fa;
            min-height: calc(100vh - 80px);
        }

        /* CARDS E COMPONENTES */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .card-header h3 {
            font-size: 1.3em;
            color: #2c3e50;
            margin-left: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid;
        }

        .stat-card.green { border-left-color: #27ae60; }
        .stat-card.blue { border-left-color: #3498db; }
        .stat-card.orange { border-left-color: #f39c12; }
        .stat-card.red { border-left-color: #e74c3c; }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* FORMUL√ÅRIOS */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* BOT√ïES */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        /* TABELAS */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        /* MODAIS */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .modal-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #7f8c8d;
            padding: 5px;
        }

        .modal-close:hover {
            color: #e74c3c;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e1e8ed;
        }

        /* TOASTS */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            max-width: 400px;
        }

        .toast {
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid;
            animation: toastSlideIn 0.3s ease;
            position: relative;
        }

        .toast.success { border-left-color: #27ae60; }
        .toast.error { border-left-color: #e74c3c; }
        .toast.warning { border-left-color: #f39c12; }
        .toast.info { border-left-color: #3498db; }

        @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast-close {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: #7f8c8d;
        }

        /* EMPTY STATES */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .empty-state p {
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        /* RESPONSIVO */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        /* TABS CONTENT */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* FILTROS */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            font-size: 0.9em;
            font-weight: 600;
            color: #2c3e50;
        }

        /* GRID LAYOUTS */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .grid-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px; }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        /* UTILITIES */
        .mb-10 { margin-bottom: 10px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .mt-20 { margin-top: 20px; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: bold; }
        .text-success { color: #27ae60; }
        .text-danger { color: #e74c3c; }
        .text-warning { color: #f39c12; }
        .text-info { color: #3498db; }

        /* LOADING */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üçï Pizzaria Pro</h1>
                <p>Sistema de Gest√£o Completo</p>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">üìä DASHBOARD</div>
                    <button class="menu-item active" onclick="showSection('dashboard')">
                        üìà Vis√£o Geral
                        <span class="badge">1</span>
                    </button>
                </div>

                <div class="menu-section">
                    <div class="menu-section-title">üçï PRODUTOS</div>
                    <button class="menu-item" onclick="showSection('ingredientes')">
                        ü•¨ Ingredientes
                        <span class="badge">2</span>
                    </button>
                    <button class="menu-item" onclick="showSection('receitas')">
                        üìù Receitas
                        <span class="badge">3</span>
                    </button>
                    <button class="menu-item" onclick="showSection('cardapio')">
                        üìã Card√°pio
                        <span class="badge">4</span>
                    </button>
                </div>

                <div class="menu-section">
                    <div class="menu-section-title">üì¶ ESTOQUE</div>
                    <button class="menu-item" onclick="showSection('estoque')">
                        üì¶ Controle de Estoque
                        <span class="badge">5</span>
                    </button>
                    <button class="menu-item" onclick="showSection('compras')">
                        üõí Compras
                        <span class="badge">6</span>
                    </button>
                </div>

                <div class="menu-section">
                    <div class="menu-section-title">üí∞ VENDAS</div>
                    <button class="menu-item" onclick="showSection('vendas')">
                        üí≥ Registrar Vendas
                        <span class="badge">7</span>
                    </button>
                    <button class="menu-item" onclick="showSection('resultados')">
                        üìä Resultados Di√°rios
                        <span class="badge">8</span>
                    </button>
                    <button class="menu-item" onclick="showSection('custos')">
                        üí∞ Custos Operacionais
                        <span class="badge">9</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- DASHBOARD TAB -->
            <div id="dashboard" class="tab-content active">
                <div class="header">
                    <h2>üìä Dashboard - Vis√£o Geral</h2>
                    <p>Monitore os indicadores-chave da sua opera√ß√£o</p>
                </div>
                
                <div class="content">
                    <div class="stats-grid">
                        <div class="stat-card green">
                            <div class="stat-number" id="vendas-hoje">0</div>
                            <div class="stat-label">VENDAS HOJE</div>
                        </div>
                        <div class="stat-card blue">
                            <div class="stat-number" id="faturamento-hoje">R$ 0,00</div>
                            <div class="stat-label">FATURAMENTO HOJE</div>
                        </div>
                        <div class="stat-card orange">
                            <div class="stat-number" id="ticket-medio">R$ 0,00</div>
                            <div class="stat-label">TICKET M√âDIO</div>
                        </div>
                        <div class="stat-card red">
                            <div class="stat-number" id="margem-media">0%</div>
                            <div class="stat-label">MARGEM M√âDIA</div>
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <span style="font-size: 1.5em;">üìä</span>
                                <h3>Vendas Recentes</h3>
                                <button class="btn btn-primary" style="margin-left: auto;" onclick="showSection('vendas')">Nova Venda</button>
                            </div>
                            <div class="empty-state">
                                <div class="empty-icon">üõí</div>
                                <h3>Nenhuma venda registrada</h3>
                                <p>Comece registrando sua primeira venda.</p>
                                <button class="btn btn-primary" onclick="showSection('vendas')">Registrar Primeira Venda</button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <span style="font-size: 1.5em;">üì¶</span>
                                <h3>Status do Estoque</h3>
                                <button class="btn btn-success" style="margin-left: auto;" onclick="showSection('estoque')">Ver Estoque</button>
                            </div>
                            <div class="empty-state">
                                <div class="empty-icon">üì¶</div>
                                <h3>Estoque n√£o configurado</h3>
                                <p>Configure seus ingredientes primeiro.</p>
                                <button class="btn btn-success" onclick="showSection('ingredientes')">Configurar Ingredientes</button>
                            </div>
                        </div>
                    </div>

                    <div id="dashboard-ingredientes" class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">ü•¨</span>
                            <h3>Ingredientes</h3>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">ü•¨</div>
                            <h3>Nenhum ingrediente cadastrado</h3>
                            <p>Comece adicionando seus primeiros ingredientes ao sistema.</p>
                        </div>
                    </div>

                    <div id="dashboard-receitas" class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">üìù</span>
                            <h3>Receitas</h3>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">üìù</div>
                            <h3>Nenhuma receita cadastrada</h3>
                            <p>Comece criando suas primeiras receitas de pizza.</p>
                        </div>
                    </div>

                    <div id="dashboard-cardapio" class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">üìã</span>
                            <h3>Card√°pio</h3>
                        </div>
                        <div class="grid-2 mb-20">
                            <div class="card" style="margin: 0;">
                                <h4>üöö Delivery Direto</h4>
                                <p><strong>Margem:</strong> <span id="config-margem-direto">150</span>%</p>
                                <p><strong>Taxa Entrega:</strong> R$ <span id="config-taxa-entrega">5,00</span></p>
                            </div>
                            <div class="card" style="margin: 0;">
                                <h4>üçï iFood</h4>
                                <p><strong>Margem L√≠quida:</strong> <span id="config-margem-ifood">49</span>%</p>
                                <p><strong>Taxa iFood:</strong> <span id="config-taxa-ifood">27</span>%</p>
                            </div>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <h3>Nenhuma receita no card√°pio</h3>
                            <p>Crie receitas primeiro para gerar o card√°pio automaticamente.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INGREDIENTES TAB -->
            <div id="ingredientes" class="tab-content">
                <div class="header">
                    <h2>ü•¨ Ingredientes</h2>
                    <p>Gerencie todos os ingredientes da sua pizzaria</p>
                </div>
                
                <div class="content">
                    <div class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">ü•¨</span>
                            <h3>Gerenciar Ingredientes</h3>
                            <button class="btn btn-primary" style="margin-left: auto;" onclick="showNovoIngredienteModal()">‚ûï Novo Ingrediente</button>
                        </div>

                        <div class="filters">
                            <div class="filter-group">
                                <label class="filter-label">Buscar</label>
                                <input type="text" class="form-control" placeholder="Buscar ingredientes..." id="buscar-ingredientes" onkeyup="filtrarIngredientes()">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Categoria</label>
                                <select class="form-control" id="filtro-categoria-ingredientes" onchange="filtrarIngredientes()">
                                    <option value="">Todas as categorias</option>
                                    <option value="queijos">Queijos</option>
                                    <option value="carnes">Carnes</option>
                                    <option value="vegetais">Vegetais</option>
                                    <option value="molhos">Molhos</option>
                                    <option value="massas">Massas</option>
                                    <option value="temperos">Temperos</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Ordenar por</label>
                                <select class="form-control" id="ordenar-ingredientes" onchange="filtrarIngredientes()">
                                    <option value="nome">Nome</option>
                                    <option value="categoria">Categoria</option>
                                    <option value="preco">Pre√ßo</option>
                                </select>
                            </div>
                        </div>

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Categoria</th>
                                        <th>Unidade</th>
                                        <th>Pre√ßo</th>
                                        <th>Fornecedor</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="ingredientes-list">
                                    <!-- Ingredientes ser√£o carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RECEITAS TAB -->
            <div id="receitas" class="tab-content">
                <div class="header">
                    <h2>üìù Receitas</h2>
                    <p>Crie e gerencie as receitas das suas pizzas</p>
                </div>
                
                <div class="content">
                    <div class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">üìù</span>
                            <h3>Gerenciar Receitas</h3>
                            <button class="btn btn-primary" style="margin-left: auto;" onclick="showNovaReceitaModal()">‚ûï Nova Receita</button>
                        </div>

                        <div class="filters">
                            <div class="filter-group">
                                <label class="filter-label">Buscar</label>
                                <input type="text" class="form-control" placeholder="Buscar receitas..." id="buscar-receitas" onkeyup="filtrarReceitas()">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Categoria</label>
                                <select class="form-control" id="filtro-categoria-receitas" onchange="filtrarReceitas()">
                                    <option value="">Todas as categorias</option>
                                    <option value="tradicional">Tradicional</option>
                                    <option value="gourmet">Gourmet</option>
                                    <option value="doce">Doce</option>
                                    <option value="vegana">Vegana</option>
                                    <option value="especial">Especial</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Status</label>
                                <select class="form-control" id="filtro-status-receitas" onchange="filtrarReceitas()">
                                    <option value="">Todos os status</option>
                                    <option value="ativa">Ativas</option>
                                    <option value="inativa">Inativas</option>
                                </select>
                            </div>
                        </div>

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Categoria</th>
                                        <th>Tamanhos</th>
                                        <th>Custo M√©dio</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="receitas-list">
                                    <!-- Receitas ser√£o carregadas aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CARD√ÅPIO TAB -->
            <div id="cardapio" class="tab-content">
                <div class="header">
                    <h2>üìã Card√°pio</h2>
                    <p>Visualize pre√ßos e configure margens por canal de venda</p>
                </div>
                
                <div class="content">
                    <div class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">üìã</span>
                            <h3>Card√°pio com Precifica√ß√£o</h3>
                            <button class="btn btn-warning" style="margin-left: auto;" onclick="showConfiguracoesModal()">‚öôÔ∏è Configurar Margens</button>
                        </div>

                        <div class="filters">
                            <div class="filter-group">
                                <label class="filter-label">Buscar</label>
                                <input type="text" class="form-control" placeholder="Buscar no card√°pio..." id="buscar-cardapio" onkeyup="filtrarCardapio()">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Categoria</label>
                                <select class="form-control" id="filtro-categoria-cardapio" onchange="filtrarCardapio()">
                                    <option value="">Todas as categorias</option>
                                    <option value="tradicional">Tradicional</option>
                                    <option value="gourmet">Gourmet</option>
                                    <option value="doce">Doce</option>
                                    <option value="vegana">Vegana</option>
                                    <option value="especial">Especial</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Ordenar por</label>
                                <select class="form-control" id="ordenar-cardapio" onchange="filtrarCardapio()">
                                    <option value="nome">Nome</option>
                                    <option value="categoria">Categoria</option>
                                    <option value="custo">Custo</option>
                                    <option value="preco-direto">Pre√ßo Direto</option>
                                    <option value="preco-ifood">Pre√ßo iFood</option>
                                </select>
                            </div>
                        </div>

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Pizza</th>
                                        <th>Categoria</th>
                                        <th>Tamanho</th>
                                        <th>Custo</th>
                                        <th>Pre√ßo Direto</th>
                                        <th>Pre√ßo iFood</th>
                                        <th>Margem Direto</th>
                                        <th>Margem iFood</th>
                                        <th>Melhor Canal</th>
                                    </tr>
                                </thead>
                                <tbody id="cardapio-list">
                                    <!-- Card√°pio ser√° carregado aqui -->
                                </tbody>
                            </table>
                        </div>

                        <div id="cardapio-resumo" class="mt-20">
                            <!-- Resumo ser√° carregado aqui -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ESTOQUE TAB -->
            <div id="estoque" class="tab-content">
                <div class="header">
                    <h2>üì¶ Controle de Estoque</h2>
                    <p>Monitore e gerencie seu estoque de ingredientes</p>
                </div>
                
                <div class="content">
                    <div class="empty-state">
                        <div class="empty-icon">üì¶</div>
                        <h3>M√≥dulo de Estoque</h3>
                        <p>Em desenvolvimento...</p>
                    </div>
                </div>
            </div>

            <!-- COMPRAS TAB -->
            <div id="compras" class="tab-content">
                <div class="header">
                    <h2>üõí Compras</h2>
                    <p>Gerencie compras e fornecedores</p>
                </div>
                
                <div class="content">
                    <div class="empty-state">
                        <div class="empty-icon">üõí</div>
                        <h3>M√≥dulo de Compras</h3>
                        <p>Em desenvolvimento...</p>
                    </div>
                </div>
            </div>

            <!-- VENDAS TAB -->
            <div id="vendas" class="tab-content">
                <div class="header">
                    <h2>üí≥ Registrar Vendas</h2>
                    <p>Registre vendas e acompanhe a performance</p>
                </div>
                
                <div class="content">
                    <div class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">üí≥</span>
                            <h3>Registrar Vendas</h3>
                            <button class="btn btn-primary" style="margin-left: auto;" onclick="showNovaVendaModal()">‚ûï Nova Venda</button>
                        </div>

                        <div class="filters">
                            <div class="filter-group">
                                <label class="filter-label">Buscar</label>
                                <input type="text" class="form-control" placeholder="Buscar vendas..." id="buscar-vendas" onkeyup="filtrarVendas()">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Canal</label>
                                <select class="form-control" id="filtro-canal-vendas" onchange="filtrarVendas()">
                                    <option value="">Todos os canais</option>
                                    <option value="direto">Delivery Direto</option>
                                    <option value="ifood">iFood</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Data</label>
                                <input type="date" class="form-control" id="filtro-data-vendas" onchange="filtrarVendas()">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Ordenar por</label>
                                <select class="form-control" id="ordenar-vendas" onchange="filtrarVendas()">
                                    <option value="data-desc">Mais recentes</option>
                                    <option value="data-asc">Mais antigas</option>
                                    <option value="valor-desc">Maior valor</option>
                                    <option value="valor-asc">Menor valor</option>
                                </select>
                            </div>
                        </div>

                        <div class="stats-grid mb-30">
                            <div class="stat-card green">
                                <div class="stat-number" id="vendas-hoje-count">0</div>
                                <div class="stat-label">VENDAS HOJE</div>
                            </div>
                            <div class="stat-card blue">
                                <div class="stat-number" id="vendas-direto-total">R$ 0,00</div>
                                <div class="stat-label">DIRETO HOJE</div>
                            </div>
                            <div class="stat-card orange">
                                <div class="stat-number" id="vendas-ifood-total">R$ 0,00</div>
                                <div class="stat-label">IFOOD HOJE</div>
                            </div>
                        </div>

                        <div class="table-container" id="vendas-table-container">
                            <div class="empty-state">
                                <div class="empty-icon">üí≥</div>
                                <h3>Nenhuma venda registrada</h3>
                                <p>Comece registrando sua primeira venda do dia.</p>
                                <button class="btn btn-primary" onclick="showNovaVendaModal()">Registrar Primeira Venda</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RESULTADOS TAB -->
            <div id="resultados" class="tab-content">
                <div class="header">
                    <h2>üìä Resultados Di√°rios</h2>
                    <p>An√°lise detalhada de performance e resultados</p>
                </div>
                
                <div class="content">
                    <div class="card">
                        <div class="card-header">
                            <span style="font-size: 1.5em;">üìä</span>
                            <h3>Relat√≥rios e An√°lises</h3>
                        </div>

                        <div class="filters">
                            <div class="filter-group">
                                <label class="filter-label">Data Inicial</label>
                                <input type="date" class="form-control" id="data-inicial-relatorio">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Data Final</label>
                                <input type="date" class="form-control" id="data-final-relatorio">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Per√≠odo</label>
                                <select class="form-control" id="periodo-relatorio" onchange="aplicarPeriodoRelatorio()">
                                    <option value="hoje">Hoje</option>
                                    <option value="ontem">Ontem</option>
                                    <option value="semana">Esta Semana</option>
                                    <option value="mes">Este M√™s</option>
                                    <option value="personalizado">Personalizado</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">&nbsp;</label>
                                <button class="btn btn-primary" onclick="gerarRelatorio()">üìä Gerar Relat√≥rio</button>
                            </div>
                        </div>

                        <div id="relatorio-content">
                            <div class="empty-state">
                                <div class="empty-icon">üìä</div>
                                <h3>Nenhuma venda no per√≠odo selecionado</h3>
                                <p>Selecione um per√≠odo e gere o relat√≥rio.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CUSTOS TAB -->
            <div id="custos" class="tab-content">
                <div class="header">
                    <h2>üí∞ Custos Operacionais</h2>
                    <p>Gerencie custos fixos e vari√°veis da opera√ß√£o</p>
                </div>
                
                <div class="content">
                    <div class="empty-state">
                        <div class="empty-icon">üí∞</div>
                        <h3>M√≥dulo de Custos</h3>
                        <p>Em desenvolvimento...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAIS -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Modal</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Conte√∫do do modal -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <!-- Bot√µes do modal -->
            </div>
        </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toast-container">
        <!-- Toasts ser√£o adicionados aqui -->
    </div>

    <script>
        // ========================================
        // VARI√ÅVEIS GLOBAIS
        // ========================================
        let ingredientes = [];
        let receitas = [];
        let vendas = [];
        let estoque = {};
        let configuracoes = {
            margemDireto: 150,
            taxaEntrega: 5.00,
            margemIFood: 49,
            taxaIFood: 27
        };

        // ========================================
        // UTILIT√ÅRIOS
        // ========================================
        function generateId() {
            return Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value || 0);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('pt-BR');
        }

        function getCurrentDate() {
            return new Date().toISOString().split('T')[0];
        }

        // ========================================
        // STORAGE
        // ========================================
        const storage = {
            save: function(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (e) {
                    console.error('Erro ao salvar no localStorage:', e);
                }
            },
            load: function(key, defaultValue = null) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (e) {
                    console.error('Erro ao carregar do localStorage:', e);
                    return defaultValue;
                }
            },
            remove: function(key) {
                try {
                    localStorage.removeItem(key);
                } catch (e) {
                    console.error('Erro ao remover do localStorage:', e);
                }
            }
        };

        // ========================================
        // TOAST SYSTEM
        // ========================================
        const toast = {
            show: function(message, type = 'info', duration = 5000) {
                const container = document.getElementById('toast-container');
                const toastEl = document.createElement('div');
                toastEl.className = `toast ${type}`;
                toastEl.innerHTML = `
                    ${message}
                    <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
                `;
                
                container.appendChild(toastEl);
                
                setTimeout(() => {
                    if (toastEl.parentElement) {
                        toastEl.remove();
                    }
                }, duration);
            },
            success: function(message) {
                this.show(message, 'success');
            },
            error: function(message) {
                this.show(message, 'error');
            },
            warning: function(message) {
                this.show(message, 'warning');
            },
            info: function(message) {
                this.show(message, 'info');
            }
        };

        // ========================================
        // MODAL SYSTEM
        // ========================================
        const modal = {
            show: function(title, content, footer = '') {
                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-body').innerHTML = content;
                document.getElementById('modal-footer').innerHTML = footer;
                document.getElementById('modal').classList.add('show');
            },
            hide: function() {
                document.getElementById('modal').classList.remove('show');
            },
            confirm: function(message, onConfirm, confirmText = 'Confirmar', cancelText = 'Cancelar') {
                const footer = `
                    <button class="btn btn-secondary" onclick="modal.hide()">${cancelText}</button>
                    <button class="btn btn-primary" onclick="modal.hide(); (${onConfirm})()">${confirmText}</button>
                `;
                this.show('Confirma√ß√£o', `<p>${message}</p>`, footer);
            }
        };

        function closeModal() {
            modal.hide();
        }

        // ========================================
        // NAVEGA√á√ÉO
        // ========================================
        function showSection(sectionId) {
            // Remove active class from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked menu item
            event.target.classList.add('active');
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(sectionId).classList.add('active');
            
            // Load section data if needed
            switch(sectionId) {
                case 'ingredientes':
                    loadIngredientes();
                    break;
                case 'receitas':
                    loadReceitas();
                    break;
                case 'cardapio':
                    loadCardapio();
                    break;
                case 'vendas':
                    loadVendas();
                    break;
                case 'resultados':
                    loadResultados();
                    break;
                case 'dashboard':
                    loadDashboard();
                    break;
            }
        }

        // ========================================
        // INGREDIENTES
        // ========================================
        function loadIngredientes() {
            const tbody = document.getElementById('ingredientes-list');
            
            if (ingredientes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="empty-state">
                                <div class="empty-icon">ü•¨</div>
                                <h3>Nenhum ingrediente cadastrado</h3>
                                <p>Comece adicionando seus primeiros ingredientes.</p>
                                <button class="btn btn-primary" onclick="showNovoIngredienteModal()">‚ûï Adicionar Ingrediente</button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = ingredientes.map(ingrediente => `
                <tr>
                    <td><strong>${ingrediente.nome}</strong></td>
                    <td>${ingrediente.categoria}</td>
                    <td>${ingrediente.unidade}</td>
                    <td>${formatCurrency(ingrediente.preco)}</td>
                    <td>${ingrediente.fornecedor || '-'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editarIngrediente('${ingrediente.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="excluirIngrediente('${ingrediente.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
            
            // Update dashboard
            updateDashboardIngredientes();
        }

        function showNovoIngredienteModal() {
            const formHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome *</label>
                        <input type="text" class="form-control" id="ingrediente-nome" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select class="form-control" id="ingrediente-categoria" required>
                            <option value="">Selecione a categoria</option>
                            <option value="queijos">Queijos</option>
                            <option value="carnes">Carnes</option>
                            <option value="vegetais">Vegetais</option>
                            <option value="molhos">Molhos</option>
                            <option value="massas">Massas</option>
                            <option value="temperos">Temperos</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unidade *</label>
                        <select class="form-control" id="ingrediente-unidade" required>
                            <option value="">Selecione a unidade</option>
                            <option value="kg">Quilograma (kg)</option>
                            <option value="g">Grama (g)</option>
                            <option value="l">Litro (l)</option>
                            <option value="ml">Mililitro (ml)</option>
                            <option value="un">Unidade (un)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pre√ßo (R$) *</label>
                        <input type="number" class="form-control" id="ingrediente-preco" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Fornecedor</label>
                    <input type="text" class="form-control" id="ingrediente-fornecedor">
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarIngrediente()">Salvar</button>
            `;
            
            modal.show('Novo Ingrediente', formHTML, footer);
        }

        function salvarIngrediente() {
            const nome = document.getElementById('ingrediente-nome').value.trim();
            const categoria = document.getElementById('ingrediente-categoria').value;
            const unidade = document.getElementById('ingrediente-unidade').value;
            const preco = parseFloat(document.getElementById('ingrediente-preco').value);
            const fornecedor = document.getElementById('ingrediente-fornecedor').value.trim();
            
            if (!nome || !categoria || !unidade || !preco) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            const ingrediente = {
                id: generateId(),
                nome,
                categoria,
                unidade,
                preco,
                fornecedor,
                createdAt: new Date().toISOString()
            };
            
            ingredientes.push(ingrediente);
            storage.save('ingredientes', ingredientes);
            
            modal.hide();
            toast.success('Ingrediente adicionado com sucesso!');
            loadIngredientes();
        }

        function editarIngrediente(id) {
            const ingrediente = ingredientes.find(i => i.id === id);
            if (!ingrediente) return;
            
            const formHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome *</label>
                        <input type="text" class="form-control" id="ingrediente-nome" value="${ingrediente.nome}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select class="form-control" id="ingrediente-categoria" required>
                            <option value="">Selecione a categoria</option>
                            <option value="queijos" ${ingrediente.categoria === 'queijos' ? 'selected' : ''}>Queijos</option>
                            <option value="carnes" ${ingrediente.categoria === 'carnes' ? 'selected' : ''}>Carnes</option>
                            <option value="vegetais" ${ingrediente.categoria === 'vegetais' ? 'selected' : ''}>Vegetais</option>
                            <option value="molhos" ${ingrediente.categoria === 'molhos' ? 'selected' : ''}>Molhos</option>
                            <option value="massas" ${ingrediente.categoria === 'massas' ? 'selected' : ''}>Massas</option>
                            <option value="temperos" ${ingrediente.categoria === 'temperos' ? 'selected' : ''}>Temperos</option>
                            <option value="outros" ${ingrediente.categoria === 'outros' ? 'selected' : ''}>Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unidade *</label>
                        <select class="form-control" id="ingrediente-unidade" required>
                            <option value="">Selecione a unidade</option>
                            <option value="kg" ${ingrediente.unidade === 'kg' ? 'selected' : ''}>Quilograma (kg)</option>
                            <option value="g" ${ingrediente.unidade === 'g' ? 'selected' : ''}>Grama (g)</option>
                            <option value="l" ${ingrediente.unidade === 'l' ? 'selected' : ''}>Litro (l)</option>
                            <option value="ml" ${ingrediente.unidade === 'ml' ? 'selected' : ''}>Mililitro (ml)</option>
                            <option value="un" ${ingrediente.unidade === 'un' ? 'selected' : ''}>Unidade (un)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pre√ßo (R$) *</label>
                        <input type="number" class="form-control" id="ingrediente-preco" value="${ingrediente.preco}" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Fornecedor</label>
                    <input type="text" class="form-control" id="ingrediente-fornecedor" value="${ingrediente.fornecedor || ''}">
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Cancelar</button>
                <button class="btn btn-primary" onclick="atualizarIngrediente('${id}')">Atualizar</button>
            `;
            
            modal.show('Editar Ingrediente', formHTML, footer);
        }

        function atualizarIngrediente(id) {
            const nome = document.getElementById('ingrediente-nome').value.trim();
            const categoria = document.getElementById('ingrediente-categoria').value;
            const unidade = document.getElementById('ingrediente-unidade').value;
            const preco = parseFloat(document.getElementById('ingrediente-preco').value);
            const fornecedor = document.getElementById('ingrediente-fornecedor').value.trim();
            
            if (!nome || !categoria || !unidade || !preco) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            const index = ingredientes.findIndex(i => i.id === id);
            if (index !== -1) {
                ingredientes[index] = {
                    ...ingredientes[index],
                    nome,
                    categoria,
                    unidade,
                    preco,
                    fornecedor,
                    updatedAt: new Date().toISOString()
                };
                
                storage.save('ingredientes', ingredientes);
                modal.hide();
                toast.success('Ingrediente atualizado com sucesso!');
                loadIngredientes();
                
                // Recalcular custos das receitas que usam este ingrediente
                receitas.forEach(receita => {
                    if (receita.ingredientes.some(ing => ing.ingredienteId === id)) {
                        calcularCustosReceita(receita);
                    }
                });
                storage.save('receitas', receitas);
            }
        }

        function excluirIngrediente(id) {
            modal.confirm(
                'Tem certeza que deseja excluir este ingrediente? Esta a√ß√£o n√£o pode ser desfeita.',
                function() {
                    const index = ingredientes.findIndex(i => i.id === id);
                    if (index !== -1) {
                        ingredientes.splice(index, 1);
                        storage.save('ingredientes', ingredientes);
                        toast.success('Ingrediente exclu√≠do com sucesso!');
                        loadIngredientes();
                    }
                },
                'Excluir',
                'Cancelar'
            );
        }

        function filtrarIngredientes() {
            const busca = document.getElementById('buscar-ingredientes').value.toLowerCase();
            const categoria = document.getElementById('filtro-categoria-ingredientes').value;
            const ordenacao = document.getElementById('ordenar-ingredientes').value;
            
            let ingredientesFiltrados = ingredientes.filter(ingrediente => {
                const matchBusca = ingrediente.nome.toLowerCase().includes(busca) ||
                                 ingrediente.fornecedor?.toLowerCase().includes(busca);
                const matchCategoria = !categoria || ingrediente.categoria === categoria;
                
                return matchBusca && matchCategoria;
            });
            
            // Ordena√ß√£o
            ingredientesFiltrados.sort((a, b) => {
                switch(ordenacao) {
                    case 'nome':
                        return a.nome.localeCompare(b.nome);
                    case 'categoria':
                        return a.categoria.localeCompare(b.categoria);
                    case 'preco':
                        return a.preco - b.preco;
                    default:
                        return 0;
                }
            });
            
            // Renderizar lista filtrada
            const tbody = document.getElementById('ingredientes-list');
            if (ingredientesFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="empty-state">
                                <div class="empty-icon">üîç</div>
                                <h3>Nenhum ingrediente encontrado</h3>
                                <p>Tente ajustar os filtros de busca.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = ingredientesFiltrados.map(ingrediente => `
                <tr>
                    <td><strong>${ingrediente.nome}</strong></td>
                    <td>${ingrediente.categoria}</td>
                    <td>${ingrediente.unidade}</td>
                    <td>${formatCurrency(ingrediente.preco)}</td>
                    <td>${ingrediente.fornecedor || '-'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editarIngrediente('${ingrediente.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="excluirIngrediente('${ingrediente.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateDashboardIngredientes() {
            const container = document.getElementById('dashboard-ingredientes');
            const cardBody = container.querySelector('.card').innerHTML.split('</div>')[0] + '</div>';
            
            if (ingredientes.length === 0) {
                container.querySelector('.card').innerHTML = cardBody + `
                    <div class="empty-state">
                        <div class="empty-icon">ü•¨</div>
                        <h3>Nenhum ingrediente cadastrado</h3>
                        <p>Comece adicionando seus primeiros ingredientes ao sistema.</p>
                    </div>
                `;
                return;
            }
            
            const tableHTML = `
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Categoria</th>
                                <th>Unidade</th>
                                <th>Pre√ßo</th>
                                <th>Fornecedor</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${ingredientes.slice(0, 5).map(ingrediente => `
                                <tr>
                                    <td><strong>${ingrediente.nome}</strong></td>
                                    <td>${ingrediente.categoria}</td>
                                    <td>${ingrediente.unidade}</td>
                                    <td>${formatCurrency(ingrediente.preco)}</td>
                                    <td>${ingrediente.fornecedor || '-'}</td>
                                    <td>
                                        <button class="btn btn-warning" onclick="editarIngrediente('${ingrediente.id}')">‚úèÔ∏è</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ${ingredientes.length > 5 ? `<p class="text-center mt-20"><button class="btn btn-primary" onclick="showSection('ingredientes')">Ver todos os ${ingredientes.length} ingredientes</button></p>` : ''}
            `;
            
            container.querySelector('.card').innerHTML = cardBody + tableHTML;
        }

        // ========================================
        // RECEITAS
        // ========================================
        function loadReceitas() {
            const tbody = document.getElementById('receitas-list');
            
            if (receitas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="empty-state">
                                <div class="empty-icon">üìù</div>
                                <h3>Nenhuma receita cadastrada</h3>
                                <p>Comece criando suas primeiras receitas de pizza.</p>
                                <button class="btn btn-primary" onclick="showNovaReceitaModal()">‚ûï Criar Receita</button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = receitas.map(receita => {
                const tamanhos = Object.keys(receita.tamanhos)
                    .filter(t => receita.tamanhos[t].ativo)
                    .map(t => t.charAt(0).toUpperCase() + t.slice(1))
                    .join(', ');
                
                const custoMedio = calcularCustoMedio(receita);
                
                return `
                    <tr>
                        <td>
                            <strong>${receita.nome}</strong>
                            <br><small style="color: #7f8c8d;">${receita.descricao}</small>
                        </td>
                        <td>${receita.categoria}</td>
                        <td>${tamanhos || 'Nenhum'}</td>
                        <td>${formatCurrency(custoMedio)}</td>
                        <td>
                            <span class="badge ${receita.ativa ? 'text-success' : 'text-danger'}">
                                ${receita.ativa ? 'Ativa' : 'Inativa'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-warning" onclick="editarReceita('${receita.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-info" onclick="configurarIngredientesReceita('${receita.id}')">ü•¨</button>
                            <button class="btn btn-danger" onclick="excluirReceita('${receita.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Update dashboard
            updateDashboardReceitas();
        }

        function showNovaReceitaModal() {
            if (ingredientes.length === 0) {
                toast.error('Cadastre ingredientes primeiro para criar receitas');
                return;
            }
            
            const formHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome da Pizza *</label>
                        <input type="text" class="form-control" id="receita-nome" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select class="form-control" id="receita-categoria" required>
                            <option value="">Selecione a categoria</option>
                            <option value="tradicional">Tradicional</option>
                            <option value="gourmet">Gourmet</option>
                            <option value="doce">Doce</option>
                            <option value="vegana">Vegana</option>
                            <option value="especial">Especial</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-control" id="receita-descricao" rows="3" placeholder="Descreva os ingredientes e caracter√≠sticas da pizza"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Tamanhos Dispon√≠veis</label>
                    <div class="grid-3">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="tamanho-pequena" checked>
                            <span>Pequena (base)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="tamanho-media" checked>
                            <span>M√©dia (+50%)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="tamanho-grande" checked>
                            <span>Grande (+100%)</span>
                        </label>
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarReceita()">Criar Receita</button>
            `;
            
            modal.show('Nova Receita', formHTML, footer);
        }

        function salvarReceita() {
            const nome = document.getElementById('receita-nome').value.trim();
            const categoria = document.getElementById('receita-categoria').value;
            const descricao = document.getElementById('receita-descricao').value.trim();
            
            if (!nome || !categoria) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            const receita = {
                id: generateId(),
                nome,
                categoria,
                descricao,
                ingredientes: [],
                tamanhos: {
                    pequena: { 
                        ativo: document.getElementById('tamanho-pequena').checked,
                        multiplicador: 1.0,
                        custoTotal: 0
                    },
                    media: { 
                        ativo: document.getElementById('tamanho-media').checked,
                        multiplicador: 1.5,
                        custoTotal: 0
                    },
                    grande: { 
                        ativo: document.getElementById('tamanho-grande').checked,
                        multiplicador: 2.0,
                        custoTotal: 0
                    }
                },
                ativa: true,
                createdAt: new Date().toISOString()
            };
            
            receitas.push(receita);
            storage.save('receitas', receitas);
            
            modal.hide();
            toast.success('Receita criada com sucesso! Configure os ingredientes agora.');
            loadReceitas();
            
            // Abrir modal de configura√ß√£o de ingredientes
            setTimeout(() => configurarIngredientesReceita(receita.id), 500);
        }

        function configurarIngredientesReceita(id) {
            const receita = receitas.find(r => r.id === id);
            if (!receita) return;
            
            if (ingredientes.length === 0) {
                toast.error('Cadastre ingredientes primeiro');
                return;
            }
            
            const ingredientesHTML = receita.ingredientes.map((ing, index) => {
                const ingrediente = ingredientes.find(i => i.id === ing.ingredienteId);
                return `
                    <div class="grid-3 mb-10" style="align-items: end;">
                        <div class="form-group" style="margin: 0;">
                            <select class="form-control" onchange="updateIngredienteReceita(${index}, this.value, '${id}')">
                                <option value="">Selecione o ingrediente</option>
                                ${ingredientes.map(i => `
                                    <option value="${i.id}" ${i.id === ing.ingredienteId ? 'selected' : ''}>
                                        ${i.nome} (${i.unidade})
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <input type="number" class="form-control" placeholder="Quantidade" 
                                   value="${ing.quantidade}" step="0.001" min="0"
                                   onchange="updateQuantidadeReceita(${index}, this.value, '${id}')">
                        </div>
                        <div>
                            <button class="btn btn-danger" onclick="removerIngredienteReceita(${index}, '${id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            const formHTML = `
                <div class="form-group">
                    <label class="form-label">Ingredientes da Receita</label>
                    <div id="ingredientes-receita">
                        ${ingredientesHTML}
                    </div>
                    <button type="button" class="btn btn-success mt-10" onclick="adicionarIngredienteReceita('${id}')">‚ûï Adicionar Ingrediente</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Custos por Tamanho</label>
                    <div class="grid-3">
                        ${Object.keys(receita.tamanhos).map(tamanho => {
                            if (!receita.tamanhos[tamanho].ativo) return '';
                            return `
                                <div class="card" style="margin: 0; padding: 15px;">
                                    <h5>${tamanho.charAt(0).toUpperCase() + tamanho.slice(1)}</h5>
                                    <p><strong>${formatCurrency(receita.tamanhos[tamanho].custoTotal)}</strong></p>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarIngredientesReceita('${id}')">Salvar Configura√ß√£o</button>
            `;
            
            modal.show(`Configurar Ingredientes - ${receita.nome}`, formHTML, footer);
        }

        function adicionarIngredienteReceita(receitaId) {
            const receita = receitas.find(r => r.id === receitaId);
            if (!receita) return;
            
            receita.ingredientes.push({
                ingredienteId: '',
                quantidade: 0
            });
            
            configurarIngredientesReceita(receitaId);
        }

        function removerIngredienteReceita(index, receitaId) {
            const receita = receitas.find(r => r.id === receitaId);
            if (!receita) return;
            
            receita.ingredientes.splice(index, 1);
            calcularCustosReceita(receita);
            configurarIngredientesReceita(receitaId);
        }

        function updateIngredienteReceita(index, ingredienteId, receitaId) {
            const receita = receitas.find(r => r.id === receitaId);
            if (!receita) return;
            
            receita.ingredientes[index].ingredienteId = ingredienteId;
            calcularCustosReceita(receita);
        }

        function updateQuantidadeReceita(index, quantidade, receitaId) {
            const receita = receitas.find(r => r.id === receitaId);
            if (!receita) return;
            
            receita.ingredientes[index].quantidade = parseFloat(quantidade) || 0;
            calcularCustosReceita(receita);
        }

        function salvarIngredientesReceita(id) {
            const receita = receitas.find(r => r.id === id);
            if (!receita) return;
            
            // Validar se todos os ingredientes est√£o configurados
            const ingredientesIncompletos = receita.ingredientes.filter(ing => 
                !ing.ingredienteId || ing.quantidade <= 0
            );
            
            if (ingredientesIncompletos.length > 0) {
                toast.error('Configure todos os ingredientes com quantidades v√°lidas');
                return;
            }
            
            calcularCustosReceita(receita);
            storage.save('receitas', receitas);
            
            modal.hide();
            toast.success('Ingredientes configurados com sucesso!');
            loadReceitas();
        }

        function calcularCustosReceita(receita) {
            Object.keys(receita.tamanhos).forEach(tamanho => {
                if (!receita.tamanhos[tamanho].ativo) {
                    receita.tamanhos[tamanho].custoTotal = 0;
                    return;
                }
                
                let custoTotal = 0;
                receita.ingredientes.forEach(ing => {
                    const ingrediente = ingredientes.find(i => i.id === ing.ingredienteId);
                    if (ingrediente) {
                        const custoIngrediente = (ingrediente.preco * ing.quantidade) * receita.tamanhos[tamanho].multiplicador;
                        custoTotal += custoIngrediente;
                    }
                });
                
                receita.tamanhos[tamanho].custoTotal = custoTotal;
            });
        }

        function calcularCustoMedio(receita) {
            const tamanhosAtivos = Object.keys(receita.tamanhos).filter(t => receita.tamanhos[t].ativo);
            if (tamanhosAtivos.length === 0) return 0;
            
            const custoTotal = tamanhosAtivos.reduce((total, tamanho) => {
                return total + receita.tamanhos[tamanho].custoTotal;
            }, 0);
            
            return custoTotal / tamanhosAtivos.length;
        }

        function editarReceita(id) {
            const receita = receitas.find(r => r.id === id);
            if (!receita) return;
            
            const formHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome da Pizza *</label>
                        <input type="text" class="form-control" id="receita-nome" value="${receita.nome}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select class="form-control" id="receita-categoria" required>
                            <option value="">Selecione a categoria</option>
                            <option value="tradicional" ${receita.categoria === 'tradicional' ? 'selected' : ''}>Tradicional</option>
                            <option value="gourmet" ${receita.categoria === 'gourmet' ? 'selected' : ''}>Gourmet</option>
                            <option value="doce" ${receita.categoria === 'doce' ? 'selected' : ''}>Doce</option>
                            <option value="vegana" ${receita.categoria === 'vegana' ? 'selected' : ''}>Vegana</option>
                            <option value="especial" ${receita.categoria === 'especial' ? 'selected' : ''}>Especial</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-control" id="receita-descricao" rows="3">${receita.descricao || ''}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Tamanhos Dispon√≠veis</label>
                    <div class="grid-3">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="tamanho-pequena" ${receita.tamanhos.pequena.ativo ? 'checked' : ''}>
                            <span>Pequena (base)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="tamanho-media" ${receita.tamanhos.media.ativo ? 'checked' : ''}>
                            <span>M√©dia (+50%)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="tamanho-grande" ${receita.tamanhos.grande.ativo ? 'checked' : ''}>
                            <span>Grande (+100%)</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="receita-ativa" ${receita.ativa ? 'checked' : ''}>
                        <span>Receita ativa no card√°pio</span>
                    </label>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Cancelar</button>
                <button class="btn btn-primary" onclick="atualizarReceita('${id}')">Atualizar</button>
            `;
            
            modal.show('Editar Receita', formHTML, footer);
        }

        function atualizarReceita(id) {
            const nome = document.getElementById('receita-nome').value.trim();
            const categoria = document.getElementById('receita-categoria').value;
            const descricao = document.getElementById('receita-descricao').value.trim();
            const ativa = document.getElementById('receita-ativa').checked;
            
            if (!nome || !categoria) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            const index = receitas.findIndex(r => r.id === id);
            if (index !== -1) {
                receitas[index] = {
                    ...receitas[index],
                    nome,
                    categoria,
                    descricao,
                    ativa,
                    tamanhos: {
                        ...receitas[index].tamanhos,
                        pequena: { ...receitas[index].tamanhos.pequena, ativo: document.getElementById('tamanho-pequena').checked },
                        media: { ...receitas[index].tamanhos.media, ativo: document.getElementById('tamanho-media').checked },
                        grande: { ...receitas[index].tamanhos.grande, ativo: document.getElementById('tamanho-grande').checked }
                    },
                    updatedAt: new Date().toISOString()
                };
                
                calcularCustosReceita(receitas[index]);
                storage.save('receitas', receitas);
                modal.hide();
                toast.success('Receita atualizada com sucesso!');
                loadReceitas();
            }
        }

        function excluirReceita(id) {
            modal.confirm(
                'Tem certeza que deseja excluir esta receita? Esta a√ß√£o n√£o pode ser desfeita.',
                function() {
                    const index = receitas.findIndex(r => r.id === id);
                    if (index !== -1) {
                        receitas.splice(index, 1);
                        storage.save('receitas', receitas);
                        toast.success('Receita exclu√≠da com sucesso!');
                        loadReceitas();
                    }
                },
                'Excluir',
                'Cancelar'
            );
        }

        function filtrarReceitas() {
            const busca = document.getElementById('buscar-receitas').value.toLowerCase();
            const categoria = document.getElementById('filtro-categoria-receitas').value;
            const status = document.getElementById('filtro-status-receitas').value;
            
            let receitasFiltradas = receitas.filter(receita => {
                const matchBusca = receita.nome.toLowerCase().includes(busca) ||
                                 receita.descricao?.toLowerCase().includes(busca);
                const matchCategoria = !categoria || receita.categoria === categoria;
                const matchStatus = !status || (status === 'ativa' ? receita.ativa : !receita.ativa);
                
                return matchBusca && matchCategoria && matchStatus;
            });
            
            // Renderizar lista filtrada
            const tbody = document.getElementById('receitas-list');
            if (receitasFiltradas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="empty-state">
                                <div class="empty-icon">üîç</div>
                                <h3>Nenhuma receita encontrada</h3>
                                <p>Tente ajustar os filtros de busca.</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = receitasFiltradas.map(receita => {
                const tamanhos = Object.keys(receita.tamanhos)
                    .filter(t => receita.tamanhos[t].ativo)
                    .map(t => t.charAt(0).toUpperCase() + t.slice(1))
                    .join(', ');
                
                const custoMedio = calcularCustoMedio(receita);
                
                return `
                    <tr>
                        <td>
                            <strong>${receita.nome}</strong>
                            <br><small style="color: #7f8c8d;">${receita.descricao || 'Sem descri√ß√£o'}</small>
                        </td>
                        <td>${receita.categoria}</td>
                        <td>${tamanhos || 'Nenhum'}</td>
                        <td>${formatCurrency(custoMedio)}</td>
                        <td>
                            <span class="badge ${receita.ativa ? 'text-success' : 'text-danger'}">
                                ${receita.ativa ? 'Ativa' : 'Inativa'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-warning" onclick="editarReceita('${receita.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-info" onclick="configurarIngredientesReceita('${receita.id}')">ü•¨</button>
                            <button class="btn btn-danger" onclick="excluirReceita('${receita.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateDashboardReceitas() {
            const container = document.getElementById('dashboard-receitas');
            const cardBody = container.querySelector('.card').innerHTML.split('</div>')[0] + '</div>';
            
            if (receitas.length === 0) {
                container.querySelector('.card').innerHTML = cardBody + `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <h3>Nenhuma receita cadastrada</h3>
                        <p>Comece criando suas primeiras receitas de pizza.</p>
                    </div>
                `;
                return;
            }
            
            const tableHTML = `
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Categoria</th>
                                <th>Tamanhos</th>
                                <th>Custo M√©dio</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${receitas.slice(0, 5).map(receita => {
                                const tamanhos = Object.keys(receita.tamanhos)
                                    .filter(t => receita.tamanhos[t].ativo)
                                    .map(t => t.charAt(0).toUpperCase() + t.slice(1).substring(0, 1))
                                    .join(', ');
                                
                                const custoMedio = calcularCustoMedio(receita);
                                
                                return `
                                    <tr>
                                        <td>
                                            <strong>${receita.nome}</strong>
                                            <br><small style="color: #7f8c8d;">${receita.descricao || 'Pizza cl√°ssica com mussarela, tomate e or√©gano'}</small>
                                        </td>
                                        <td>${receita.categoria}</td>
                                        <td>${tamanhos || 'Nenhum'}</td>
                                        <td>${formatCurrency(custoMedio)}</td>
                                        <td>
                                            <span class="badge ${receita.ativa ? 'text-success' : 'text-danger'}">
                                                ${receita.ativa ? 'Ativa' : 'Inativa'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn btn-warning" onclick="editarReceita('${receita.id}')">‚úèÔ∏è</button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                ${receitas.length > 5 ? `<p class="text-center mt-20"><button class="btn btn-primary" onclick="showSection('receitas')">Ver todas as ${receitas.length} receitas</button></p>` : ''}
            `;
            
            container.querySelector('.card').innerHTML = cardBody + tableHTML;
        }

        // ========================================
        // CARD√ÅPIO
        // ========================================
        function loadCardapio() {
            const tbody = document.getElementById('cardapio-list');
            const resumoContainer = document.getElementById('cardapio-resumo');
            
            // Atualizar configura√ß√µes no dashboard
            document.getElementById('config-margem-direto').textContent = configuracoes.margemDireto;
            document.getElementById('config-taxa-entrega').textContent = configuracoes.taxaEntrega.toFixed(2);
            document.getElementById('config-margem-ifood').textContent = configuracoes.margemIFood;
            document.getElementById('config-taxa-ifood').textContent = configuracoes.taxaIFood;
            
            const receitasAtivas = receitas.filter(r => r.ativa);
            
            if (receitasAtivas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center">
                            <div class="empty-state">
                                <div class="empty-icon">üìã</div>
                                <h3>Nenhuma receita no card√°pio</h3>
                                <p>Crie receitas primeiro para gerar o card√°pio automaticamente.</p>
                                <button class="btn btn-primary" onclick="showSection('receitas')">Criar Receitas</button>
                            </div>
                        </td>
                    </tr>
                `;
                resumoContainer.innerHTML = '';
                return;
            }
            
            let cardapioItems = [];
            
            receitasAtivas.forEach(receita => {
                Object.keys(receita.tamanhos).forEach(tamanho => {
                    if (receita.tamanhos[tamanho].ativo) {
                        const custo = receita.tamanhos[tamanho].custoTotal;
                        const precoDireto = calcularPrecoDireto(custo);
                        const precoIFood = calcularPrecoIFood(custo);
                        const margemDireto = calcularMargem(custo, precoDireto);
                        const margemIFood = calcularMargem(custo, precoIFood);
                        const melhorCanal = precoDireto > precoIFood ? 'Direto' : 'iFood';
                        const melhorMargem = precoDireto > precoIFood ? margemDireto : margemIFood;
                        
                        cardapioItems.push({
                            receita,
                            tamanho,
                            custo,
                            precoDireto,
                            precoIFood,
                            margemDireto,
                            margemIFood,
                            melhorCanal,
                            melhorMargem
                        });
                    }
                });
            });
            
            tbody.innerHTML = cardapioItems.map(item => `
                <tr>
                    <td>
                        <strong>${item.receita.nome}</strong>
                        <br><small style="color: #7f8c8d;">${item.receita.descricao || 'Pizza cl√°ssica com mussarela, tomate e or√©gano'}</small>
                    </td>
                    <td>${item.receita.categoria}</td>
                    <td>${item.tamanho.charAt(0).toUpperCase() + item.tamanho.slice(1)}</td>
                    <td>${formatCurrency(item.custo)}</td>
                    <td><strong>${formatCurrency(item.precoDireto)}</strong></td>
                    <td><strong>${formatCurrency(item.precoIFood)}</strong></td>
                    <td>${item.margemDireto.toFixed(1)}%</td>
                    <td>${item.margemIFood.toFixed(1)}%</td>
                    <td>
                        <span class="badge ${item.melhorCanal === 'Direto' ? 'text-success' : 'text-info'}">
                            ${item.melhorCanal} (${item.melhorMargem.toFixed(1)}%)
                        </span>
                    </td>
                </tr>
            `).join('');
            
            // Gerar resumo
            const totalItems = cardapioItems.length;
            const receitasAtivasCount = receitasAtivas.length;
            
            const margemMediaDireto = cardapioItems.reduce((sum, item) => sum + item.margemDireto, 0) / totalItems;
            const margemMediaIFood = cardapioItems.reduce((sum, item) => sum + item.margemIFood, 0) / totalItems;
            
            const ticketMedioDireto = cardapioItems.reduce((sum, item) => sum + item.precoDireto, 0) / totalItems;
            const ticketMedioIFood = cardapioItems.reduce((sum, item) => sum + item.precoIFood, 0) / totalItems;
            
            resumoContainer.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <span style="font-size: 1.5em;">üìä</span>
                        <h3>Resumo Geral</h3>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card blue">
                            <div class="stat-number">${totalItems}</div>
                            <div class="stat-label">Total de Itens</div>
                        </div>
                        <div class="stat-card green">
                            <div class="stat-number">${receitasAtivasCount}</div>
                            <div class="stat-label">Receitas Ativas</div>
                        </div>
                    </div>
                    
                    <div class="grid-2 mt-20">
                        <div class="card" style="margin: 0;">
                            <h4>üöö Delivery Direto</h4>
                            <p><strong>Margem M√©dia:</strong> ${margemMediaDireto.toFixed(1)}%</p>
                            <p><strong>Ticket M√©dio:</strong> ${formatCurrency(ticketMedioDireto)}</p>
                        </div>
                        <div class="card" style="margin: 0;">
                            <h4>üçï iFood</h4>
                            <p><strong>Margem M√©dia:</strong> ${margemMediaIFood.toFixed(1)}%</p>
                            <p><strong>Ticket M√©dio:</strong> ${formatCurrency(ticketMedioIFood)}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function calcularPrecoDireto(custo) {
            const precoBase = custo * (1 + configuracoes.margemDireto / 100);
            return precoBase + configuracoes.taxaEntrega;
        }

        function calcularPrecoIFood(custo) {
            // Pre√ßo que resulta na margem l√≠quida desejada ap√≥s desconto da taxa do iFood
            return custo / (1 - configuracoes.margemIFood / 100);
        }

        function calcularMargem(custo, preco) {
            if (custo === 0) return 0;
            return ((preco - custo) / custo) * 100;
        }

        function showConfiguracoesModal() {
            const formHTML = `
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Margem Delivery Direto (%)</label>
                        <input type="number" class="form-control" id="config-margem-direto-input" 
                               value="${configuracoes.margemDireto}" min="0" step="1">
                        <small style="color: #7f8c8d;">Margem de lucro sobre o custo</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Taxa de Entrega (R$)</label>
                        <input type="number" class="form-control" id="config-taxa-entrega-input" 
                               value="${configuracoes.taxaEntrega}" min="0" step="0.50">
                        <small style="color: #7f8c8d;">Valor fixo por entrega</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Margem L√≠quida iFood (%)</label>
                        <input type="number" class="form-control" id="config-margem-ifood-input" 
                               value="${configuracoes.margemIFood}" min="0" step="1">
                        <small style="color: #7f8c8d;">Margem ap√≥s desconto da taxa</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Taxa iFood (%)</label>
                        <input type="number" class="form-control" id="config-taxa-ifood-input" 
                               value="${configuracoes.taxaIFood}" min="0" step="1">
                        <small style="color: #7f8c8d;">Taxa cobrada pelo iFood</small>
                    </div>
                </div>
                <div class="card mt-20" style="background: #f8f9fa;">
                    <h4>üí° Como funciona o c√°lculo:</h4>
                    <ul>
                        <li><strong>Delivery Direto:</strong> (Custo √ó Margem) + Taxa de Entrega</li>
                        <li><strong>iFood:</strong> Custo √∑ (1 - Margem L√≠quida √∑ 100)</li>
                    </ul>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarConfiguracoes()">Salvar Configura√ß√µes</button>
            `;
            
            modal.show('Configurar Margens e Taxas', formHTML, footer);
        }

        function salvarConfiguracoes() {
            const margemDireto = parseFloat(document.getElementById('config-margem-direto-input').value);
            const taxaEntrega = parseFloat(document.getElementById('config-taxa-entrega-input').value);
            const margemIFood = parseFloat(document.getElementById('config-margem-ifood-input').value);
            const taxaIFood = parseFloat(document.getElementById('config-taxa-ifood-input').value);
            
            if (isNaN(margemDireto) || isNaN(taxaEntrega) || isNaN(margemIFood) || isNaN(taxaIFood)) {
                toast.error('Preencha todos os campos com valores v√°lidos');
                return;
            }
            
            configuracoes = {
                margemDireto,
                taxaEntrega,
                margemIFood,
                taxaIFood
            };
            
            storage.save('configuracoes', configuracoes);
            modal.hide();
            toast.success('Configura√ß√µes salvas com sucesso!');
            loadCardapio();
        }

        function filtrarCardapio() {
            // Implementar filtros do card√°pio se necess√°rio
            loadCardapio();
        }

        // ========================================
        // VENDAS
        // ========================================
        function loadVendas() {
            updateVendasStats();
            
            const container = document.getElementById('vendas-table-container');
            
            if (vendas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üí≥</div>
                        <h3>Nenhuma venda registrada</h3>
                        <p>Comece registrando sua primeira venda do dia.</p>
                        <button class="btn btn-primary" onclick="showNovaVendaModal()">Registrar Primeira Venda</button>
                    </div>
                `;
                return;
            }
            
            const tableHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Canal</th>
                            <th>Itens</th>
                            <th>Total</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${vendas.map(venda => `
                            <tr>
                                <td>${formatDate(venda.data)}</td>
                                <td>
                                    <strong>${venda.cliente}</strong>
                                    ${venda.telefone ? `<br><small>${venda.telefone}</small>` : ''}
                                </td>
                                <td>
                                    <span class="badge ${venda.canal === 'direto' ? 'text-success' : 'text-info'}">
                                        ${venda.canal === 'direto' ? 'üöö Direto' : 'üçï iFood'}
                                    </span>
                                </td>
                                <td>
                                    ${venda.itens.map(item => `${item.quantidade}x ${item.nome} (${item.tamanho})`).join('<br>')}
                                </td>
                                <td><strong>${formatCurrency(venda.valorTotal)}</strong></td>
                                <td>
                                    <button class="btn btn-info" onclick="visualizarVenda('${venda.id}')">üëÅÔ∏è</button>
                                    <button class="btn btn-danger" onclick="cancelarVenda('${venda.id}')">‚ùå</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }

        function showNovaVendaModal() {
            const receitasAtivas = receitas.filter(r => r.ativa);
            
            if (receitasAtivas.length === 0) {
                modal.confirm(
                    'Nenhuma receita ativa encontrada. Deseja ir para o m√≥dulo de receitas para ativar uma?',
                    function() {
                        showSection('receitas');
                    },
                    'Ir para Receitas',
                    'Cancelar'
                );
                return;
            }
            
            const formHTML = `
                <div id="nova-venda-form">
                    <div class="grid-2 mb-20">
                        <div class="form-group">
                            <label class="form-label">Cliente *</label>
                            <input type="text" class="form-control" id="venda-cliente" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-control" id="venda-telefone">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Canal *</label>
                            <select class="form-control" id="venda-canal" required>
                                <option value="">Selecione o canal</option>
                                <option value="direto">üöö Delivery Direto</option>
                                <option value="ifood">üçï iFood</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data</label>
                            <input type="date" class="form-control" id="venda-data" value="${getCurrentDate()}">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Itens do Pedido</label>
                        <div id="itens-pedido">
                            <div class="grid-4 mb-10" style="align-items: end;">
                                <select class="form-control" id="item-receita-0">
                                    <option value="">Selecione a receita</option>
                                    ${receitasAtivas.map(r => `<option value="${r.id}">${r.nome}</option>`).join('')}
                                </select>
                                <select class="form-control" id="item-tamanho-0">
                                    <option value="">Selecione o tamanho</option>
                                </select>
                                <input type="number" class="form-control" id="item-quantidade-0" placeholder="Qtd" min="1" value="1">
                                <div id="item-preco-0" class="text-right font-bold">R$ 0,00</div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-success" onclick="adicionarItemPedido()">‚ûï Adicionar Item</button>
                    </div>
                    
                    <div class="form-group text-right">
                        <h3>Total: <span id="venda-total">R$ 0,00</span></h3>
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarVenda()">Confirmar</button>
            `;
            
            modal.show('Nova Venda', formHTML, footer);
            
            // Setup event listeners
            setupVendaEventListeners();
        }

        function setupVendaEventListeners() {
            // Event listener para mudan√ßa de receita
            document.addEventListener('change', function(e) {
                if (e.target.id && e.target.id.startsWith('item-receita-')) {
                    const index = e.target.id.split('-')[2];
                    updateTamanhosDisponiveis(index);
                    calcularTotalVenda();
                }
                
                if (e.target.id && (e.target.id.startsWith('item-tamanho-') || e.target.id.startsWith('item-quantidade-'))) {
                    calcularTotalVenda();
                }
                
                if (e.target.id === 'venda-canal') {
                    calcularTotalVenda();
                }
            });
        }

        function updateTamanhosDisponiveis(index) {
            const receitaId = document.getElementById(`item-receita-${index}`).value;
            const tamanhoSelect = document.getElementById(`item-tamanho-${index}`);
            
            if (!receitaId) {
                tamanhoSelect.innerHTML = '<option value="">Selecione o tamanho</option>';
                return;
            }
            
            const receita = receitas.find(r => r.id === receitaId);
            if (!receita) return;
            
            const tamanhosAtivos = Object.keys(receita.tamanhos).filter(t => receita.tamanhos[t].ativo);
            
            tamanhoSelect.innerHTML = '<option value="">Selecione o tamanho</option>' +
                tamanhosAtivos.map(t => `<option value="${t}">${t.charAt(0).toUpperCase() + t.slice(1)}</option>`).join('');
        }

        function calcularTotalVenda() {
            const canal = document.getElementById('venda-canal').value;
            if (!canal) return;
            
            let total = 0;
            const itensPedido = document.getElementById('itens-pedido');
            const items = itensPedido.querySelectorAll('[id^="item-receita-"]');
            
            items.forEach((item, index) => {
                const receitaId = document.getElementById(`item-receita-${index}`).value;
                const tamanho = document.getElementById(`item-tamanho-${index}`).value;
                const quantidade = parseInt(document.getElementById(`item-quantidade-${index}`).value) || 0;
                
                if (receitaId && tamanho && quantidade > 0) {
                    const receita = receitas.find(r => r.id === receitaId);
                    if (receita && receita.tamanhos[tamanho]) {
                        const custo = receita.tamanhos[tamanho].custoTotal;
                        const preco = canal === 'direto' ? calcularPrecoDireto(custo) : calcularPrecoIFood(custo);
                        const subtotal = preco * quantidade;
                        
                        document.getElementById(`item-preco-${index}`).textContent = formatCurrency(subtotal);
                        total += subtotal;
                    }
                }
            });
            
            document.getElementById('venda-total').textContent = formatCurrency(total);
        }

        function adicionarItemPedido() {
            const itensPedido = document.getElementById('itens-pedido');
            const currentItems = itensPedido.querySelectorAll('[id^="item-receita-"]').length;
            const receitasAtivas = receitas.filter(r => r.ativa);
            
            const itemHTML = `
                <div class="grid-4 mb-10" style="align-items: end;">
                    <select class="form-control" id="item-receita-${currentItems}">
                        <option value="">Selecione a receita</option>
                        ${receitasAtivas.map(r => `<option value="${r.id}">${r.nome}</option>`).join('')}
                    </select>
                    <select class="form-control" id="item-tamanho-${currentItems}">
                        <option value="">Selecione o tamanho</option>
                    </select>
                    <input type="number" class="form-control" id="item-quantidade-${currentItems}" placeholder="Qtd" min="1" value="1">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div id="item-preco-${currentItems}" class="font-bold">R$ 0,00</div>
                        <button type="button" class="btn btn-danger" onclick="removerItemPedido(${currentItems})">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            
            itensPedido.insertAdjacentHTML('beforeend', itemHTML);
        }

        function removerItemPedido(index) {
            const item = document.getElementById(`item-receita-${index}`).closest('.grid-4');
            item.remove();
            calcularTotalVenda();
        }

        function salvarVenda() {
            const cliente = document.getElementById('venda-cliente').value.trim();
            const telefone = document.getElementById('venda-telefone').value.trim();
            const canal = document.getElementById('venda-canal').value;
            const data = document.getElementById('venda-data').value;
            
            if (!cliente || !canal || !data) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            // Coletar itens do pedido
            const itens = [];
            const itensPedido = document.getElementById('itens-pedido');
            const items = itensPedido.querySelectorAll('[id^="item-receita-"]');
            
            items.forEach((item, index) => {
                const receitaId = document.getElementById(`item-receita-${index}`).value;
                const tamanho = document.getElementById(`item-tamanho-${index}`).value;
                const quantidade = parseInt(document.getElementById(`item-quantidade-${index}`).value) || 0;
                
                if (receitaId && tamanho && quantidade > 0) {
                    const receita = receitas.find(r => r.id === receitaId);
                    if (receita) {
                        const custo = receita.tamanhos[tamanho].custoTotal;
                        const precoUnitario = canal === 'direto' ? calcularPrecoDireto(custo) : calcularPrecoIFood(custo);
                        
                        itens.push({
                            receitaId,
                            nome: receita.nome,
                            tamanho,
                            quantidade,
                            precoUnitario,
                            subtotal: precoUnitario * quantidade
                        });
                    }
                }
            });
            
            if (itens.length === 0) {
                toast.error('Adicione pelo menos um item ao pedido');
                return;
            }
            
            const valorTotal = itens.reduce((total, item) => total + item.subtotal, 0);
            
            const venda = {
                id: generateId(),
                cliente,
                telefone,
                canal,
                data,
                itens,
                valorTotal,
                createdAt: new Date().toISOString()
            };
            
            vendas.push(venda);
            storage.save('vendas', vendas);
            
            modal.hide();
            toast.success('Venda registrada com sucesso!');
            loadVendas();
            updateDashboard();
        }

        function updateVendasStats() {
            const hoje = getCurrentDate();
            const vendasHoje = vendas.filter(v => v.data === hoje);
            const vendasDireto = vendasHoje.filter(v => v.canal === 'direto');
            const vendasIFood = vendasHoje.filter(v => v.canal === 'ifood');
            
            const totalDireto = vendasDireto.reduce((total, venda) => total + venda.valorTotal, 0);
            const totalIFood = vendasIFood.reduce((total, venda) => total + venda.valorTotal, 0);
            
            document.getElementById('vendas-hoje-count').textContent = vendasHoje.length;
            document.getElementById('vendas-direto-total').textContent = formatCurrency(totalDireto);
            document.getElementById('vendas-ifood-total').textContent = formatCurrency(totalIFood);
        }

        function visualizarVenda(id) {
            const venda = vendas.find(v => v.id === id);
            if (!venda) return;
            
            const detalhesHTML = `
                <div class="grid-2 mb-20">
                    <div>
                        <strong>Cliente:</strong> ${venda.cliente}<br>
                        ${venda.telefone ? `<strong>Telefone:</strong> ${venda.telefone}<br>` : ''}
                        <strong>Data:</strong> ${formatDate(venda.data)}
                    </div>
                    <div>
                        <strong>Canal:</strong> 
                        <span class="badge ${venda.canal === 'direto' ? 'text-success' : 'text-info'}">
                            ${venda.canal === 'direto' ? 'üöö Delivery Direto' : 'üçï iFood'}
                        </span>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Tamanho</th>
                                <th>Qtd</th>
                                <th>Pre√ßo Unit.</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${venda.itens.map(item => `
                                <tr>
                                    <td><strong>${item.nome}</strong></td>
                                    <td>${item.tamanho.charAt(0).toUpperCase() + item.tamanho.slice(1)}</td>
                                    <td>${item.quantidade}</td>
                                    <td>${formatCurrency(item.precoUnitario)}</td>
                                    <td>${formatCurrency(item.subtotal)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="4">Total</th>
                                <th>${formatCurrency(venda.valorTotal)}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="modal.hide()">Fechar</button>
            `;
            
            modal.show(`Detalhes da Venda #${venda.id.substr(-8)}`, detalhesHTML, footer);
        }

        function cancelarVenda(id) {
            modal.confirm(
                'Tem certeza que deseja cancelar esta venda? Esta a√ß√£o n√£o pode ser desfeita.',
                function() {
                    const index = vendas.findIndex(v => v.id === id);
                    if (index !== -1) {
                        vendas.splice(index, 1);
                        storage.save('vendas', vendas);
                        toast.success('Venda cancelada com sucesso!');
                        loadVendas();
                        updateDashboard();
                    }
                },
                'Cancelar Venda',
                'Manter Venda'
            );
        }

        function filtrarVendas() {
            // Implementar filtros de vendas se necess√°rio
            loadVendas();
        }

        // ========================================
        // RESULTADOS
        // ========================================
        function loadResultados() {
            aplicarPeriodoRelatorio();
        }

        function aplicarPeriodoRelatorio() {
            const periodo = document.getElementById('periodo-relatorio').value;
            const dataInicial = document.getElementById('data-inicial-relatorio');
            const dataFinal = document.getElementById('data-final-relatorio');
            
            const hoje = new Date();
            const ontem = new Date(hoje);
            ontem.setDate(hoje.getDate() - 1);
            
            switch(periodo) {
                case 'hoje':
                    dataInicial.value = getCurrentDate();
                    dataFinal.value = getCurrentDate();
                    break;
                case 'ontem':
                    dataInicial.value = ontem.toISOString().split('T')[0];
                    dataFinal.value = ontem.toISOString().split('T')[0];
                    break;
                case 'semana':
                    const inicioSemana = new Date(hoje);
                    inicioSemana.setDate(hoje.getDate() - hoje.getDay());
                    dataInicial.value = inicioSemana.toISOString().split('T')[0];
                    dataFinal.value = getCurrentDate();
                    break;
                case 'mes':
                    const inicioMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                    dataInicial.value = inicioMes.toISOString().split('T')[0];
                    dataFinal.value = getCurrentDate();
                    break;
            }
            
            if (periodo !== 'personalizado') {
                gerarRelatorio();
            }
        }

        function gerarRelatorio() {
            const dataInicial = document.getElementById('data-inicial-relatorio').value;
            const dataFinal = document.getElementById('data-final-relatorio').value;
            const container = document.getElementById('relatorio-content');
            
            if (!dataInicial || !dataFinal) {
                toast.error('Selecione as datas inicial e final');
                return;
            }
            
            const vendasPeriodo = vendas.filter(v => v.data >= dataInicial && v.data <= dataFinal);
            
            if (vendasPeriodo.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <h3>Nenhuma venda no per√≠odo selecionado</h3>
                        <p>Tente selecionar um per√≠odo diferente.</p>
                    </div>
                `;
                return;
            }
            
            // Calcular estat√≠sticas
            const totalVendas = vendasPeriodo.length;
            const faturamentoTotal = vendasPeriodo.reduce((total, venda) => total + venda.valorTotal, 0);
            const ticketMedio = faturamentoTotal / totalVendas;
            
            const vendasDireto = vendasPeriodo.filter(v => v.canal === 'direto');
            const vendasIFood = vendasPeriodo.filter(v => v.canal === 'ifood');
            
            const faturamentoDireto = vendasDireto.reduce((total, venda) => total + venda.valorTotal, 0);
            const faturamentoIFood = vendasIFood.reduce((total, venda) => total + venda.valorTotal, 0);
            
            // Produtos mais vendidos
            const produtosVendidos = {};
            vendasPeriodo.forEach(venda => {
                venda.itens.forEach(item => {
                    const key = `${item.nome} (${item.tamanho})`;
                    if (!produtosVendidos[key]) {
                        produtosVendidos[key] = { nome: key, quantidade: 0, faturamento: 0 };
                    }
                    produtosVendidos[key].quantidade += item.quantidade;
                    produtosVendidos[key].faturamento += item.subtotal;
                });
            });
            
            const topProdutos = Object.values(produtosVendidos)
                .sort((a, b) => b.quantidade - a.quantidade)
                .slice(0, 5);
            
            const relatorioHTML = `
                <div class="stats-grid mb-30">
                    <div class="stat-card green">
                        <div class="stat-number">${totalVendas}</div>
                        <div class="stat-label">Total de Vendas</div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-number">${formatCurrency(faturamentoTotal)}</div>
                        <div class="stat-label">Faturamento Total</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-number">${formatCurrency(ticketMedio)}</div>
                        <div class="stat-label">Ticket M√©dio</div>
                    </div>
                </div>
                
                <div class="grid-2 mb-30">
                    <div class="card" style="margin: 0;">
                        <h4>üöö Delivery Direto</h4>
                        <p><strong>Vendas:</strong> ${vendasDireto.length}</p>
                        <p><strong>Faturamento:</strong> ${formatCurrency(faturamentoDireto)}</p>
                        <p><strong>Participa√ß√£o:</strong> ${((faturamentoDireto / faturamentoTotal) * 100).toFixed(1)}%</p>
                    </div>
                    <div class="card" style="margin: 0;">



                        <h4>üçï iFood</h4>
                        <p><strong>Vendas:</strong> ${vendasIFood.length}</p>
                        <p><strong>Faturamento:</strong> ${formatCurrency(faturamentoIFood)}</p>
                        <p><strong>Participa√ß√£o:</strong> ${((faturamentoIFood / faturamentoTotal) * 100).toFixed(1)}%</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span style="font-size: 1.5em;">üèÜ</span>
                        <h3>Top 5 Produtos Mais Vendidos</h3>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Quantidade</th>
                                    <th>Faturamento</th>
                                    <th>Participa√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${topProdutos.map(produto => `
                                    <tr>
                                        <td><strong>${produto.nome}</strong></td>
                                        <td>${produto.quantidade}</td>
                                        <td>${formatCurrency(produto.faturamento)}</td>
                                        <td>${((produto.faturamento / faturamentoTotal) * 100).toFixed(1)}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="text-center mt-30">
                    <button class="btn btn-success" onclick="exportarRelatorio('${dataInicial}', '${dataFinal}')">
                        üìä Exportar Relat√≥rio (CSV)
                    </button>
                </div>
            `;
            
            container.innerHTML = relatorioHTML;
        }

        function exportarRelatorio(dataInicial, dataFinal) {
            const vendasPeriodo = vendas.filter(v => v.data >= dataInicial && v.data <= dataFinal);
            
            if (vendasPeriodo.length === 0) {
                toast.error('Nenhuma venda no per√≠odo para exportar');
                return;
            }
            
            // Preparar dados para CSV
            const csvData = [];
            csvData.push(['Data', 'Cliente', 'Telefone', 'Canal', 'Item', 'Tamanho', 'Quantidade', 'Pre√ßo Unit√°rio', 'Subtotal', 'Total da Venda']);
            
            vendasPeriodo.forEach(venda => {
                venda.itens.forEach((item, index) => {
                    csvData.push([
                        venda.data,
                        venda.cliente,
                        venda.telefone || '',
                        venda.canal === 'direto' ? 'Delivery Direto' : 'iFood',
                        item.nome,
                        item.tamanho.charAt(0).toUpperCase() + item.tamanho.slice(1),
                        item.quantidade,
                        item.precoUnitario.toFixed(2),
                        item.subtotal.toFixed(2),
                        index === 0 ? venda.valorTotal.toFixed(2) : ''
                    ]);
                });
            });
            
            // Converter para CSV
            const csvContent = csvData.map(row => row.map(field => `"${field}"`).join(',')).join('\n');
            
            // Download do arquivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `relatorio_vendas_${dataInicial}_${dataFinal}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            toast.success('Relat√≥rio exportado com sucesso!');
        }

        // ========================================
        // DASHBOARD
        // ========================================
        function loadDashboard() {
            updateDashboard();
            updateDashboardIngredientes();
            updateDashboardReceitas();
            updateDashboardCardapio();
        }

        function updateDashboard() {
            const hoje = getCurrentDate();
            const vendasHoje = vendas.filter(v => v.data === hoje);
            
            const totalVendas = vendasHoje.length;
            const faturamentoHoje = vendasHoje.reduce((total, venda) => total + venda.valorTotal, 0);
            const ticketMedio = totalVendas > 0 ? faturamentoHoje / totalVendas : 0;
            
            // Calcular margem m√©dia (simplificado)
            let margemMedia = 0;
            if (vendasHoje.length > 0) {
                const margens = vendasHoje.map(venda => {
                    // Estimar margem baseada no canal
                    return venda.canal === 'direto' ? configuracoes.margemDireto : configuracoes.margemIFood;
                });
                margemMedia = margens.reduce((sum, m) => sum + m, 0) / margens.length;
            }
            
            document.getElementById('vendas-hoje').textContent = totalVendas;
            document.getElementById('faturamento-hoje').textContent = formatCurrency(faturamentoHoje);
            document.getElementById('ticket-medio').textContent = formatCurrency(ticketMedio);
            document.getElementById('margem-media').textContent = `${margemMedia.toFixed(1)}%`;
        }

        function updateDashboardCardapio() {
            const container = document.getElementById('dashboard-cardapio');
            const cardBody = container.innerHTML.split('<div class="empty-state">')[0];
            
            const receitasAtivas = receitas.filter(r => r.ativa);
            
            if (receitasAtivas.length === 0) {
                container.innerHTML = cardBody + `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <h3>Nenhuma receita no card√°pio</h3>
                        <p>Crie receitas primeiro para gerar o card√°pio automaticamente.</p>
                    </div>
                `;
                return;
            }
            
            let totalItens = 0;
            receitasAtivas.forEach(receita => {
                Object.keys(receita.tamanhos).forEach(tamanho => {
                    if (receita.tamanhos[tamanho].ativo) {
                        totalItens++;
                    }
                });
            });
            
            const tableHTML = `
                <div class="text-center mb-20">
                    <div class="stat-card blue" style="display: inline-block; margin: 0;">
                        <div class="stat-number">${totalItens}</div>
                        <div class="stat-label">Itens no Card√°pio</div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Pizza</th>
                                <th>Tamanho</th>
                                <th>Pre√ßo Direto</th>
                                <th>Pre√ßo iFood</th>
                                <th>Melhor Canal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${receitasAtivas.slice(0, 5).map(receita => {
                                return Object.keys(receita.tamanhos)
                                    .filter(t => receita.tamanhos[t].ativo)
                                    .map(tamanho => {
                                        const custo = receita.tamanhos[tamanho].custoTotal;
                                        const precoDireto = calcularPrecoDireto(custo);
                                        const precoIFood = calcularPrecoIFood(custo);
                                        const melhorCanal = precoDireto > precoIFood ? 'Direto' : 'iFood';
                                        
                                        return `
                                            <tr>
                                                <td><strong>${receita.nome}</strong></td>
                                                <td>${tamanho.charAt(0).toUpperCase() + tamanho.slice(1)}</td>
                                                <td>${formatCurrency(precoDireto)}</td>
                                                <td>${formatCurrency(precoIFood)}</td>
                                                <td>
                                                    <span class="badge ${melhorCanal === 'Direto' ? 'text-success' : 'text-info'}">
                                                        ${melhorCanal}
                                                    </span>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('');
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                ${totalItens > 15 ? `<p class="text-center mt-20"><button class="btn btn-primary" onclick="showSection('cardapio')">Ver card√°pio completo (${totalItens} itens)</button></p>` : ''}
            `;
            
            container.innerHTML = cardBody + tableHTML;
        }

        // ========================================
        // INICIALIZA√á√ÉO
        // ========================================
        function initApp() {
            // Carregar dados do localStorage
            ingredientes = storage.load('ingredientes', []);
            receitas = storage.load('receitas', []);
            vendas = storage.load('vendas', []);
            configuracoes = storage.load('configuracoes', {
                margemDireto: 150,
                taxaEntrega: 5.00,
                margemIFood: 49,
                taxaIFood: 27
            });
            
            // Carregar dashboard inicial
            loadDashboard();
            
            // Setup event listeners
            setupEventListeners();
            
            console.log('Pizzaria Pro inicializado com sucesso!');
        }

        function setupEventListeners() {
            // Event listener para fechar modal clicando fora
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    modal.hide();
                }
            });
            
            // Event listener para ESC fechar modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    modal.hide();
                }
            });
        }

        // Inicializar aplica√ß√£o quando DOM estiver carregado
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

