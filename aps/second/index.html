<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzaria Pro - Sistema de Gest√£o Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* SIDEBAR LATERAL */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h1 {
            font-size: 1.4em;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-group {
            margin-bottom: 30px;
        }

        .menu-group-title {
            padding: 10px 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #bdc3c7;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            padding-left: 30px;
        }

        .menu-item.active {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-right: 4px solid #fff;
            font-weight: 600;
        }

        .menu-item-icon {
            margin-right: 12px;
            font-size: 1.2em;
            width: 20px;
            text-align: center;
        }

        .menu-item-badge {
            margin-left: auto;
            background: #e74c3c;
            color: white;
            font-size: 0.75em;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* CONTENT AREA */
        .main-content {
            flex: 1;
            margin-left: 280px;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .content-header {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content-header h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .content-header p {
            opacity: 0.9;
            font-size: 1em;
        }

        .content-body {
            padding: 30px;
        }

        /* CARDS */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }

        .card-title-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        /* BUTTONS */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* FORMS */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* TABLES */
        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* TOAST */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background: white;
            border-radius: 5px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-left-color: #2ecc71;
        }

        .toast.error {
            border-left-color: #e74c3c;
        }

        .toast.warning {
            border-left-color: #f39c12;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: #6c757d;
            margin-left: 15px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* KPI CARDS */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .kpi-card.success {
            border-left-color: #2ecc71;
        }

        .kpi-card.warning {
            border-left-color: #f39c12;
        }

        .kpi-card.danger {
            border-left-color: #e74c3c;
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .kpi-title {
            font-size: 0.9em;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
        }

        .kpi-icon {
            font-size: 1.5em;
        }

        .kpi-value {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .kpi-change {
            font-size: 0.85em;
            font-weight: 500;
        }

        .kpi-change.positive {
            color: #2ecc71;
        }

        .kpi-change.negative {
            color: #e74c3c;
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content-body {
                padding: 20px;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }

        /* UTILITIES */
        .d-none { display: none !important; }
        .d-flex { display: flex !important; }
        .justify-content-between { justify-content: space-between !important; }
        .align-items-center { align-items: center !important; }
        .text-center { text-align: center !important; }
        .mb-0 { margin-bottom: 0 !important; }
        .mb-1 { margin-bottom: 0.25rem !important; }
        .mb-2 { margin-bottom: 0.5rem !important; }
        .mb-3 { margin-bottom: 1rem !important; }
        .mb-4 { margin-bottom: 1.5rem !important; }
        .mb-5 { margin-bottom: 3rem !important; }
        .mt-3 { margin-top: 1rem !important; }
        .text-success { color: #2ecc71 !important; }
        .text-danger { color: #e74c3c !important; }
        .text-warning { color: #f39c12 !important; }
        .text-muted { color: #6c757d !important; }
        .badge {
            display: inline-block;
            padding: 0.25em 0.6em;
            font-size: 0.75em;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
        }
        .badge-success { background-color: #2ecc71; color: white; }
        .badge-warning { background-color: #f39c12; color: white; }
        .badge-danger { background-color: #e74c3c; color: white; }
        .badge-primary { background-color: #3498db; color: white; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üçï Pizzaria Pro</h1>
                <p>Sistema de Gest√£o Completo</p>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-group">
                    <div class="menu-group-title">üìä DASHBOARD</div>
                    <button class="menu-item active" onclick="showSection('dashboard')">
                        <span class="menu-item-icon">üìà</span>
                        Vis√£o Geral
                        <span class="menu-item-badge">1</span>
                    </button>
                </div>

                <div class="menu-group">
                    <div class="menu-group-title">üçï PRODUTOS</div>
                    <button class="menu-item" onclick="showSection('ingredientes')">
                        <span class="menu-item-icon">ü•¨</span>
                        Ingredientes
                        <span class="menu-item-badge">2</span>
                    </button>
                    <button class="menu-item" onclick="showSection('receitas')">
                        <span class="menu-item-icon">üìù</span>
                        Receitas
                        <span class="menu-item-badge">3</span>
                    </button>
                    <button class="menu-item" onclick="showSection('cardapio')">
                        <span class="menu-item-icon">üìã</span>
                        Card√°pio
                        <span class="menu-item-badge">4</span>
                    </button>
                </div>

                <div class="menu-group">
                    <div class="menu-group-title">üì¶ ESTOQUE</div>
                    <button class="menu-item" onclick="showSection('estoque')">
                        <span class="menu-item-icon">üì¶</span>
                        Controle de Estoque
                        <span class="menu-item-badge">5</span>
                    </button>
                    <button class="menu-item" onclick="showSection('compras')">
                        <span class="menu-item-icon">üõí</span>
                        Compras
                        <span class="menu-item-badge">6</span>
                    </button>
                </div>

                <div class="menu-group">
                    <div class="menu-group-title">üí∞ VENDAS</div>
                    <button class="menu-item" onclick="showSection('vendas')">
                        <span class="menu-item-icon">üí≥</span>
                        Registrar Vendas
                        <span class="menu-item-badge">7</span>
                    </button>
                    <button class="menu-item" onclick="showSection('resultados')">
                        <span class="menu-item-icon">üìä</span>
                        Resultados Di√°rios
                        <span class="menu-item-badge">8</span>
                    </button>
                    <button class="menu-item" onclick="showSection('custos')">
                        <span class="menu-item-icon">üí∞</span>
                        Custos Operacionais
                        <span class="menu-item-badge">9</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="content-header" id="content-header">
                <h2 id="header-title">üìä Dashboard - Vis√£o Geral</h2>
                <p id="header-subtitle">Monitore os indicadores-chave da sua opera√ß√£o</p>
            </div>

            <div class="content-body">
                <!-- DASHBOARD TAB -->
                <div id="tab-dashboard" class="tab-content">
                    <div class="kpi-grid">
                        <div class="kpi-card success">
                            <div class="kpi-header">
                                <span class="kpi-title">Vendas Hoje</span>
                                <span class="kpi-icon">üì¶</span>
                            </div>
                            <div class="kpi-value" id="vendas-hoje">0</div>
                            <div class="kpi-change">--</div>
                        </div>

                        <div class="kpi-card warning">
                            <div class="kpi-header">
                                <span class="kpi-title">Faturamento Hoje</span>
                                <span class="kpi-icon">üí∞</span>
                            </div>
                            <div class="kpi-value" id="faturamento-hoje">R$ 0,00</div>
                            <div class="kpi-change">--</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <span class="kpi-title">Ticket M√©dio</span>
                                <span class="kpi-icon">üéØ</span>
                            </div>
                            <div class="kpi-value" id="ticket-medio">R$ 0,00</div>
                            <div class="kpi-change">--</div>
                        </div>

                        <div class="kpi-card danger">
                            <div class="kpi-header">
                                <span class="kpi-title">Margem M√©dia</span>
                                <span class="kpi-icon">üìà</span>
                            </div>
                            <div class="kpi-value" id="margem-media">0%</div>
                            <div class="kpi-change">--</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <span class="card-title-icon">üìä</span>
                                    Vendas Recentes
                                </div>
                                <button class="btn btn-primary btn-sm" onclick="showTab('vendas')">Nova Venda</button>
                            </div>
                            <div id="vendas-recentes-dashboard">
                                <div class="empty-state">
                                    <div class="empty-icon">üõí</div>
                                    <h3>Nenhuma venda registrada</h3>
                                    <p>Comece registrando sua primeira venda.</p>
                                    <button class="btn btn-primary" onclick="showTab('vendas')">Registrar Primeira Venda</button>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <span class="card-title-icon">üì¶</span>
                                    Status do Estoque
                                </div>
                                <button class="btn btn-success btn-sm" onclick="showTab('estoque')">Ver Estoque</button>
                            </div>
                            <div id="estoque-dashboard">
                                <div class="empty-state">
                                    <div class="empty-icon">üì¶</div>
                                    <h3>Estoque n√£o configurado</h3>
                                    <p>Configure seus ingredientes primeiro.</p>
                                    <button class="btn btn-success" onclick="showTab('ingredientes')">Configurar Ingredientes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- INGREDIENTES TAB -->
                <div id="tab-ingredientes" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">ü•¨</span>
                                Ingredientes
                            </div>
                            <button class="btn btn-primary" onclick="openIngredienteModal()">‚ûï Adicionar Ingrediente</button>
                        </div>

                        <div class="mb-3">
                            <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 15px; align-items: end;">
                                <div class="form-group mb-0">
                                    <label class="form-label">Buscar ingredientes</label>
                                    <input type="text" class="form-control" id="search-ingredientes" placeholder="Digite o nome do ingrediente..." onkeyup="filterIngredientes()">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Categoria</label>
                                    <select class="form-control" id="filter-categoria-ingredientes" onchange="filterIngredientes()">
                                        <option value="">Todas as categorias</option>
                                        <option value="queijos">Queijos</option>
                                        <option value="carnes">Carnes</option>
                                        <option value="vegetais">Vegetais</option>
                                        <option value="temperos">Temperos</option>
                                        <option value="massas">Massas</option>
                                        <option value="molhos">Molhos</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Ordenar por</label>
                                    <select class="form-control" id="sort-ingredientes" onchange="filterIngredientes()">
                                        <option value="nome">Nome</option>
                                        <option value="categoria">Categoria</option>
                                        <option value="preco">Pre√ßo</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Categoria</th>
                                        <th>Unidade</th>
                                        <th>Pre√ßo</th>
                                        <th>Fornecedor</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="ingredientes-list">
                                    <!-- Ingredientes ser√£o carregados aqui -->
                                </tbody>
                            </table>
                        </div>

                        <div id="ingredientes-empty" class="empty-state d-none">
                            <div class="empty-icon">ü•¨</div>
                            <h3>Nenhum ingrediente cadastrado</h3>
                            <p>Comece adicionando seus primeiros ingredientes ao sistema.</p>
                            <button class="btn btn-primary" onclick="openIngredienteModal()">Adicionar Primeiro Ingrediente</button>
                        </div>
                    </div>
                </div>

                <!-- RECEITAS TAB -->
                <div id="tab-receitas" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">üìù</span>
                                Receitas
                            </div>
                            <button class="btn btn-primary" onclick="openReceitaModal()">‚ûï Nova Receita</button>
                        </div>

                        <div class="mb-3">
                            <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 15px; align-items: end;">
                                <div class="form-group mb-0">
                                    <label class="form-label">Buscar receitas</label>
                                    <input type="text" class="form-control" id="search-receitas" placeholder="Digite o nome da receita..." onkeyup="filterReceitas()">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Categoria</label>
                                    <select class="form-control" id="filter-categoria-receitas" onchange="filterReceitas()">
                                        <option value="">Todas as categorias</option>
                                        <option value="tradicional">Tradicional</option>
                                        <option value="especial">Especial</option>
                                        <option value="premium">Premium</option>
                                        <option value="doce">Doce</option>
                                    </select>
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" id="filter-status-receitas" onchange="filterReceitas()">
                                        <option value="">Todos</option>
                                        <option value="ativa">Ativa</option>
                                        <option value="inativa">Inativa</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Categoria</th>
                                        <th>Tamanhos</th>
                                        <th>Custo M√©dio</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="receitas-list">
                                    <!-- Receitas ser√£o carregadas aqui -->
                                </tbody>
                            </table>
                        </div>

                        <div id="receitas-empty" class="empty-state d-none">
                            <div class="empty-icon">üìù</div>
                            <h3>Nenhuma receita cadastrada</h3>
                            <p>Comece criando suas primeiras receitas de pizza.</p>
                            <button class="btn btn-primary" onclick="openReceitaModal()">Criar Primeira Receita</button>
                        </div>
                    </div>
                </div>

                <!-- CARD√ÅPIO TAB -->
                <div id="tab-cardapio" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">üìã</span>
                                Card√°pio e Precifica√ß√£o
                            </div>
                            <button class="btn btn-warning" onclick="openMargemModal()">‚öôÔ∏è Configurar Margens</button>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div class="card" style="margin: 0;">
                                <div class="card-header" style="margin-bottom: 0;">
                                    <div class="card-title">
                                        <span class="card-title-icon">üöö</span>
                                        Delivery Direto
                                    </div>
                                </div>
                                <div style="padding: 15px;">
                                    <p><strong>Margem:</strong> <span id="margem-direto">150</span>%</p>
                                    <p><strong>Taxa Entrega:</strong> R$ <span id="taxa-entrega">5,00</span></p>
                                </div>
                            </div>

                            <div class="card" style="margin: 0;">
                                <div class="card-header" style="margin-bottom: 0;">
                                    <div class="card-title">
                                        <span class="card-title-icon">üçï</span>
                                        iFood
                                    </div>
                                </div>
                                <div style="padding: 15px;">
                                    <p><strong>Margem L√≠quida:</strong> <span id="margem-ifood">49</span>%</p>
                                    <p><strong>Taxa iFood:</strong> <span id="taxa-ifood">27</span>%</p>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 15px; align-items: end;">
                                <div class="form-group mb-0">
                                    <label class="form-label">Buscar no card√°pio</label>
                                    <input type="text" class="form-control" id="search-cardapio" placeholder="Digite o nome da pizza..." onkeyup="filterCardapio()">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Categoria</label>
                                    <select class="form-control" id="filter-categoria-cardapio" onchange="filterCardapio()">
                                        <option value="">Todas as categorias</option>
                                        <option value="tradicional">Tradicional</option>
                                        <option value="especial">Especial</option>
                                        <option value="premium">Premium</option>
                                        <option value="doce">Doce</option>
                                    </select>
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Ordenar por</label>
                                    <select class="form-control" id="sort-cardapio" onchange="filterCardapio()">
                                        <option value="nome">Nome</option>
                                        <option value="categoria">Categoria</option>
                                        <option value="custo">Custo</option>
                                        <option value="preco-direto">Pre√ßo Direto</option>
                                        <option value="preco-ifood">Pre√ßo iFood</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Pizza</th>
                                        <th>Categoria</th>
                                        <th>Tamanho</th>
                                        <th>Custo</th>
                                        <th>Pre√ßo Direto</th>
                                        <th>Pre√ßo iFood</th>
                                        <th>Margem Direto</th>
                                        <th>Margem iFood</th>
                                        <th>Melhor Canal</th>
                                    </tr>
                                </thead>
                                <tbody id="cardapio-list">
                                    <!-- Card√°pio ser√° carregado aqui -->
                                </tbody>
                            </table>
                        </div>

                        <div id="cardapio-resumo" class="mt-3">
                            <!-- Resumo do card√°pio -->
                        </div>

                        <div id="cardapio-empty" class="empty-state d-none">
                            <div class="empty-icon">üìã</div>
                            <h3>Nenhuma receita no card√°pio</h3>
                            <p>Crie receitas primeiro para gerar o card√°pio automaticamente.</p>
                            <button class="btn btn-primary" onclick="showTab('receitas')">Criar Receitas</button>
                        </div>
                    </div>
                </div>

                <!-- VENDAS TAB -->
                <div id="tab-vendas" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">üí≥</span>
                                Registrar Vendas
                            </div>
                            <button class="btn btn-primary" onclick="openVendaModal()">‚ûï Nova Venda</button>
                        </div>

                        <div class="mb-3">
                            <div style="display: grid; grid-template-columns: auto 1fr auto auto auto; gap: 15px; align-items: end;">
                                <div class="form-group mb-0">
                                    <label class="form-label">Data</label>
                                    <input type="date" class="form-control" id="filter-data-venda" onchange="filterVendas()">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Cliente</label>
                                    <input type="text" class="form-control" id="search-cliente" placeholder="Nome do cliente..." onkeyup="filterVendas()">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Canal</label>
                                    <select class="form-control" id="filter-canal-venda" onchange="filterVendas()">
                                        <option value="">Todos os canais</option>
                                        <option value="direto">Delivery Direto</option>
                                        <option value="ifood">iFood</option>
                                    </select>
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" id="filter-status-venda" onchange="filterVendas()">
                                        <option value="">Todos os status</option>
                                        <option value="concluida">Conclu√≠da</option>
                                        <option value="cancelada">Cancelada</option>
                                    </select>
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Ordenar</label>
                                    <select class="form-control" id="sort-vendas" onchange="filterVendas()">
                                        <option value="data-desc">Mais recentes</option>
                                        <option value="data-asc">Mais antigas</option>
                                        <option value="valor-desc">Maior valor</option>
                                        <option value="valor-asc">Menor valor</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <span class="kpi-title">üìä Hoje</span>
                                </div>
                                <div style="font-size: 0.9em;">
                                    <p><strong>Vendas:</strong> <span id="vendas-hoje-count">0</span></p>
                                    <p><strong>Faturamento:</strong> <span id="vendas-hoje-total">R$ 0,00</span></p>
                                </div>
                            </div>

                            <div class="kpi-card success">
                                <div class="kpi-header">
                                    <span class="kpi-title">üöö Direto</span>
                                </div>
                                <div style="font-size: 0.9em;">
                                    <p><strong>Vendas:</strong> <span id="vendas-direto-count">0</span></p>
                                    <p><strong>Faturamento:</strong> <span id="vendas-direto-total">R$ 0,00</span></p>
                                </div>
                            </div>

                            <div class="kpi-card warning">
                                <div class="kpi-header">
                                    <span class="kpi-title">üçï iFood</span>
                                </div>
                                <div style="font-size: 0.9em;">
                                    <p><strong>Vendas:</strong> <span id="vendas-ifood-count">0</span></p>
                                    <p><strong>Faturamento:</strong> <span id="vendas-ifood-total">R$ 0,00</span></p>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Cliente</th>
                                        <th>Canal</th>
                                        <th>Itens</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="vendas-list">
                                    <!-- Vendas ser√£o carregadas aqui -->
                                </tbody>
                            </table>
                        </div>

                        <div id="vendas-empty" class="empty-state d-none">
                            <div class="empty-icon">üí≥</div>
                            <h3>Nenhuma venda registrada</h3>
                            <p>Comece registrando sua primeira venda do dia.</p>
                            <button class="btn btn-primary" onclick="openVendaModal()">Registrar Primeira Venda</button>
                        </div>
                    </div>
                </div>

                <!-- RESULTADOS TAB -->
                <div id="tab-resultados" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">üìä</span>
                                Resultados Di√°rios
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-secondary" onclick="exportarRelatorio()">üìÑ Exportar</button>
                                <button class="btn btn-primary" onclick="atualizarRelatorios()">üîÑ Atualizar</button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div style="display: grid; grid-template-columns: auto auto auto; gap: 15px; align-items: end;">
                                <div class="form-group mb-0">
                                    <label class="form-label">Data Inicial</label>
                                    <input type="date" class="form-control" id="filter-data-inicial" onchange="atualizarRelatorios()">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Data Final</label>
                                    <input type="date" class="form-control" id="filter-data-final" onchange="atualizarRelatorios()">
                                </div>
                                <div class="form-group mb-0">
                                    <label class="form-label">Per√≠odo</label>
                                    <select class="form-control" id="filter-periodo" onchange="setPeriodoRapido()">
                                        <option value="custom">Personalizado</option>
                                        <option value="hoje">Hoje</option>
                                        <option value="ontem">Ontem</option>
                                        <option value="semana">Esta Semana</option>
                                        <option value="mes">Este M√™s</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <span class="kpi-title">üí∞ Faturamento</span>
                                </div>
                                <div class="kpi-value" id="kpi-faturamento">R$ 0,00</div>
                                <div class="kpi-change" id="kpi-faturamento-variacao">--</div>
                            </div>

                            <div class="kpi-card success">
                                <div class="kpi-header">
                                    <span class="kpi-title">üõí Vendas</span>
                                </div>
                                <div class="kpi-value" id="kpi-vendas">0</div>
                                <div class="kpi-change" id="kpi-vendas-variacao">--</div>
                            </div>

                            <div class="kpi-card warning">
                                <div class="kpi-header">
                                    <span class="kpi-title">üéØ Ticket M√©dio</span>
                                </div>
                                <div class="kpi-value" id="kpi-ticket-medio">R$ 0,00</div>
                                <div class="kpi-change" id="kpi-ticket-variacao">--</div>
                            </div>

                            <div class="kpi-card danger">
                                <div class="kpi-header">
                                    <span class="kpi-title">üìà Margem M√©dia</span>
                                </div>
                                <div class="kpi-value" id="kpi-margem-media">0%</div>
                                <div class="kpi-change" id="kpi-margem-variacao">--</div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div class="card" style="margin: 0;">
                                <div class="card-header" style="margin-bottom: 0;">
                                    <div class="card-title">
                                        <span class="card-title-icon">üìä</span>
                                        Performance por Canal
                                    </div>
                                </div>
                                <div id="analise-canais" style="padding: 15px;">
                                    <div class="empty-state">
                                        <p>Dados insuficientes para an√°lise</p>
                                    </div>
                                </div>
                            </div>

                            <div class="card" style="margin: 0;">
                                <div class="card-header" style="margin-bottom: 0;">
                                    <div class="card-title">
                                        <span class="card-title-icon">üèÜ</span>
                                        Top Produtos
                                    </div>
                                </div>
                                <div id="top-produtos" style="padding: 15px;">
                                    <div class="empty-state">
                                        <p>Nenhuma venda registrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <span class="card-title-icon">üìà</span>
                                    Evolu√ß√£o das Vendas
                                </div>
                            </div>
                            <div id="grafico-vendas" style="padding: 20px; height: 300px;">
                                <div class="empty-state">
                                    <div class="empty-icon">üìà</div>
                                    <h3>Gr√°fico de Vendas</h3>
                                    <p>Registre vendas para visualizar a evolu√ß√£o.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ESTOQUE TAB -->
                <div id="tab-estoque" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">üì¶</span>
                                Controle de Estoque
                            </div>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">üì¶</div>
                            <h3>M√≥dulo de Estoque</h3>
                            <p>Em desenvolvimento...</p>
                        </div>
                    </div>
                </div>

                <!-- COMPRAS TAB -->
                <div id="tab-compras" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">üõí</span>
                                Compras
                            </div>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">üõí</div>
                            <h3>M√≥dulo de Compras</h3>
                            <p>Em desenvolvimento...</p>
                        </div>
                    </div>
                </div>

                <!-- CUSTOS TAB -->
                <div id="tab-custos" class="tab-content d-none">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="card-title-icon">üí∞</span>
                                Custos Operacionais
                            </div>
                        </div>
                        <div class="empty-state">
                            <div class="empty-icon">üí∞</div>
                            <h3>M√≥dulo de Custos</h3>
                            <p>Em desenvolvimento...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toast-container"></div>

    <!-- MODALS -->
    <!-- Modal Ingrediente -->
    <div class="modal" id="ingrediente-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="ingrediente-modal-title">Adicionar Ingrediente</h3>
                <button class="modal-close" onclick="closeIngredienteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="ingrediente-form">
                    <input type="hidden" id="ingrediente-id">
                    
                    <div class="form-group">
                        <label class="form-label">Nome do Ingrediente *</label>
                        <input type="text" class="form-control" id="ingrediente-nome" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select class="form-control" id="ingrediente-categoria" required>
                            <option value="">Selecione a categoria</option>
                            <option value="queijos">Queijos</option>
                            <option value="carnes">Carnes</option>
                            <option value="vegetais">Vegetais</option>
                            <option value="temperos">Temperos</option>
                            <option value="massas">Massas</option>
                            <option value="molhos">Molhos</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Unidade de Medida *</label>
                        <select class="form-control" id="ingrediente-unidade" required>
                            <option value="">Selecione a unidade</option>
                            <option value="kg">Quilograma (kg)</option>
                            <option value="g">Grama (g)</option>
                            <option value="l">Litro (l)</option>
                            <option value="ml">Mililitro (ml)</option>
                            <option value="un">Unidade (un)</option>
                            <option value="pct">Pacote (pct)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Pre√ßo por Unidade *</label>
                        <input type="number" class="form-control" id="ingrediente-preco" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Fornecedor</label>
                        <input type="text" class="form-control" id="ingrediente-fornecedor" placeholder="Nome do fornecedor">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeIngredienteModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveIngrediente()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Receita -->
    <div class="modal" id="receita-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="receita-modal-title">Nova Receita</h3>
                <button class="modal-close" onclick="closeReceitaModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="receita-form">
                    <input type="hidden" id="receita-id">
                    
                    <div class="form-group">
                        <label class="form-label">Nome da Pizza *</label>
                        <input type="text" class="form-control" id="receita-nome" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select class="form-control" id="receita-categoria" required>
                            <option value="">Selecione a categoria</option>
                            <option value="tradicional">Tradicional</option>
                            <option value="especial">Especial</option>
                            <option value="premium">Premium</option>
                            <option value="doce">Doce</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <textarea class="form-control" id="receita-descricao" rows="3" placeholder="Descreva os ingredientes e caracter√≠sticas da pizza"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-control" id="receita-status">
                            <option value="ativa">Ativa</option>
                            <option value="inativa">Inativa</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ingredientes da Receita</label>
                        <div id="receita-ingredientes">
                            <!-- Ingredientes ser√£o adicionados aqui -->
                        </div>
                        <button type="button" class="btn btn-success btn-sm" onclick="addIngredienteToReceita()">‚ûï Adicionar Ingrediente</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeReceitaModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveReceita()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Venda -->
    <div class="modal" id="venda-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Registrar Nova Venda</h3>
                <button class="modal-close" onclick="closeVendaModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="venda-form">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">Data da Venda *</label>
                            <input type="date" class="form-control" id="venda-data" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Canal de Venda *</label>
                            <select class="form-control" id="venda-canal" required onchange="updateVendaPrecos()">
                                <option value="">Selecione o canal</option>
                                <option value="direto">üöö Delivery Direto</option>
                                <option value="ifood">üçï iFood</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cliente (Opcional)</label>
                        <input type="text" class="form-control" id="venda-cliente" placeholder="Nome do cliente">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Itens da Venda</label>
                        <div id="venda-itens">
                            <div class="venda-item" style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                <select class="form-control" onchange="updateItemPreco(this)">
                                    <option value="">Selecione a pizza</option>
                                </select>
                                <input type="number" class="form-control" placeholder="Qtd" min="1" value="1" onchange="updateItemSubtotal(this)">
                                <input type="number" class="form-control" placeholder="Pre√ßo Unit." step="0.01" min="0" onchange="updateItemSubtotal(this)">
                                <button type="button" class="btn btn-danger btn-sm" onclick="removeVendaItem(this)">üóëÔ∏è</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-success btn-sm" onclick="addVendaItem()">‚ûï Adicionar Item</button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea class="form-control" id="venda-observacoes" rows="2" placeholder="Observa√ß√µes da venda..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Resumo da Venda</label>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Subtotal:</span>
                                <span id="venda-subtotal">R$ 0,00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Taxa Entrega:</span>
                                <span id="venda-taxa-entrega">R$ 0,00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1em; border-top: 1px solid #ddd; padding-top: 5px;">
                                <span>Total:</span>
                                <span id="venda-total">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeVendaModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveVenda()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal Margens -->
    <div class="modal" id="margem-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Configurar Margens e Taxas</h3>
                <button class="modal-close" onclick="closeMargemModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="margem-form">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4>üöö Delivery Direto</h4>
                            <div class="form-group">
                                <label class="form-label">Margem de Lucro (%)</label>
                                <input type="number" class="form-control" id="margem-direto-input" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Taxa de Entrega (R$)</label>
                                <input type="number" class="form-control" id="taxa-entrega-input" min="0" step="0.01">
                            </div>
                        </div>

                        <div>
                            <h4>üçï iFood</h4>
                            <div class="form-group">
                                <label class="form-label">Margem L√≠quida Desejada (%)</label>
                                <input type="number" class="form-control" id="margem-ifood-input" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Taxa do iFood (%)</label>
                                <input type="number" class="form-control" id="taxa-ifood-input" min="0" step="1">
                            </div>
                        </div>
                    </div>

                    <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin-top: 20px;">
                        <h5>üí° Como funciona:</h5>
                        <p><strong>Delivery Direto:</strong> Pre√ßo = (Custo √ó (1 + Margem/100)) + Taxa Entrega</p>
                        <p><strong>iFood:</strong> Pre√ßo = Custo √∑ ((1 - Taxa iFood/100) √ó (1 - Margem L√≠quida/100))</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMargemModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveMargens()">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        console.log('Inicializando Pizzaria Pro v3.0.0');
        
        // ========================================
        // VARI√ÅVEIS GLOBAIS
        // ========================================
        let ingredientes = [];
        let receitas = [];
        let vendas = [];
        let configuracoes = {
            margemDireto: 150,
            taxaEntrega: 5.00,
            margemIfood: 49,
            taxaIfood: 27
        };

        // ========================================
        // SISTEMA DE STORAGE
        // ========================================
        const storage = {
            save: function(key, data) {
                try {
                    localStorage.setItem('pizzaria_pro_' + key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    return false;
                }
            },

            load: function(key, defaultValue = null) {
                try {
                    const data = localStorage.getItem('pizzaria_pro_' + key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    return defaultValue;
                }
            },

            remove: function(key) {
                try {
                    localStorage.removeItem('pizzaria_pro_' + key);
                    return true;
                } catch (error) {
                    console.error('Erro ao remover dados:', error);
                    return false;
                }
            }
        };

        // ========================================
        // SISTEMA DE TOAST
        // ========================================
        const toast = {
            show: function(message, type = 'info', duration = 3000) {
                const container = document.getElementById('toast-container');
                const toastEl = document.createElement('div');
                toastEl.className = `toast ${type}`;
                toastEl.innerHTML = `
                    <span>${message}</span>
                    <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
                `;
                
                container.appendChild(toastEl);
                
                setTimeout(() => {
                    if (toastEl.parentElement) {
                        toastEl.remove();
                    }
                }, duration);
            },

            success: function(message) {
                this.show(message, 'success');
            },

            error: function(message) {
                this.show(message, 'error');
            },

            warning: function(message) {
                this.show(message, 'warning');
            }
        };

        // ========================================
        // SISTEMA DE MODAL
        // ========================================
        const modal = {
            show: function(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('show');
                }
            },

            hide: function(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('show');
                }
            },

            confirm: function(message, callback) {
                if (confirm(message)) {
                    callback();
                }
            }
        };

        // ========================================
        // NAVEGA√á√ÉO
        // ========================================
        function showSection(sectionName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.add('d-none'));
            
            // Show selected tab
            const selectedTab = document.getElementById(`tab-${sectionName}`);
            if (selectedTab) {
                selectedTab.classList.remove('d-none');
            }
            
            // Update sidebar active state
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            
            const activeItem = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // Update header
            updateContentHeader(sectionName);
            
            // Load specific tab data
            switch(sectionName) {
                case 'ingredientes':
                    loadIngredientes();
                    break;
                case 'receitas':
                    loadReceitas();
                    break;
                case 'cardapio':
                    loadCardapio();
                    break;
                case 'vendas':
                    loadVendas();
                    break;
                case 'resultados':
                    loadRelatorios();
                    break;
                case 'dashboard':
                    updateDashboardKPIs();
                    break;
            }
        }
        
        // Alias para compatibilidade
        function showTab(tabName) {
            showSection(tabName);
        }

        function updateContentHeader(tabName) {
            const headers = {
                'dashboard': { title: 'üìä Dashboard - Vis√£o Geral', subtitle: 'Monitore os indicadores-chave da sua opera√ß√£o' },
                'ingredientes': { title: 'ü•¨ Ingredientes', subtitle: 'Gerencie os ingredientes das suas pizzas' },
                'receitas': { title: 'üìù Receitas', subtitle: 'Crie e gerencie suas receitas de pizza' },
                'cardapio': { title: 'üìã Card√°pio', subtitle: 'Visualize pre√ßos e margens por canal' },
                'vendas': { title: 'üí≥ Registrar Vendas', subtitle: 'Registre vendas e acompanhe a performance' },
                'resultados': { title: 'üìä Resultados Di√°rios', subtitle: 'Controle de faturamento e metas di√°rias' },
                'estoque': { title: 'üì¶ Controle de Estoque', subtitle: 'Gerencie o estoque de ingredientes' },
                'compras': { title: 'üõí Compras', subtitle: 'Controle de compras e fornecedores' },
                'custos': { title: 'üí∞ Custos Operacionais', subtitle: 'Controle de custos fixos e vari√°veis' }
            };
            
            const header = headers[tabName] || headers['dashboard'];
            document.getElementById('header-title').textContent = header.title;
            document.getElementById('header-subtitle').textContent = header.subtitle;
        }

        // ========================================
        // UTILIT√ÅRIOS
        // ========================================
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value || 0);
        }

        function formatDate(dateString) {
            return new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function getCurrentDate() {
            return new Date().toISOString().split('T')[0];
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // ========================================
        // M√ìDULO DE INGREDIENTES
        // ========================================
        function loadIngredientes() {
            renderIngredientesList();
        }

        function renderIngredientesList() {
            const tbody = document.getElementById('ingredientes-list');
            const emptyState = document.getElementById('ingredientes-empty');
            
            if (ingredientes.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('d-none');
                return;
            }
            
            emptyState.classList.add('d-none');
            
            let filteredIngredientes = [...ingredientes];
            
            // Apply filters
            const searchTerm = document.getElementById('search-ingredientes')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('filter-categoria-ingredientes')?.value || '';
            const sortBy = document.getElementById('sort-ingredientes')?.value || 'nome';
            
            if (searchTerm) {
                filteredIngredientes = filteredIngredientes.filter(ing => 
                    ing.nome.toLowerCase().includes(searchTerm)
                );
            }
            
            if (categoryFilter) {
                filteredIngredientes = filteredIngredientes.filter(ing => 
                    ing.categoria === categoryFilter
                );
            }
            
            // Sort
            filteredIngredientes.sort((a, b) => {
                switch(sortBy) {
                    case 'categoria':
                        return a.categoria.localeCompare(b.categoria);
                    case 'preco':
                        return (a.preco || 0) - (b.preco || 0);
                    default:
                        return a.nome.localeCompare(b.nome);
                }
            });
            
            tbody.innerHTML = filteredIngredientes.map(ingrediente => `
                <tr>
                    <td><strong>${ingrediente.nome}</strong></td>
                    <td><span class="badge badge-primary">${ingrediente.categoria}</span></td>
                    <td>${ingrediente.unidade}</td>
                    <td><strong>${formatCurrency(ingrediente.preco)}</strong></td>
                    <td>${ingrediente.fornecedor || '-'}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editIngrediente('${ingrediente.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteIngrediente('${ingrediente.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterIngredientes() {
            renderIngredientesList();
        }

        function openIngredienteModal(id = null) {
            const modal = document.getElementById('ingrediente-modal');
            const title = document.getElementById('ingrediente-modal-title');
            const form = document.getElementById('ingrediente-form');
            
            form.reset();
            
            if (id) {
                const ingrediente = ingredientes.find(i => i.id === id);
                if (ingrediente) {
                    title.textContent = 'Editar Ingrediente';
                    document.getElementById('ingrediente-id').value = ingrediente.id;
                    document.getElementById('ingrediente-nome').value = ingrediente.nome;
                    document.getElementById('ingrediente-categoria').value = ingrediente.categoria;
                    document.getElementById('ingrediente-unidade').value = ingrediente.unidade;
                    document.getElementById('ingrediente-preco').value = ingrediente.preco;
                    document.getElementById('ingrediente-fornecedor').value = ingrediente.fornecedor || '';
                }
            } else {
                title.textContent = 'Adicionar Ingrediente';
                document.getElementById('ingrediente-id').value = '';
            }
            
            modal.classList.add('show');
        }

        function closeIngredienteModal() {
            document.getElementById('ingrediente-modal').classList.remove('show');
        }

        function saveIngrediente() {
            const form = document.getElementById('ingrediente-form');
            const formData = new FormData(form);
            
            const ingrediente = {
                id: document.getElementById('ingrediente-id').value || generateId(),
                nome: document.getElementById('ingrediente-nome').value.trim(),
                categoria: document.getElementById('ingrediente-categoria').value,
                unidade: document.getElementById('ingrediente-unidade').value,
                preco: parseFloat(document.getElementById('ingrediente-preco').value) || 0,
                fornecedor: document.getElementById('ingrediente-fornecedor').value.trim()
            };
            
            // Validation
            if (!ingrediente.nome || !ingrediente.categoria || !ingrediente.unidade || ingrediente.preco <= 0) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            const existingIndex = ingredientes.findIndex(i => i.id === ingrediente.id);
            
            if (existingIndex >= 0) {
                ingredientes[existingIndex] = ingrediente;
                toast.success('Ingrediente atualizado com sucesso!');
            } else {
                ingredientes.push(ingrediente);
                toast.success('Ingrediente adicionado com sucesso!');
            }
            
            storage.save('ingredientes', ingredientes);
            renderIngredientesList();
            closeIngredienteModal();
        }

        function editIngrediente(id) {
            openIngredienteModal(id);
        }

        function deleteIngrediente(id) {
            const ingrediente = ingredientes.find(i => i.id === id);
            if (!ingrediente) return;
            
            modal.confirm(
                `Tem certeza que deseja excluir o ingrediente "${ingrediente.nome}"?`,
                function() {
                    ingredientes = ingredientes.filter(i => i.id !== id);
                    storage.save('ingredientes', ingredientes);
                    renderIngredientesList();
                    toast.success('Ingrediente exclu√≠do com sucesso!');
                }
            );
        }

        // ========================================
        // M√ìDULO DE RECEITAS
        // ========================================
        function loadReceitas() {
            renderReceitasList();
        }

        function renderReceitasList() {
            const tbody = document.getElementById('receitas-list');
            const emptyState = document.getElementById('receitas-empty');
            
            if (receitas.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('d-none');
                return;
            }
            
            emptyState.classList.add('d-none');
            
            let filteredReceitas = [...receitas];
            
            // Apply filters
            const searchTerm = document.getElementById('search-receitas')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('filter-categoria-receitas')?.value || '';
            const statusFilter = document.getElementById('filter-status-receitas')?.value || '';
            
            if (searchTerm) {
                filteredReceitas = filteredReceitas.filter(rec => 
                    rec.nome.toLowerCase().includes(searchTerm)
                );
            }
            
            if (categoryFilter) {
                filteredReceitas = filteredReceitas.filter(rec => 
                    rec.categoria === categoryFilter
                );
            }
            
            if (statusFilter) {
                filteredReceitas = filteredReceitas.filter(rec => 
                    rec.status === statusFilter
                );
            }
            
            tbody.innerHTML = filteredReceitas.map(receita => {
                const tamanhos = receita.tamanhos ? Object.keys(receita.tamanhos).join(', ') : 'N√£o configurado';
                const custoMedio = receita.tamanhos ? 
                    Object.values(receita.tamanhos).reduce((acc, t) => acc + (t.custoTotal || 0), 0) / Object.keys(receita.tamanhos).length : 0;
                
                return `
                    <tr>
                        <td>
                            <strong>${receita.nome}</strong>
                            <br><small class="text-muted">${receita.descricao || ''}</small>
                        </td>
                        <td><span class="badge badge-primary">${receita.categoria}</span></td>
                        <td>${tamanhos}</td>
                        <td><strong>${formatCurrency(custoMedio)}</strong></td>
                        <td>
                            <span class="badge ${receita.status === 'ativa' ? 'badge-success' : 'badge-secondary'}">
                                ${receita.status === 'ativa' ? 'Ativa' : 'Inativa'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editReceita('${receita.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteReceita('${receita.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterReceitas() {
            renderReceitasList();
        }

        function openReceitaModal(id = null) {
            const modal = document.getElementById('receita-modal');
            const title = document.getElementById('receita-modal-title');
            const form = document.getElementById('receita-form');
            
            form.reset();
            
            if (id) {
                const receita = receitas.find(r => r.id === id);
                if (receita) {
                    title.textContent = 'Editar Receita';
                    document.getElementById('receita-id').value = receita.id;
                    document.getElementById('receita-nome').value = receita.nome;
                    document.getElementById('receita-categoria').value = receita.categoria;
                    document.getElementById('receita-descricao').value = receita.descricao || '';
                    document.getElementById('receita-status').value = receita.status || 'ativa';
                    
                    // Load ingredientes da receita
                    renderReceitaIngredientes(receita.ingredientes || []);
                }
            } else {
                title.textContent = 'Nova Receita';
                document.getElementById('receita-id').value = '';
                renderReceitaIngredientes([]);
            }
            
            modal.classList.add('show');
        }

        function closeReceitaModal() {
            document.getElementById('receita-modal').classList.remove('show');
        }

        function renderReceitaIngredientes(receitaIngredientes = []) {
            const container = document.getElementById('receita-ingredientes');
            
            if (ingredientes.length === 0) {
                container.innerHTML = '<p class="text-muted">Cadastre ingredientes primeiro para criar receitas.</p>';
                return;
            }
            
            container.innerHTML = receitaIngredientes.map((item, index) => `
                <div class="receita-ingrediente-item" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 10px; align-items: center; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <select class="form-control" data-index="${index}">
                        <option value="">Selecione o ingrediente</option>
                        ${ingredientes.map(ing => `
                            <option value="${ing.id}" ${item.ingredienteId === ing.id ? 'selected' : ''}>
                                ${ing.nome} (${ing.unidade})
                            </option>
                        `).join('')}
                    </select>
                    <input type="number" class="form-control" placeholder="Qtd P" step="0.001" min="0" value="${item.quantidades?.pequena || ''}" data-tamanho="pequena">
                    <input type="number" class="form-control" placeholder="Qtd M" step="0.001" min="0" value="${item.quantidades?.media || ''}" data-tamanho="media">
                    <input type="number" class="form-control" placeholder="Qtd G" step="0.001" min="0" value="${item.quantidades?.grande || ''}" data-tamanho="grande">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeIngredienteFromReceita(this)">üóëÔ∏è</button>
                </div>
            `).join('');
            
            if (receitaIngredientes.length === 0) {
                addIngredienteToReceita();
            }
        }

        function addIngredienteToReceita() {
            const container = document.getElementById('receita-ingredientes');
            const index = container.children.length;
            
            const div = document.createElement('div');
            div.className = 'receita-ingrediente-item';
            div.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 10px; align-items: center; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;';
            
            div.innerHTML = `
                <select class="form-control" data-index="${index}">
                    <option value="">Selecione o ingrediente</option>
                    ${ingredientes.map(ing => `
                        <option value="${ing.id}">${ing.nome} (${ing.unidade})</option>
                    `).join('')}
                </select>
                <input type="number" class="form-control" placeholder="Qtd P" step="0.001" min="0" data-tamanho="pequena">
                <input type="number" class="form-control" placeholder="Qtd M" step="0.001" min="0" data-tamanho="media">
                <input type="number" class="form-control" placeholder="Qtd G" step="0.001" min="0" data-tamanho="grande">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeIngredienteFromReceita(this)">üóëÔ∏è</button>
            `;
            
            container.appendChild(div);
        }

        function removeIngredienteFromReceita(button) {
            button.parentElement.remove();
        }

        function saveReceita() {
            const receita = {
                id: document.getElementById('receita-id').value || generateId(),
                nome: document.getElementById('receita-nome').value.trim(),
                categoria: document.getElementById('receita-categoria').value,
                descricao: document.getElementById('receita-descricao').value.trim(),
                status: document.getElementById('receita-status').value || 'ativa',
                ingredientes: [],
                tamanhos: {
                    pequena: { custoTotal: 0 },
                    media: { custoTotal: 0 },
                    grande: { custoTotal: 0 }
                }
            };
            
            // Validation
            if (!receita.nome || !receita.categoria) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            // Collect ingredientes
            const ingredienteItems = document.querySelectorAll('.receita-ingrediente-item');
            
            ingredienteItems.forEach(item => {
                const select = item.querySelector('select');
                const ingredienteId = select.value;
                
                if (ingredienteId) {
                    const ingrediente = ingredientes.find(i => i.id === ingredienteId);
                    if (ingrediente) {
                        const quantidades = {
                            pequena: parseFloat(item.querySelector('[data-tamanho="pequena"]').value) || 0,
                            media: parseFloat(item.querySelector('[data-tamanho="media"]').value) || 0,
                            grande: parseFloat(item.querySelector('[data-tamanho="grande"]').value) || 0
                        };
                        
                        receita.ingredientes.push({
                            ingredienteId: ingredienteId,
                            ingredienteNome: ingrediente.nome,
                            quantidades: quantidades
                        });
                        
                        // Calculate costs
                        Object.keys(quantidades).forEach(tamanho => {
                            const quantidade = quantidades[tamanho];
                            if (quantidade > 0) {
                                receita.tamanhos[tamanho].custoTotal += quantidade * ingrediente.preco;
                            }
                        });
                    }
                }
            });
            
            if (receita.ingredientes.length === 0) {
                toast.error('Adicione pelo menos um ingrediente √† receita');
                return;
            }
            
            const existingIndex = receitas.findIndex(r => r.id === receita.id);
            
            if (existingIndex >= 0) {
                receitas[existingIndex] = receita;
                toast.success('Receita atualizada com sucesso!');
            } else {
                receitas.push(receita);
                toast.success('Receita criada com sucesso!');
            }
            
            storage.save('receitas', receitas);
            renderReceitasList();
            closeReceitaModal();
            
            // Update card√°pio if visible
            if (!document.getElementById('tab-cardapio').classList.contains('d-none')) {
                loadCardapio();
            }
        }

        function editReceita(id) {
            openReceitaModal(id);
        }

        function deleteReceita(id) {
            const receita = receitas.find(r => r.id === id);
            if (!receita) return;
            
            modal.confirm(
                `Tem certeza que deseja excluir a receita "${receita.nome}"?`,
                function() {
                    receitas = receitas.filter(r => r.id !== id);
                    storage.save('receitas', receitas);
                    renderReceitasList();
                    toast.success('Receita exclu√≠da com sucesso!');
                    
                    // Update card√°pio if visible
                    if (!document.getElementById('tab-cardapio').classList.contains('d-none')) {
                        loadCardapio();
                    }
                }
            );
        }

        // ========================================
        // M√ìDULO DE CARD√ÅPIO
        // ========================================
        function loadCardapio() {
            loadConfiguracoes();
            renderCardapio();
        }

        function loadConfiguracoes() {
            const savedConfig = storage.load('configuracoes', configuracoes);
            configuracoes = { ...configuracoes, ...savedConfig };
            
            // Update display
            document.getElementById('margem-direto').textContent = configuracoes.margemDireto;
            document.getElementById('taxa-entrega').textContent = configuracoes.taxaEntrega.toFixed(2);
            document.getElementById('margem-ifood').textContent = configuracoes.margemIfood;
            document.getElementById('taxa-ifood').textContent = configuracoes.taxaIfood;
        }

        function renderCardapio() {
            const tbody = document.getElementById('cardapio-list');
            const emptyState = document.getElementById('cardapio-empty');
            const resumo = document.getElementById('cardapio-resumo');
            
            if (receitas.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('d-none');
                resumo.innerHTML = '';
                return;
            }
            
            emptyState.classList.add('d-none');
            
            let cardapioItems = [];
            
            receitas.forEach(receita => {
                if (receita.status === 'ativa' && receita.tamanhos) {
                    Object.keys(receita.tamanhos).forEach(tamanho => {
                        const tamanhoData = receita.tamanhos[tamanho];
                        const custo = tamanhoData.custoTotal || 0;
                        
                        if (custo > 0) {
                            const precoDireto = calcularPrecoDireto(custo);
                            const precoIfood = calcularPrecoIfood(custo);
                            const margemDireto = calcularMargem(custo, precoDireto);
                            const margemIfood = calcularMargem(custo, precoIfood);
                            
                            cardapioItems.push({
                                receita: receita,
                                tamanho: tamanho,
                                custo: custo,
                                precoDireto: precoDireto,
                                precoIfood: precoIfood,
                                margemDireto: margemDireto,
                                margemIfood: margemIfood,
                                melhorCanal: margemDireto > margemIfood ? 'direto' : 'ifood'
                            });
                        }
                    });
                }
            });
            
            // Apply filters
            const searchTerm = document.getElementById('search-cardapio')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('filter-categoria-cardapio')?.value || '';
            const sortBy = document.getElementById('sort-cardapio')?.value || 'nome';
            
            if (searchTerm) {
                cardapioItems = cardapioItems.filter(item => 
                    item.receita.nome.toLowerCase().includes(searchTerm)
                );
            }
            
            if (categoryFilter) {
                cardapioItems = cardapioItems.filter(item => 
                    item.receita.categoria === categoryFilter
                );
            }
            
            // Sort
            cardapioItems.sort((a, b) => {
                switch(sortBy) {
                    case 'categoria':
                        return a.receita.categoria.localeCompare(b.receita.categoria);
                    case 'custo':
                        return a.custo - b.custo;
                    case 'preco-direto':
                        return a.precoDireto - b.precoDireto;
                    case 'preco-ifood':
                        return a.precoIfood - b.precoIfood;
                    default:
                        return a.receita.nome.localeCompare(b.receita.nome);
                }
            });
            
            tbody.innerHTML = cardapioItems.map(item => `
                <tr>
                    <td>
                        <strong>${item.receita.nome}</strong>
                        <br><small class="text-muted">${item.receita.descricao || ''}</small>
                    </td>
                    <td><span class="badge badge-primary">${item.receita.categoria}</span></td>
                    <td>${item.tamanho.charAt(0).toUpperCase() + item.tamanho.slice(1)}</td>
                    <td><strong>${formatCurrency(item.custo)}</strong></td>
                    <td><strong>${formatCurrency(item.precoDireto)}</strong></td>
                    <td><strong>${formatCurrency(item.precoIfood)}</strong></td>
                    <td><span class="text-success">${item.margemDireto.toFixed(1)}%</span></td>
                    <td><span class="text-warning">${item.margemIfood.toFixed(1)}%</span></td>
                    <td>
                        <span class="badge ${item.melhorCanal === 'direto' ? 'badge-success' : 'badge-warning'}">
                            ${item.melhorCanal === 'direto' ? `Direto (${item.margemDireto.toFixed(1)}%)` : `iFood (${item.margemIfood.toFixed(1)}%)`}
                        </span>
                    </td>
                </tr>
            `).join('');
            
            // Render resumo
            renderCardapioResumo(cardapioItems);
        }

        function renderCardapioResumo(items) {
            const resumo = document.getElementById('cardapio-resumo');
            
            if (items.length === 0) {
                resumo.innerHTML = '';
                return;
            }
            
            const totalItens = items.length;
            const receitasAtivas = [...new Set(items.map(item => item.receita.id))].length;
            
            const margemMediaDireto = items.reduce((acc, item) => acc + item.margemDireto, 0) / totalItens;
            const margemMediaIfood = items.reduce((acc, item) => acc + item.margemIfood, 0) / totalItens;
            
            const ticketMedioDireto = items.reduce((acc, item) => acc + item.precoDireto, 0) / totalItens;
            const ticketMedioIfood = items.reduce((acc, item) => acc + item.precoIfood, 0) / totalItens;
            
            resumo.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-title-icon">üìä</span>
                            Resumo Geral
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; padding: 20px;">
                        <div>
                            <p><strong>Total de Itens:</strong> ${totalItens}</p>
                            <p><strong>Receitas Ativas:</strong> ${receitasAtivas}</p>
                        </div>
                        <div>
                            <h5>üöö Delivery Direto</h5>
                            <p><strong>Margem M√©dia:</strong> ${margemMediaDireto.toFixed(1)}%</p>
                            <p><strong>Ticket M√©dio:</strong> ${formatCurrency(ticketMedioDireto)}</p>
                        </div>
                        <div>
                            <h5>üçï iFood</h5>
                            <p><strong>Margem M√©dia:</strong> ${margemMediaIfood.toFixed(1)}%</p>
                            <p><strong>Ticket M√©dio:</strong> ${formatCurrency(ticketMedioIfood)}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterCardapio() {
            renderCardapio();
        }

        function calcularPrecoDireto(custo) {
            return (custo * (1 + configuracoes.margemDireto / 100)) + configuracoes.taxaEntrega;
        }

        function calcularPrecoIfood(custo) {
            return custo / ((1 - configuracoes.taxaIfood / 100) * (1 - configuracoes.margemIfood / 100));
        }

        function calcularMargem(custo, preco) {
            if (custo === 0) return 0;
            return ((preco - custo) / custo) * 100;
        }

        function openMargemModal() {
            document.getElementById('margem-direto-input').value = configuracoes.margemDireto;
            document.getElementById('taxa-entrega-input').value = configuracoes.taxaEntrega;
            document.getElementById('margem-ifood-input').value = configuracoes.margemIfood;
            document.getElementById('taxa-ifood-input').value = configuracoes.taxaIfood;
            
            modal.show('margem-modal');
        }

        function closeMargemModal() {
            modal.hide('margem-modal');
        }

        function saveMargens() {
            configuracoes.margemDireto = parseFloat(document.getElementById('margem-direto-input').value) || 150;
            configuracoes.taxaEntrega = parseFloat(document.getElementById('taxa-entrega-input').value) || 5.00;
            configuracoes.margemIfood = parseFloat(document.getElementById('margem-ifood-input').value) || 49;
            configuracoes.taxaIfood = parseFloat(document.getElementById('taxa-ifood-input').value) || 27;
            
            storage.save('configuracoes', configuracoes);
            loadConfiguracoes();
            renderCardapio();
            closeMargemModal();
            
            toast.success('Configura√ß√µes salvas com sucesso!');
        }

        // ========================================
        // M√ìDULO DE VENDAS
        // ========================================
        function loadVendas() {
            renderVendasList();
            updateVendasResumo();
            
            // Set today's date as default filter
            document.getElementById('filter-data-venda').value = getCurrentDate();
        }

        function renderVendasList() {
            const tbody = document.getElementById('vendas-list');
            const emptyState = document.getElementById('vendas-empty');
            
            if (vendas.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('d-none');
                return;
            }
            
            emptyState.classList.add('d-none');
            
            let filteredVendas = [...vendas];
            
            // Apply filters
            const dataFilter = document.getElementById('filter-data-venda')?.value || '';
            const clienteFilter = document.getElementById('search-cliente')?.value.toLowerCase() || '';
            const canalFilter = document.getElementById('filter-canal-venda')?.value || '';
            const statusFilter = document.getElementById('filter-status-venda')?.value || '';
            const sortBy = document.getElementById('sort-vendas')?.value || 'data-desc';
            
            if (dataFilter) {
                filteredVendas = filteredVendas.filter(venda => venda.data === dataFilter);
            }
            
            if (clienteFilter) {
                filteredVendas = filteredVendas.filter(venda => 
                    (venda.cliente || '').toLowerCase().includes(clienteFilter)
                );
            }
            
            if (canalFilter) {
                filteredVendas = filteredVendas.filter(venda => venda.canal === canalFilter);
            }
            
            if (statusFilter) {
                filteredVendas = filteredVendas.filter(venda => venda.status === statusFilter);
            }
            
            // Sort
            filteredVendas.sort((a, b) => {
                switch(sortBy) {
                    case 'data-asc':
                        return a.data.localeCompare(b.data);
                    case 'valor-desc':
                        return b.valorTotal - a.valorTotal;
                    case 'valor-asc':
                        return a.valorTotal - b.valorTotal;
                    default: // data-desc
                        return b.data.localeCompare(a.data) || b.id.localeCompare(a.id);
                }
            });
            
            tbody.innerHTML = filteredVendas.map(venda => `
                <tr>
                    <td>${formatDate(venda.data)}</td>
                    <td>${venda.cliente || '-'}</td>
                    <td>
                        <span class="badge ${venda.canal === 'direto' ? 'badge-success' : 'badge-warning'}">
                            ${venda.canal === 'direto' ? 'üöö Direto' : 'üçï iFood'}
                        </span>
                    </td>
                    <td>${venda.itens.length} item(s)</td>
                    <td><strong>${formatCurrency(venda.valorTotal)}</strong></td>
                    <td>
                        <span class="badge ${venda.status === 'concluida' ? 'badge-success' : 'badge-danger'}">
                            ${venda.status === 'concluida' ? 'Conclu√≠da' : 'Cancelada'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="viewVenda('${venda.id}')">üëÅÔ∏è</button>
                        ${venda.status === 'concluida' ? 
                            `<button class="btn btn-danger btn-sm" onclick="cancelVenda('${venda.id}')">‚ùå</button>` : 
                            ''
                        }
                    </td>
                </tr>
            `).join('');
        }

        function updateVendasResumo() {
            const hoje = getCurrentDate();
            const vendasHoje = vendas.filter(v => v.data === hoje && v.status === 'concluida');
            const vendasDireto = vendasHoje.filter(v => v.canal === 'direto');
            const vendasIfood = vendasHoje.filter(v => v.canal === 'ifood');
            
            const totalHoje = vendasHoje.reduce((acc, v) => acc + v.valorTotal, 0);
            const totalDireto = vendasDireto.reduce((acc, v) => acc + v.valorTotal, 0);
            const totalIfood = vendasIfood.reduce((acc, v) => acc + v.valorTotal, 0);
            
            document.getElementById('vendas-hoje-count').textContent = vendasHoje.length;
            document.getElementById('vendas-hoje-total').textContent = formatCurrency(totalHoje);
            document.getElementById('vendas-direto-count').textContent = vendasDireto.length;
            document.getElementById('vendas-direto-total').textContent = formatCurrency(totalDireto);
            document.getElementById('vendas-ifood-count').textContent = vendasIfood.length;
            document.getElementById('vendas-ifood-total').textContent = formatCurrency(totalIfood);
        }

        function filterVendas() {
            renderVendasList();
            updateVendasResumo();
        }

        function openVendaModal() {
            if (receitas.length === 0) {
                toast.error('Cadastre receitas primeiro para registrar vendas');
                return;
            }
            
            document.getElementById('venda-form').reset();
            document.getElementById('venda-data').value = getCurrentDate();
            
            // Reset items
            document.getElementById('venda-itens').innerHTML = '';
            addVendaItem();
            
            updateVendaResumo();
            modal.show('venda-modal');
        }

        function closeVendaModal() {
            modal.hide('venda-modal');
        }

        function addVendaItem() {
            const container = document.getElementById('venda-itens');
            const div = document.createElement('div');
            div.className = 'venda-item';
            div.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;';
            
            div.innerHTML = `
                <select class="form-control" onchange="updateItemPreco(this)">
                    <option value="">Selecione a pizza</option>
                    ${getReceitasOptions()}
                </select>
                <input type="number" class="form-control" placeholder="Qtd" min="1" value="1" onchange="updateItemSubtotal(this)">
                <input type="number" class="form-control" placeholder="Pre√ßo Unit." step="0.01" min="0" onchange="updateItemSubtotal(this)">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeVendaItem(this)">üóëÔ∏è</button>
            `;
            
            container.appendChild(div);
        }

        function removeVendaItem(button) {
            if (document.querySelectorAll('.venda-item').length > 1) {
                button.parentElement.remove();
                updateVendaResumo();
            }
        }

        function getReceitasOptions() {
            let options = '';
            receitas.forEach(receita => {
                if (receita.status === 'ativa' && receita.tamanhos) {
                    Object.keys(receita.tamanhos).forEach(tamanho => {
                        if (receita.tamanhos[tamanho].custoTotal > 0) {
                            const label = `${receita.nome} - ${tamanho.charAt(0).toUpperCase() + tamanho.slice(1)}`;
                            options += `<option value="${receita.id}|${tamanho}">${label}</option>`;
                        }
                    });
                }
            });
            return options;
        }

        function updateItemPreco(select) {
            const canal = document.getElementById('venda-canal').value;
            if (!canal || !select.value) return;
            
            const [receitaId, tamanho] = select.value.split('|');
            const receita = receitas.find(r => r.id === receitaId);
            
            if (receita && receita.tamanhos[tamanho]) {
                const custo = receita.tamanhos[tamanho].custoTotal;
                const preco = canal === 'direto' ? calcularPrecoDireto(custo) : calcularPrecoIfood(custo);
                
                const precoInput = select.parentElement.querySelector('input[placeholder="Pre√ßo Unit."]');
                precoInput.value = preco.toFixed(2);
                
                updateItemSubtotal(precoInput);
            }
        }

        function updateItemSubtotal(input) {
            updateVendaResumo();
        }

        function updateVendaPrecos() {
            const items = document.querySelectorAll('.venda-item');
            items.forEach(item => {
                const select = item.querySelector('select');
                if (select.value) {
                    updateItemPreco(select);
                }
            });
        }

        function updateVendaResumo() {
            let subtotal = 0;
            
            const items = document.querySelectorAll('.venda-item');
            items.forEach(item => {
                const quantidade = parseFloat(item.querySelector('input[placeholder="Qtd"]').value) || 0;
                const preco = parseFloat(item.querySelector('input[placeholder="Pre√ßo Unit."]').value) || 0;
                subtotal += quantidade * preco;
            });
            
            const canal = document.getElementById('venda-canal').value;
            const taxaEntrega = (canal === 'direto') ? configuracoes.taxaEntrega : 0;
            const total = subtotal + taxaEntrega;
            
            document.getElementById('venda-subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('venda-taxa-entrega').textContent = formatCurrency(taxaEntrega);
            document.getElementById('venda-total').textContent = formatCurrency(total);
        }

        function saveVenda() {
            const data = document.getElementById('venda-data').value;
            const canal = document.getElementById('venda-canal').value;
            const cliente = document.getElementById('venda-cliente').value.trim();
            const observacoes = document.getElementById('venda-observacoes').value.trim();
            
            if (!data || !canal) {
                toast.error('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            const itens = [];
            const vendaItems = document.querySelectorAll('.venda-item');
            
            vendaItems.forEach(item => {
                const select = item.querySelector('select');
                const quantidade = parseFloat(item.querySelector('input[placeholder="Qtd"]').value) || 0;
                const precoUnitario = parseFloat(item.querySelector('input[placeholder="Pre√ßo Unit."]').value) || 0;
                
                if (select.value && quantidade > 0 && precoUnitario > 0) {
                    const [receitaId, tamanho] = select.value.split('|');
                    const receita = receitas.find(r => r.id === receitaId);
                    
                    if (receita) {
                        itens.push({
                            receitaId: receitaId,
                            receitaNome: receita.nome,
                            tamanho: tamanho,
                            quantidade: quantidade,
                            precoUnitario: precoUnitario,
                            subtotal: quantidade * precoUnitario
                        });
                    }
                }
            });
            
            if (itens.length === 0) {
                toast.error('Adicione pelo menos um item √† venda');
                return;
            }
            
            const subtotal = itens.reduce((acc, item) => acc + item.subtotal, 0);
            const taxaEntrega = (canal === 'direto') ? configuracoes.taxaEntrega : 0;
            const valorTotal = subtotal + taxaEntrega;
            
            const venda = {
                id: generateId(),
                data: data,
                canal: canal,
                cliente: cliente,
                itens: itens,
                subtotal: subtotal,
                taxaEntrega: taxaEntrega,
                valorTotal: valorTotal,
                observacoes: observacoes,
                status: 'concluida',
                criadoEm: new Date().toISOString()
            };
            
            vendas.push(venda);
            storage.save('vendas', vendas);
            
            renderVendasList();
            updateVendasResumo();
            updateDashboardKPIs();
            closeVendaModal();
            
            toast.success('Venda registrada com sucesso!');
        }

        function viewVenda(id) {
            const venda = vendas.find(v => v.id === id);
            if (!venda) return;
            
            const itensHtml = venda.itens.map(item => `
                <tr>
                    <td>${item.receitaNome} (${item.tamanho})</td>
                    <td>${item.quantidade}</td>
                    <td>${formatCurrency(item.precoUnitario)}</td>
                    <td>${formatCurrency(item.subtotal)}</td>
                </tr>
            `).join('');
            
            const viewHTML = `
                <div style="max-width: 500px;">
                    <div style="margin-bottom: 20px;">
                        <p><strong>Data:</strong> ${formatDate(venda.data)}</p>
                        <p><strong>Canal:</strong> ${venda.canal === 'direto' ? 'üöö Delivery Direto' : 'üçï iFood'}</p>
                        <p><strong>Cliente:</strong> ${venda.cliente || '-'}</p>
                        <p><strong>Status:</strong> 
                            <span class="badge ${venda.status === 'concluida' ? 'badge-success' : 'badge-danger'}">
                                ${venda.status === 'concluida' ? 'Conclu√≠da' : 'Cancelada'}
                            </span>
                        </p>
                    </div>
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Qtd</th>
                                <th>Pre√ßo Unit.</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itensHtml}
                        </tbody>
                    </table>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Subtotal:</span>
                            <span>${formatCurrency(venda.subtotal)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Taxa Entrega:</span>
                            <span>${formatCurrency(venda.taxaEntrega)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1em; border-top: 1px solid #ddd; padding-top: 5px;">
                            <span>Total:</span>
                            <span>${formatCurrency(venda.valorTotal)}</span>
                        </div>
                    </div>
                    
                    ${venda.observacoes ? `
                        <div style="margin-top: 15px;">
                            <strong>Observa√ß√µes:</strong>
                            <p style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 5px;">${venda.observacoes}</p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Create and show modal
            const existingModal = document.getElementById('view-venda-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modalHTML = `
                <div class="modal show" id="view-venda-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Detalhes da Venda</h3>
                            <button class="modal-close" onclick="document.getElementById('view-venda-modal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${viewHTML}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="document.getElementById('view-venda-modal').remove()">Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function cancelVenda(id) {
            const venda = vendas.find(v => v.id === id);
            if (!venda) {
                toast.error('Venda n√£o encontrada');
                return;
            }
            
            if (venda.status === 'cancelada') {
                toast.warning('Esta venda j√° foi cancelada');
                return;
            }
            
            modal.confirm(
                `Tem certeza que deseja cancelar a venda de ${formatCurrency(venda.valorTotal)}?`,
                function() {
                    venda.status = 'cancelada';
                    storage.save('vendas', vendas);
                    renderVendasList();
                    updateVendasResumo();
                    updateDashboardKPIs();
                    toast.success('Venda cancelada com sucesso!');
                }
            );
        }

        // ========================================
        // SISTEMA DE RELAT√ìRIOS
        // ========================================
        function loadRelatorios() {
            // Set default period (last 30 days)
            const hoje = new Date();
            const umMesAtras = new Date(hoje);
            umMesAtras.setDate(hoje.getDate() - 30);
            
            document.getElementById('filter-data-inicial').value = umMesAtras.toISOString().split('T')[0];
            document.getElementById('filter-data-final').value = hoje.toISOString().split('T')[0];
            
            atualizarRelatorios();
        }

        function atualizarRelatorios() {
            const dataInicial = document.getElementById('filter-data-inicial').value;
            const dataFinal = document.getElementById('filter-data-final').value;
            
            if (!dataInicial || !dataFinal) {
                // Set default period (last 30 days)
                const hoje = new Date();
                const umMesAtras = new Date(hoje);
                umMesAtras.setDate(hoje.getDate() - 30);
                
                document.getElementById('filter-data-inicial').value = umMesAtras.toISOString().split('T')[0];
                document.getElementById('filter-data-final').value = hoje.toISOString().split('T')[0];
                
                setTimeout(atualizarRelatorios, 100);
                return;
            }
            
            const vendasPeriodo = vendas.filter(v => {
                return v.data >= dataInicial && v.data <= dataFinal && v.status === 'concluida';
            });
            
            atualizarKPIs(vendasPeriodo, dataInicial, dataFinal);
            atualizarAnaliseCanais(vendasPeriodo);
            atualizarTopProdutos(vendasPeriodo);
            atualizarGraficoVendas(vendasPeriodo, dataInicial, dataFinal);
        }

        function atualizarKPIs(vendasPeriodo, dataInicial, dataFinal) {
            const faturamento = vendasPeriodo.reduce((total, v) => total + v.valorTotal, 0);
            const vendas = vendasPeriodo.length;
            const ticketMedio = vendas > 0 ? faturamento / vendas : 0;
            
            // Calculate average margin
            let margemTotal = 0;
            let itensTotal = 0;
            
            vendasPeriodo.forEach(venda => {
                venda.itens.forEach(item => {
                    const receita = receitas.find(r => r.id === item.receitaId);
                    if (receita && receita.tamanhos[item.tamanho]) {
                        const custo = receita.tamanhos[item.tamanho].custoTotal || 0;
                        const margem = calcularMargemReal(custo, item.precoUnitario, venda.canal);
                        margemTotal += margem * item.quantidade;
                        itensTotal += item.quantidade;
                    }
                });
            });
            
            const margemMedia = itensTotal > 0 ? margemTotal / itensTotal : 0;
            
            // Calculate variations (compare with previous period)
            const diasPeriodo = Math.ceil((new Date(dataFinal) - new Date(dataInicial)) / (1000 * 60 * 60 * 24)) + 1;
            const dataInicialAnterior = new Date(dataInicial);
            dataInicialAnterior.setDate(dataInicialAnterior.getDate() - diasPeriodo);
            const dataFinalAnterior = new Date(dataInicial);
            dataFinalAnterior.setDate(dataFinalAnterior.getDate() - 1);
            
            const vendasPeriodoAnterior = vendas.filter(v => {
                return v.data >= dataInicialAnterior.toISOString().split('T')[0] && 
                       v.data <= dataFinalAnterior.toISOString().split('T')[0] && 
                       v.status === 'concluida';
            });
            
            const faturamentoAnterior = vendasPeriodoAnterior.reduce((total, v) => total + v.valorTotal, 0);
            const vendasAnterior = vendasPeriodoAnterior.length;
            const ticketMedioAnterior = vendasAnterior > 0 ? faturamentoAnterior / vendasAnterior : 0;
            
            const variacaoFaturamento = faturamentoAnterior > 0 ? ((faturamento - faturamentoAnterior) / faturamentoAnterior * 100) : 0;
            const variacaoVendas = vendasAnterior > 0 ? ((vendas - vendasAnterior) / vendasAnterior * 100) : 0;
            const variacaoTicket = ticketMedioAnterior > 0 ? ((ticketMedio - ticketMedioAnterior) / ticketMedioAnterior * 100) : 0;
            
            // Update KPIs
            document.getElementById('kpi-faturamento').textContent = formatCurrency(faturamento);
            document.getElementById('kpi-vendas').textContent = vendas;
            document.getElementById('kpi-ticket-medio').textContent = formatCurrency(ticketMedio);
            document.getElementById('kpi-margem-media').textContent = margemMedia.toFixed(1) + '%';
            
            // Update variations
            document.getElementById('kpi-faturamento-variacao').innerHTML = formatVariacao(variacaoFaturamento);
            document.getElementById('kpi-vendas-variacao').innerHTML = formatVariacao(variacaoVendas);
            document.getElementById('kpi-ticket-variacao').innerHTML = formatVariacao(variacaoTicket);
            document.getElementById('kpi-margem-variacao').innerHTML = '--';
        }

        function atualizarAnaliseCanais(vendasPeriodo) {
            const container = document.getElementById('analise-canais');
            
            if (vendasPeriodo.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Nenhuma venda no per√≠odo selecionado</p></div>';
                return;
            }
            
            const vendasDireto = vendasPeriodo.filter(v => v.canal === 'direto');
            const vendasIfood = vendasPeriodo.filter(v => v.canal === 'ifood');
            
            const faturamentoDireto = vendasDireto.reduce((total, v) => total + v.valorTotal, 0);
            const faturamentoIfood = vendasIfood.reduce((total, v) => total + v.valorTotal, 0);
            const faturamentoTotal = faturamentoDireto + faturamentoIfood;
            
            const percentualDireto = faturamentoTotal > 0 ? (faturamentoDireto / faturamentoTotal * 100) : 0;
            const percentualIfood = faturamentoTotal > 0 ? (faturamentoIfood / faturamentoTotal * 100) : 0;
            
            const ticketMedioDireto = vendasDireto.length > 0 ? faturamentoDireto / vendasDireto.length : 0;
            const ticketMedioIfood = vendasIfood.length > 0 ? faturamentoIfood / vendasIfood.length : 0;
            
            const html = `
                <div class="canal-analise">
                    <div class="canal-item">
                        <div class="canal-header">
                            <h5>üöö Delivery Direto</h5>
                            <span class="badge badge-success">${percentualDireto.toFixed(1)}%</span>
                        </div>
                        <div class="canal-stats">
                            <p><strong>Vendas:</strong> ${vendasDireto.length}</p>
                            <p><strong>Faturamento:</strong> ${formatCurrency(faturamentoDireto)}</p>
                            <p><strong>Ticket M√©dio:</strong> ${formatCurrency(ticketMedioDireto)}</p>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentualDireto}%; background: #2ecc71;


        // ===== SISTEMA DE RELAT√ìRIOS =====
        function loadRelatorios() {
            const vendas = JSON.parse(localStorage.getItem('vendas') || '[]');
            const receitas = JSON.parse(localStorage.getItem('receitas') || '[]');
            
            // Calcular KPIs
            const hoje = new Date().toDateString();
            const vendasHoje = vendas.filter(v => new Date(v.data).toDateString() === hoje);
            
            const faturamentoHoje = vendasHoje.reduce((total, venda) => {
                return total + venda.itens.reduce((subtotal, item) => subtotal + item.preco, 0);
            }, 0);
            
            const totalVendasHoje = vendasHoje.length;
            const ticketMedio = totalVendasHoje > 0 ? faturamentoHoje / totalVendasHoje : 0;
            
            // Calcular margem m√©dia
            let margemTotal = 0;
            let itensComMargem = 0;
            
            vendasHoje.forEach(venda => {
                venda.itens.forEach(item => {
                    const receita = receitas.find(r => r.nome === item.receita);
                    if (receita) {
                        const custo = calcularCustoReceita(receita, item.tamanho);
                        const margem = ((item.preco - custo) / item.preco) * 100;
                        margemTotal += margem;
                        itensComMargem++;
                    }
                });
            });
            
            const margemMedia = itensComMargem > 0 ? margemTotal / itensComMargem : 0;
            
            // Atualizar interface
            document.getElementById('kpi-faturamento').textContent = `R$ ${faturamentoHoje.toFixed(2)}`;
            document.getElementById('kpi-vendas').textContent = totalVendasHoje;
            document.getElementById('kpi-ticket').textContent = `R$ ${ticketMedio.toFixed(2)}`;
            document.getElementById('kpi-margem').textContent = `${margemMedia.toFixed(1)}%`;
            
            // Gr√°fico de vendas por canal
            const vendasDireto = vendasHoje.filter(v => v.canal === 'direto').length;
            const vendasIfood = vendasHoje.filter(v => v.canal === 'ifood').length;
            
            updateGraficoCanais(vendasDireto, vendasIfood);
            
            // Top produtos
            const produtoCount = {};
            vendasHoje.forEach(venda => {
                venda.itens.forEach(item => {
                    const key = `${item.receita} (${item.tamanho})`;
                    produtoCount[key] = (produtoCount[key] || 0) + 1;
                });
            });
            
            const topProdutos = Object.entries(produtoCount)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            updateTopProdutos(topProdutos);
        }
        
        function updateGraficoCanais(direto, ifood) {
            const total = direto + ifood;
            const percentDireto = total > 0 ? (direto / total) * 100 : 0;
            const percentIfood = total > 0 ? (ifood / total) * 100 : 0;
            
            const graficoHtml = `
                <div class="chart-bar">
                    <div class="chart-segment direto" style="width: ${percentDireto}%">
                        <span>Direto: ${direto}</span>
                    </div>
                    <div class="chart-segment ifood" style="width: ${percentIfood}%">
                        <span>iFood: ${ifood}</span>
                    </div>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color direto"></div>
                        <span>Delivery Direto (${percentDireto.toFixed(1)}%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color ifood"></div>
                        <span>iFood (${percentIfood.toFixed(1)}%)</span>
                    </div>
                </div>
            `;
            
            document.getElementById('grafico-canais').innerHTML = graficoHtml;
        }
        
        function updateTopProdutos(produtos) {
            const html = produtos.map(([produto, quantidade], index) => `
                <div class="top-produto">
                    <span class="posicao">${index + 1}¬∫</span>
                    <span class="nome">${produto}</span>
                    <span class="quantidade">${quantidade} vendas</span>
                </div>
            `).join('');
            
            document.getElementById('top-produtos').innerHTML = html || '<p>Nenhuma venda registrada hoje</p>';
        }
        
        function filtrarRelatorios(periodo) {
            // Remover classe ativa de todos os bot√µes
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            
            // Adicionar classe ativa ao bot√£o clicado
            event.target.classList.add('active');
            
            // Aqui voc√™ pode implementar a l√≥gica de filtro por per√≠odo
            // Por enquanto, vamos apenas recarregar os dados de hoje
            loadRelatorios();
            
            showToast(`Relat√≥rio filtrado: ${periodo}`, 'success');
        }
        
        function exportarRelatorios() {
            const vendas = JSON.parse(localStorage.getItem('vendas') || '[]');
            const ingredientes = JSON.parse(localStorage.getItem('ingredientes') || '[]');
            const receitas = JSON.parse(localStorage.getItem('receitas') || '[]');
            
            // Criar dados para exporta√ß√£o
            const dados = {
                vendas: vendas,
                ingredientes: ingredientes,
                receitas: receitas,
                exportadoEm: new Date().toISOString(),
                versao: '3.0.0'
            };
            
            // Converter para CSV
            let csv = 'RELAT√ìRIO DE VENDAS\n';
            csv += 'Data,Canal,Receita,Tamanho,Pre√ßo,Cliente\n';
            
            vendas.forEach(venda => {
                venda.itens.forEach(item => {
                    csv += `${venda.data},${venda.canal},${item.receita},${item.tamanho},${item.preco},${venda.cliente || 'N/A'}\n`;
                });
            });
            
            // Download do arquivo
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Pizzaria_Pro_Relatorio_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Relat√≥rio exportado com sucesso!', 'success');
        }

