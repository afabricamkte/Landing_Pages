<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - APS Sistema</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste do Sistema APS</h1>
    
    <div class="test-section">
        <h2>1. Teste de Carregamento de Scripts</h2>
        <div id="script-tests"></div>
        <button onclick="testScripts()">Testar Scripts</button>
    </div>

    <div class="test-section">
        <h2>2. Teste de Configura√ß√£o</h2>
        <div id="config-tests"></div>
        <button onclick="testConfig()">Testar Configura√ß√£o</button>
    </div>

    <div class="test-section">
        <h2>3. Teste de Utilit√°rios</h2>
        <div id="utils-tests"></div>
        <button onclick="testUtils()">Testar Utilit√°rios</button>
    </div>

    <div class="test-section">
        <h2>4. Teste de C√°lculos</h2>
        <div id="calc-tests"></div>
        <button onclick="testCalculations()">Testar C√°lculos</button>
    </div>

    <div class="test-section">
        <h2>5. Teste de Componentes</h2>
        <div id="component-tests"></div>
        <button onclick="testComponents()">Testar Componentes</button>
    </div>

    <div class="test-section">
        <h2>6. Teste de Dados Demo</h2>
        <div id="demo-tests"></div>
        <button onclick="testDemoData()">Testar Dados Demo</button>
    </div>

    <div class="test-section">
        <h2>Executar Todos os Testes</h2>
        <button onclick="runAllTests()" style="background: #28a745;">Executar Todos</button>
        <button onclick="clearResults()" style="background: #6c757d;">Limpar Resultados</button>
    </div>

    <!-- Scripts do Sistema -->
    <script src="src/config.js"></script>
    <script src="src/utils.js"></script>
    <script src="src/components.js"></script>

    <script>
        function addResult(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function testScripts() {
            const container = 'script-tests';
            document.getElementById(container).innerHTML = '';

            // Teste CONFIG
            try {
                if (typeof CONFIG !== 'undefined') {
                    addResult(container, '‚úÖ CONFIG carregado com sucesso');
                    addResult(container, `üìä Vers√£o: ${CONFIG.VERSION}`);
                } else {
                    addResult(container, '‚ùå CONFIG n√£o encontrado', 'error');
                }
            } catch (e) {
                addResult(container, `‚ùå Erro no CONFIG: ${e.message}`, 'error');
            }

            // Teste Utils
            try {
                if (typeof Utils !== 'undefined') {
                    addResult(container, '‚úÖ Utils carregado com sucesso');
                } else {
                    addResult(container, '‚ùå Utils n√£o encontrado', 'error');
                }
            } catch (e) {
                addResult(container, `‚ùå Erro no Utils: ${e.message}`, 'error');
            }

            // Teste Components
            try {
                if (typeof Components !== 'undefined') {
                    addResult(container, '‚úÖ Components carregado com sucesso');
                } else {
                    addResult(container, '‚ùå Components n√£o encontrado', 'error');
                }
            } catch (e) {
                addResult(container, `‚ùå Erro no Components: ${e.message}`, 'error');
            }
        }

        function testConfig() {
            const container = 'config-tests';
            document.getElementById(container).innerHTML = '';

            try {
                // Teste de categorias
                if (CONFIG.CATEGORIAS && CONFIG.CATEGORIAS.INGREDIENTES) {
                    addResult(container, `‚úÖ Categorias de ingredientes: ${CONFIG.CATEGORIAS.INGREDIENTES.length} itens`);
                }

                // Teste de unidades
                if (CONFIG.UNIDADES && CONFIG.UNIDADES.length > 0) {
                    addResult(container, `‚úÖ Unidades de medida: ${CONFIG.UNIDADES.join(', ')}`);
                }

                // Teste de tamanhos
                if (CONFIG.TAMANHOS && CONFIG.TAMANHOS.length > 0) {
                    addResult(container, `‚úÖ Tamanhos de pizza: ${CONFIG.TAMANHOS.join(', ')}`);
                }

                // Teste de dados exemplo
                if (CONFIG.DADOS_EXEMPLO && CONFIG.DADOS_EXEMPLO.INGREDIENTES) {
                    addResult(container, `‚úÖ Dados de exemplo: ${CONFIG.DADOS_EXEMPLO.INGREDIENTES.length} ingredientes`);
                }

                // Teste de valida√ß√£o
                const validation = validateConfig();
                if (validation.valid) {
                    addResult(container, '‚úÖ Configura√ß√£o v√°lida');
                } else {
                    addResult(container, `‚ö†Ô∏è Configura√ß√£o incompleta: ${validation.missing.join(', ')}`, 'warning');
                }

            } catch (e) {
                addResult(container, `‚ùå Erro nos testes de configura√ß√£o: ${e.message}`, 'error');
            }
        }

        function testUtils() {
            const container = 'utils-tests';
            document.getElementById(container).innerHTML = '';

            try {
                // Teste formata√ß√£o de moeda
                const moeda = Utils.formatMoeda(1234.56);
                if (moeda === 'R$ 1.234,56') {
                    addResult(container, '‚úÖ Formata√ß√£o de moeda funcionando');
                } else {
                    addResult(container, `‚ùå Formata√ß√£o de moeda incorreta: ${moeda}`, 'error');
                }

                // Teste formata√ß√£o de percentual
                const percentual = Utils.formatPercentual(35);
                if (percentual.includes('35')) {
                    addResult(container, '‚úÖ Formata√ß√£o de percentual funcionando');
                } else {
                    addResult(container, `‚ùå Formata√ß√£o de percentual incorreta: ${percentual}`, 'error');
                }

                // Teste parsing de n√∫mero
                const numero = Utils.parseNumero('1.234,56');
                if (numero === 1234.56) {
                    addResult(container, '‚úÖ Parse de n√∫mero funcionando');
                } else {
                    addResult(container, `‚ùå Parse de n√∫mero incorreto: ${numero}`, 'error');
                }

                // Teste gera√ß√£o de ID
                const id = Utils.gerarIdIngrediente();
                if (id.startsWith('ING') && id.length > 5) {
                    addResult(container, `‚úÖ Gera√ß√£o de ID funcionando: ${id}`);
                } else {
                    addResult(container, `‚ùå Gera√ß√£o de ID incorreta: ${id}`, 'error');
                }

                // Teste debounce
                if (typeof Utils.debounce === 'function') {
                    addResult(container, '‚úÖ Fun√ß√£o debounce dispon√≠vel');
                } else {
                    addResult(container, '‚ùå Fun√ß√£o debounce n√£o encontrada', 'error');
                }

            } catch (e) {
                addResult(container, `‚ùå Erro nos testes de utilit√°rios: ${e.message}`, 'error');
            }
        }

        function testCalculations() {
            const container = 'calc-tests';
            document.getElementById(container).innerHTML = '';

            try {
                // Teste c√°lculo de custo unit√°rio
                const custoUnitario = Utils.calcularCustoUnitario(45.00, 1, 95, 'kg');
                const esperado = 45.00 / (1 * 1000 * 0.95); // ‚âà 0.0474
                
                if (Math.abs(custoUnitario - esperado) < 0.001) {
                    addResult(container, `‚úÖ C√°lculo de custo unit√°rio: R$ ${custoUnitario.toFixed(4)}/g`);
                } else {
                    addResult(container, `‚ùå C√°lculo de custo unit√°rio incorreto: ${custoUnitario}`, 'error');
                }

                // Teste c√°lculo de pre√ßo de venda
                const precoVenda = Utils.calcularPrecoVenda(21.20, 35, 10.5);
                const esperadoPreco = 21.20 / (1 - 0.35 - 0.105); // ‚âà 38.90
                
                if (Math.abs(precoVenda - esperadoPreco) < 0.1) {
                    addResult(container, `‚úÖ C√°lculo de pre√ßo de venda: ${Utils.formatMoeda(precoVenda)}`);
                } else {
                    addResult(container, `‚ùå C√°lculo de pre√ßo de venda incorreto: ${precoVenda}`, 'error');
                }

                // Teste c√°lculo de margem
                const margem = Utils.calcularMargem(38.90, 21.20, 10.5);
                
                if (margem > 30 && margem < 40) {
                    addResult(container, `‚úÖ C√°lculo de margem: ${Utils.formatPercentual(margem)}`);
                } else {
                    addResult(container, `‚ùå C√°lculo de margem incorreto: ${margem}%`, 'error');
                }

                // Teste valida√ß√£o de dados
                const validacao = Utils.validarFormulario(
                    { nome: 'Mussarela', preco: 45.00, categoria: 'Queijos' },
                    { 
                        nome: { required: true, minLength: 2 },
                        preco: { required: true, min: 0.01 },
                        categoria: { required: true }
                    }
                );

                if (validacao.valido) {
                    addResult(container, '‚úÖ Valida√ß√£o de formul√°rio funcionando');
                } else {
                    addResult(container, `‚ùå Valida√ß√£o de formul√°rio com erros: ${Object.keys(validacao.erros).join(', ')}`, 'error');
                }

            } catch (e) {
                addResult(container, `‚ùå Erro nos testes de c√°lculo: ${e.message}`, 'error');
            }
        }

        function testComponents() {
            const container = 'component-tests';
            document.getElementById(container).innerHTML = '';

            try {
                // Teste toast (sem mostrar)
                if (typeof Components.showToast === 'function') {
                    addResult(container, '‚úÖ Fun√ß√£o showToast dispon√≠vel');
                } else {
                    addResult(container, '‚ùå Fun√ß√£o showToast n√£o encontrada', 'error');
                }

                // Teste modal
                if (typeof Components.showModal === 'function') {
                    addResult(container, '‚úÖ Fun√ß√£o showModal dispon√≠vel');
                } else {
                    addResult(container, '‚ùå Fun√ß√£o showModal n√£o encontrada', 'error');
                }

                // Teste cria√ß√£o de tabela
                if (typeof Components.createDataTable === 'function') {
                    addResult(container, '‚úÖ Fun√ß√£o createDataTable dispon√≠vel');
                } else {
                    addResult(container, '‚ùå Fun√ß√£o createDataTable n√£o encontrada', 'error');
                }

                // Teste valida√ß√£o de formul√°rio
                if (typeof Components.validateForm === 'function') {
                    addResult(container, '‚úÖ Fun√ß√£o validateForm dispon√≠vel');
                } else {
                    addResult(container, '‚ùå Fun√ß√£o validateForm n√£o encontrada', 'error');
                }

                // Teste formata√ß√£o de valores
                if (typeof Components.formatValue === 'function') {
                    const formatted = Components.formatValue(1234.56, 'currency');
                    addResult(container, `‚úÖ Formata√ß√£o de valores: ${formatted}`);
                } else {
                    addResult(container, '‚ùå Fun√ß√£o formatValue n√£o encontrada', 'error');
                }

            } catch (e) {
                addResult(container, `‚ùå Erro nos testes de componentes: ${e.message}`, 'error');
            }
        }

        function testDemoData() {
            const container = 'demo-tests';
            document.getElementById(container).innerHTML = '';

            try {
                // Teste dados de ingredientes
                const ingredientes = CONFIG.DADOS_EXEMPLO.INGREDIENTES;
                if (ingredientes && ingredientes.length > 0) {
                    addResult(container, `‚úÖ ${ingredientes.length} ingredientes de exemplo carregados`);
                    
                    // Teste estrutura do primeiro ingrediente
                    const primeiro = ingredientes[0];
                    const campos = ['id', 'nome', 'categoria', 'unidade', 'preco'];
                    const camposPresentes = campos.filter(campo => primeiro.hasOwnProperty(campo));
                    
                    if (camposPresentes.length === campos.length) {
                        addResult(container, '‚úÖ Estrutura de ingredientes v√°lida');
                    } else {
                        addResult(container, `‚ùå Campos faltando: ${campos.filter(c => !camposPresentes.includes(c)).join(', ')}`, 'error');
                    }
                } else {
                    addResult(container, '‚ùå Dados de ingredientes n√£o encontrados', 'error');
                }

                // Teste dados de custos fixos
                const custosFixos = CONFIG.DADOS_EXEMPLO.CUSTOS_FIXOS;
                if (custosFixos && custosFixos.length > 0) {
                    addResult(container, `‚úÖ ${custosFixos.length} custos fixos de exemplo`);
                    
                    const totalCustos = custosFixos.reduce((sum, custo) => sum + custo.valor, 0);
                    addResult(container, `üìä Total custos fixos: ${Utils.formatMoeda(totalCustos)}`);
                } else {
                    addResult(container, '‚ùå Dados de custos fixos n√£o encontrados', 'error');
                }

                // Teste dados de impostos
                const impostos = CONFIG.DADOS_EXEMPLO.IMPOSTOS_TAXAS;
                if (impostos && impostos.length > 0) {
                    addResult(container, `‚úÖ ${impostos.length} canais de venda configurados`);
                    
                    const canais = impostos.map(imp => imp.canal).join(', ');
                    addResult(container, `üìä Canais: ${canais}`);
                } else {
                    addResult(container, '‚ùå Dados de impostos n√£o encontrados', 'error');
                }

                // Teste par√¢metros
                const parametros = CONFIG.DADOS_EXEMPLO.PARAMETROS;
                if (parametros && parametros.length > 0) {
                    addResult(container, `‚úÖ ${parametros.length} par√¢metros configurados`);
                    
                    parametros.forEach(param => {
                        addResult(container, `üìä ${param.parametro}: ${param.valor}`);
                    });
                } else {
                    addResult(container, '‚ùå Par√¢metros n√£o encontrados', 'error');
                }

            } catch (e) {
                addResult(container, `‚ùå Erro nos testes de dados demo: ${e.message}`, 'error');
            }
        }

        function runAllTests() {
            clearResults();
            setTimeout(() => testScripts(), 100);
            setTimeout(() => testConfig(), 200);
            setTimeout(() => testUtils(), 300);
            setTimeout(() => testCalculations(), 400);
            setTimeout(() => testComponents(), 500);
            setTimeout(() => testDemoData(), 600);
        }

        function clearResults() {
            const containers = ['script-tests', 'config-tests', 'utils-tests', 'calc-tests', 'component-tests', 'demo-tests'];
            containers.forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
        }

        // Executa testes b√°sicos ao carregar
        window.addEventListener('load', () => {
            setTimeout(testScripts, 500);
        });
    </script>
</body>
</html>
