<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NPS Eventos ‚Äî Sistema de Pesquisas Profissional</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg: #0b0c0f;
      --card: #12141a;
      --muted: #1a1f2a;
      --text: #e6e8f0;
      --subtext: #aab0c0;
      --brand: #6366f1;
      --ok: #16c67a;
      --warn: #f59e0b;
      --bad: #ef4444;
      --border: #2a2f3a;
      --focus: 0 0 0 3px rgba(99,102,241,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 15px/1.5 'Inter', system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans";
      color:var(--text); background:linear-gradient(135deg,#0b0c0f 0%,#1a1f2a 100%); background-attachment:fixed;
    }
    a{color:var(--brand); text-decoration:none; transition: all 0.2s ease;}
    a:hover{text-decoration:underline; color: #8b5cf6;}
    header.app{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(10px);
      background:rgba(11,12,15,.85); border-bottom:1px solid var(--border);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .container{max-width:960px; margin:0 auto; padding:16px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .spacer{flex:1}
    .card{
      background:linear-gradient(145deg, rgba(255,255,255,.05), rgba(255,255,255,.01));
      border:1px solid var(--border); border-radius:16px; padding:24px;
      box-shadow: 0 10px 30px rgba(0,0,0,.3), 0 1px 8px rgba(0,0,0,.2);
      transition: all 0.3s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(0,0,0,.4), 0 5px 15px rgba(0,0,0,.3);
    }
    .notice{background:#0a1320;border:1px solid #14223b;color:#c9d8ff;padding:12px 16px;border-radius:12px; margin: 16px 0;}
    .muted{color:var(--subtext)}
    h1,h2,h3{margin:.2em 0 .6em; font-weight: 600;}
    h1{font-size:2rem; background: linear-gradient(135deg, #6366f1, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;} 
    h2{font-size:1.4rem} 
    h3{font-size:1.1rem}
    .btn{
      appearance:none; border:1px solid var(--border); background:var(--card); color:var(--text);
      padding:12px 18px; border-radius:12px; cursor:pointer; transition: all 0.2s ease;
      font-weight: 500; position: relative; overflow: hidden;
    }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .btn.primary{
      border-color:transparent; 
      background:linear-gradient(135deg, #6366f1, #8b5cf6); 
      color:#fff; font-weight:600;
    }
    .btn.primary:hover{
      background:linear-gradient(135deg, #5855eb, #7c3aed);
    }
    .btn.ghost{background:transparent}
    .btn.warn{background:var(--warn); color:#0b0c0f; border-color:transparent}
    .btn.bad{background:var(--bad); color:#fff; border-color:transparent}
    .btn.ok{background:var(--ok); color:#0b0c0f; border-color:transparent}
    .btn.small{padding:8px 12px; font-size:.9rem}
    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .status{padding:6px 12px; border-radius:999px; font-weight:600; font-size: 0.85rem;}
    .status.draft{background:#374151;color:#fff}
    .status.active{background:#10b981;color:#0b0c0f}
    .status.closed{background:#6b7280;color:#fff}
    .table{width:100%; border-collapse:collapse; border-radius: 12px; overflow: hidden;}
    .table th,.table td{border-bottom:1px solid var(--border); padding:16px; text-align:left}
    .table th{background: var(--muted); font-weight: 600;}
    input[type="text"], input[type="email"], input[type="url"], input[type="date"], input[type="color"], select, textarea{
      width:100%; padding:12px 16px; border-radius:12px; border:1px solid var(--border); 
      background:var(--card); color:var(--text); transition: all 0.2s ease;
    }
    input:focus, select:focus, textarea:focus{
      outline: none; border-color: var(--brand); box-shadow: var(--focus);
    }
    textarea{min-height:90px; resize:vertical}

    /* Quiz Styles */
    .quiz-wrap{max-width:780px; margin:0 auto}
    .progress{
      height:12px; background:#1f2430; border-radius:999px; overflow:hidden; margin:12px 0 20px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }
    .progress > span{
      display:block; height:100%; 
      background:linear-gradient(90deg, #6366f1, #8b5cf6); 
      transition:width .4s ease;
      position: relative;
    }
    .progress > span::after{
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .qstep{display:none}
    .qstep.active{display:block; animation:fadeInUp .4s ease}
    @keyframes fadeInUp{from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)}}
    .scale{display:flex; gap:8px; flex-wrap:wrap; justify-content: center; margin: 24px 0;}
    .pill{
      padding:14px 16px; border-radius:12px; border:1px solid var(--border); 
      background:var(--card); cursor:pointer; min-width:50px; text-align:center;
      transition: all 0.2s ease; font-weight: 500;
    }
    .pill:hover{
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .pill[aria-checked="true"]{
      background:linear-gradient(135deg, #6366f1, #8b5cf6); 
      color:#fff; border-color:transparent; font-weight:700;
      box-shadow: 0 4px 15px rgba(99,102,241,0.4);
    }
    .options{display:flex; flex-direction:column; gap:12px; margin: 20px 0;}
    .chip{
      display:inline-flex; align-items:center; gap:12px; padding:12px 16px; 
      border-radius:12px; border:1px solid var(--border); background:var(--card); 
      cursor:pointer; transition: all 0.2s ease;
    }
    .chip:hover{
      background: var(--muted);
      transform: translateX(4px);
    }
    .chips{display:flex; flex-wrap:wrap; gap:10px}
    .logo{height:40px; width:auto; border-radius:10px; background:#fff; object-fit:contain}
    .kbd{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono"; 
      padding:4px 8px; border:1px solid var(--border); border-radius:8px; background:var(--card);
      font-size: 0.85rem;
    }
    .sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
    
    /* Link Section Styles */
    .link-section{
      background: linear-gradient(145deg, rgba(99,102,241,.1), rgba(139,92,246,.05));
      border: 1px solid rgba(99,102,241,.2);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
    }
    .link-row{
      display: flex;
      gap: 12px;
      align-items: center;
      margin: 12px 0;
    }
    .link-input{
      flex: 1;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";
      font-size: 0.9rem;
      background: var(--muted) !important;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 8px;
    }
    .link-label{
      font-weight: 600;
      color: var(--brand);
      min-width: 120px;
    }
    .copy-btn{
      padding: 8px 12px;
      font-size: 0.85rem;
      background: var(--brand);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .copy-btn:hover{
      background: #5855eb;
      transform: translateY(-1px);
    }
    
    @media print { 
      header.app, .no-print{display:none !important} 
      body{background:#fff; color:#000} 
      .card{box-shadow:none; border:1px solid #ddd} 
    }
    @media (max-width: 768px) {
      .container{padding: 12px;}
      .card{padding: 16px;}
      .scale{gap: 6px;}
      .pill{padding: 10px 12px; min-width: 40px;}
      .link-row{flex-direction: column; align-items: stretch;}
      .link-label{min-width: auto;}
    }
  </style>
</head>
<body>
  <header class="app">
    <div class="container row">
      <div class="row" style="gap:12px">
        <img id="brandLogo" class="logo" alt="Logo" src="" style="display:none">
        <strong id="brandTitle">NPS Eventos</strong>
        <span id="surveyBadge" class="status draft" style="display:none"></span>
      </div>
      <div class="spacer"></div>
      <nav class="toolbar">
        <button class="btn small" id="lang-pt">PT</button>
        <button class="btn small" id="lang-en">EN</button>
        <button class="btn small" id="lang-es">ES</button>
        <a href="#/admin" class="btn small">Admin</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Home Page -->
    <div id="page-home" class="page">
      <div class="quiz-wrap">
        <div class="card" style="text-align:center; margin-top: 40px;">
          <h1>Sistema de Pesquisas NPS</h1>
          <p class="muted" style="font-size: 1.1rem; margin: 20px 0;">Colete feedback valioso dos seus eventos com pesquisas profissionais de Net Promoter Score.</p>
          
          <div style="margin: 40px 0;">
            <a href="#/admin" class="btn primary" style="font-size: 1.1rem; padding: 16px 32px;">
              Acessar √Årea Administrativa
            </a>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 40px; text-align: left;">
            <div style="padding: 20px; background: var(--muted); border-radius: 12px;">
              <h3>üìä Pesquisas Inteligentes</h3>
              <p class="muted">Crie pesquisas NPS completas com perguntas personalizadas e m√∫ltiplos idiomas.</p>
            </div>
            <div style="padding: 20px; background: var(--muted); border-radius: 12px;">
              <h3>üì± Interface Responsiva</h3>
              <p class="muted">Experi√™ncia otimizada para desktop e mobile com design moderno.</p>
            </div>
            <div style="padding: 20px; background: var(--muted); border-radius: 12px;">
              <h3>üìà Relat√≥rios Detalhados</h3>
              <p class="muted">An√°lise completa dos resultados com m√©tricas NPS e exporta√ß√£o de dados.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Login -->
    <div id="page-admin-login" class="page" style="display:none">
      <div class="quiz-wrap">
        <div class="card" style="text-align:center; margin-top: 60px;">
          <h2>Acesso Administrativo</h2>
          <p class="muted">Defina sua senha de administrador</p>
          
          <div style="max-width: 300px; margin: 30px auto;">
            <label for="admin-password" class="sr-only">Senha</label>
            <input type="password" id="admin-password" placeholder="Senha" style="margin-bottom: 20px;">
            <button class="btn primary" id="admin-login-btn" style="width: 100%;">Entrar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="page-admin" class="page" style="display:none">
      <div class="row" style="margin-bottom: 30px;">
        <h1>Pesquisas</h1>
        <div class="spacer"></div>
        <div class="toolbar">
          <button class="btn primary" id="new-survey-btn">Nova Pesquisa</button>
          <button class="btn ghost" id="logout-btn">Sair</button>
        </div>
      </div>
      <p class="muted">Gerencie suas pesquisas de satisfa√ß√£o</p>

      <div class="card">
        <table class="table" id="surveys-table">
          <thead>
            <tr>
              <th>T√≠tulo</th>
              <th>Data do evento</th>
              <th>Status</th>
              <th>Respostas</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Survey Editor -->
    <div id="page-survey-editor" class="page" style="display:none">
      <div class="row" style="margin-bottom: 20px;">
        <h2>Editar Pesquisa</h2>
        <div class="spacer"></div>
        <button class="btn ghost" id="close-editor-btn">‚úï</button>
      </div>

      <div class="card">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
          <div>
            <label for="survey-title-pt">T√≠tulo (PT)</label>
            <input type="text" id="survey-title-pt" placeholder="Pesquisa de Satisfa√ß√£o do Evento">
          </div>
          <div>
            <label for="survey-title-en">T√≠tulo (EN)</label>
            <input type="text" id="survey-title-en" placeholder="Event Satisfaction Survey">
          </div>
          <div>
            <label for="survey-title-es">T√≠tulo (ES)</label>
            <input type="text" id="survey-title-es" placeholder="Encuesta de Satisfacci√≥n del Evento">
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
          <div>
            <label for="survey-date">Data do evento</label>
            <input type="date" id="survey-date">
          </div>
          <div>
            <label for="survey-color">Cor da marca</label>
            <input type="color" id="survey-color" value="#6366f1">
          </div>
          <div>
            <label for="survey-status">Status</label>
            <select id="survey-status">
              <option value="draft">Rascunho</option>
              <option value="active">Ativa</option>
              <option value="closed">Encerrada</option>
            </select>
          </div>
        </div>

        <div class="toolbar" style="margin-bottom: 30px;">
          <button class="btn primary" id="save-survey-btn">Salvar</button>
          <a href="#" id="preview-survey-btn" class="btn">Visualizar</a>
          <a href="#" id="report-survey-btn" class="btn">Relat√≥rio</a>
        </div>

        <!-- Links Section -->
        <div class="link-section">
          <h3 style="margin-bottom: 20px; color: var(--brand);">üîó Links da Pesquisa</h3>
          <p class="muted" style="margin-bottom: 20px;">Use estes links para compartilhar com os participantes</p>
          
          <div class="link-row">
            <span class="link-label">üöÄ Link de Produ√ß√£o:</span>
            <input type="text" class="link-input" id="production-link" readonly>
            <button class="copy-btn" onclick="copyToClipboard('production-link')">Copiar</button>
          </div>
          
          <div class="link-row">
            <span class="link-label">üß™ Link de Teste:</span>
            <input type="text" class="link-input" id="test-link" readonly>
            <button class="copy-btn" onclick="copyToClipboard('test-link')">Copiar</button>
          </div>
          
          <div class="notice">
            <strong>üí° Dica:</strong> Use o <strong>Link de Teste</strong> para testar a pesquisa antes de enviar aos participantes. 
            O <strong>Link de Produ√ß√£o</strong> s√≥ funciona quando o status est√° "Ativa".
          </div>
        </div>
      </div>
    </div>

    <!-- Survey Quiz -->
    <div id="page-survey" class="page" style="display:none">
      <div class="quiz-wrap">
        <div class="card">
          <div id="survey-header">
            <h2 id="survey-title">Pesquisa de Satisfa√ß√£o do Evento</h2>
            <div class="progress">
              <span id="progress-bar" style="width:0%"></span>
            </div>
            <p class="muted" id="question-counter">Pergunta 1 de 6</p>
          </div>

          <!-- Question Steps -->
          <div class="qstep active" id="step-nps">
            <h3 id="nps-question">Em uma escala de 0 a 10, o quanto voc√™ recomendaria este evento a um amigo ou colega?</h3>
            <p class="muted">0 = n√£o recomendaria; 10 = recomendaria com certeza</p>
            <div class="scale" id="nps-scale">
              <button class="pill" data-value="0">0</button>
              <button class="pill" data-value="1">1</button>
              <button class="pill" data-value="2">2</button>
              <button class="pill" data-value="3">3</button>
              <button class="pill" data-value="4">4</button>
              <button class="pill" data-value="5">5</button>
              <button class="pill" data-value="6">6</button>
              <button class="pill" data-value="7">7</button>
              <button class="pill" data-value="8">8</button>
              <button class="pill" data-value="9">9</button>
              <button class="pill" data-value="10">10</button>
            </div>
          </div>

          <div class="qstep" id="step-organization">
            <h3>Organiza√ß√£o geral do evento</h3>
            <p class="muted">1 = muito ruim; 5 = excelente</p>
            <div class="scale">
              <button class="pill" data-value="1">1</button>
              <button class="pill" data-value="2">2</button>
              <button class="pill" data-value="3">3</button>
              <button class="pill" data-value="4">4</button>
              <button class="pill" data-value="5">5</button>
            </div>
          </div>

          <!-- Navigation -->
          <div class="toolbar" style="margin-top: 30px; justify-content: space-between;">
            <button class="btn ghost" id="prev-btn" style="display:none">Anterior</button>
            <div class="spacer"></div>
            <button class="btn primary" id="next-btn">Pr√≥ximo</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Page -->
    <div id="page-error" class="page" style="display:none">
      <div class="quiz-wrap">
        <div class="card" style="text-align:center; margin-top: 60px;">
          <div style="font-size: 4rem; margin-bottom: 20px;">‚ö†Ô∏è</div>
          <h2>Link inv√°lido ou pesquisa inativa.</h2>
          <p class="muted">A pesquisa pode estar inativa ou o link pode estar incorreto.</p>
          <a href="#/" class="btn primary" style="margin-top: 20px;">‚Üê Voltar ao in√≠cio</a>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Global State
    let state = {
      currentSurvey: null,
      currentStep: 0,
      responses: {},
      isTestMode: false
    };

    // Storage key
    const STORAGE_KEY = 'nps_quiz_state_v4';

    // Load state from localStorage
    function loadState() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          const data = JSON.parse(stored);
          return {
            surveys: data.surveys || {},
            adminPassword: data.adminPassword || null
          };
        }
      } catch (e) {
        console.error('Error loading state:', e);
      }
      return { surveys: {}, adminPassword: null };
    }

    // Save state to localStorage
    function saveState(data) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.error('Error saving state:', e);
      }
    }

    // Generate unique ID with proper format
    function generateId() {
      const timestamp = Date.now().toString(36);
      const random = Math.random().toString(36).substr(2, 8);
      return `srv_${timestamp}${random}`.substr(0, 16);
    }

    // Copy to clipboard function
    function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      element.select();
      element.setSelectionRange(0, 99999);
      document.execCommand('copy');
      
      // Show feedback
      const btn = element.nextElementSibling;
      const originalText = btn.textContent;
      btn.textContent = 'Copiado!';
      btn.style.background = '#16c67a';
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
      }, 2000);
    }

    // Generate survey links
    function generateSurveyLinks(surveyId) {
      const baseUrl = window.location.origin + window.location.pathname;
      return {
        production: `${baseUrl}#/s/${surveyId}?lang=pt`,
        test: `${baseUrl}#/test/${surveyId}?lang=pt`
      };
    }

    // Router
    function route() {
      const hash = window.location.hash || '#/';
      const [, path, param] = hash.match(/^#\/([^\/]*)\/?(.*)$/) || [];
      
      // Hide all pages
      document.querySelectorAll('.page').forEach(page => {
        page.style.display = 'none';
      });

      console.log('Routing to:', path, param);

      switch (path) {
        case '':
        case 'home':
          document.getElementById('page-home').style.display = 'block';
          break;
          
        case 'admin':
          if (param && param.startsWith('edit=')) {
            const surveyId = param.replace('edit=', '');
            showSurveyEditor(surveyId);
          } else {
            showAdminPage();
          }
          break;
          
        case 's':
          state.isTestMode = false;
          showSurvey(param);
          break;
          
        case 'test':
          state.isTestMode = true;
          showSurvey(param);
          break;
          
        default:
          document.getElementById('page-error').style.display = 'block';
      }
    }

    // Show admin page
    function showAdminPage() {
      const data = loadState();
      
      if (!data.adminPassword) {
        document.getElementById('page-admin-login').style.display = 'block';
        return;
      }
      
      document.getElementById('page-admin').style.display = 'block';
      renderSurveysTable();
    }

    // Show survey editor
    function showSurveyEditor(surveyId) {
      const data = loadState();
      
      if (!data.adminPassword) {
        window.location.hash = '#/admin';
        return;
      }
      
      document.getElementById('page-survey-editor').style.display = 'block';
      
      if (surveyId && data.surveys[surveyId]) {
        loadSurveyIntoEditor(data.surveys[surveyId], surveyId);
      } else {
        // New survey
        const newId = generateId();
        const newSurvey = {
          id: newId,
          title: {
            pt: 'Pesquisa de Satisfa√ß√£o do Evento',
            en: 'Event Satisfaction Survey',
            es: 'Encuesta de Satisfacci√≥n del Evento'
          },
          eventDate: new Date().toISOString().split('T')[0],
          brandColor: '#6366f1',
          status: 'draft',
          responses: []
        };
        
        data.surveys[newId] = newSurvey;
        saveState(data);
        loadSurveyIntoEditor(newSurvey, newId);
        
        // Update URL
        window.history.replaceState(null, '', `#/admin?edit=${newId}`);
      }
    }

    // Load survey into editor
    function loadSurveyIntoEditor(survey, surveyId) {
      document.getElementById('survey-title-pt').value = survey.title.pt || '';
      document.getElementById('survey-title-en').value = survey.title.en || '';
      document.getElementById('survey-title-es').value = survey.title.es || '';
      document.getElementById('survey-date').value = survey.eventDate || '';
      document.getElementById('survey-color').value = survey.brandColor || '#6366f1';
      document.getElementById('survey-status').value = survey.status || 'draft';
      
      // Generate and display links
      const links = generateSurveyLinks(surveyId);
      document.getElementById('production-link').value = links.production;
      document.getElementById('test-link').value = links.test;
      
      // Update preview and report links
      document.getElementById('preview-survey-btn').href = links.test;
      document.getElementById('report-survey-btn').href = `#/admin/report/${surveyId}`;
      
      // Store current survey ID for saving
      state.currentEditingSurvey = surveyId;
    }

    // Show survey
    function showSurvey(param) {
      const [surveyId] = param.split('?');
      const data = loadState();
      const survey = data.surveys[surveyId];
      
      console.log('Loading survey:', surveyId, survey);
      
      if (!survey) {
        console.log('Survey not found:', surveyId);
        document.getElementById('page-error').style.display = 'block';
        return;
      }
      
      // Check if survey is active (unless in test mode)
      if (!state.isTestMode && survey.status !== 'active') {
        console.log('Survey not active:', survey.status);
        document.getElementById('page-error').style.display = 'block';
        return;
      }
      
      state.currentSurvey = survey;
      state.currentStep = 0;
      state.responses = {};
      
      document.getElementById('page-survey').style.display = 'block';
      document.getElementById('survey-title').textContent = survey.title.pt || 'Pesquisa de Satisfa√ß√£o';
      
      // Apply brand color
      if (survey.brandColor) {
        document.documentElement.style.setProperty('--brand', survey.brandColor);
      }
      
      updateQuizProgress();
    }

    // Render surveys table
    function renderSurveysTable() {
      const data = loadState();
      const tbody = document.querySelector('#surveys-table tbody');
      tbody.innerHTML = '';
      
      Object.entries(data.surveys).forEach(([id, survey]) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${survey.title.pt || 'Sem t√≠tulo'}</td>
          <td>${survey.eventDate || '-'}</td>
          <td><span class="status ${survey.status}">${getStatusText(survey.status)}</span></td>
          <td>${survey.responses ? survey.responses.length : 0}</td>
          <td>
            <div class="toolbar">
              <button class="btn small" onclick="editSurvey('${id}')">Editar</button>
              <a href="#/admin/report/${id}" class="btn small">Relat√≥rio</a>
              <a href="#/test/${id}" class="btn small">Visualizar</a>
              <button class="btn small" onclick="duplicateSurvey('${id}')">Duplicar</button>
              <button class="btn small bad" onclick="deleteSurvey('${id}')">Excluir</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Get status text
    function getStatusText(status) {
      const texts = {
        draft: 'Rascunho',
        active: 'Ativa',
        closed: 'Encerrada'
      };
      return texts[status] || status;
    }

    // Edit survey
    function editSurvey(surveyId) {
      window.location.hash = `#/admin?edit=${surveyId}`;
    }

    // Duplicate survey
    function duplicateSurvey(surveyId) {
      const data = loadState();
      const original = data.surveys[surveyId];
      if (!original) return;
      
      const newId = generateId();
      const duplicate = {
        ...original,
        id: newId,
        title: {
          pt: original.title.pt + ' (C√≥pia)',
          en: original.title.en + ' (Copy)',
          es: original.title.es + ' (Copia)'
        },
        status: 'draft',
        responses: []
      };
      
      data.surveys[newId] = duplicate;
      saveState(data);
      renderSurveysTable();
    }

    // Delete survey
    function deleteSurvey(surveyId) {
      if (!confirm('Tem certeza que deseja excluir esta pesquisa?')) return;
      
      const data = loadState();
      delete data.surveys[surveyId];
      saveState(data);
      renderSurveysTable();
    }

    // Update quiz progress
    function updateQuizProgress() {
      const totalSteps = 6; // Adjust based on your questions
      const progress = ((state.currentStep + 1) / totalSteps) * 100;
      document.getElementById('progress-bar').style.width = progress + '%';
      document.getElementById('question-counter').textContent = `Pergunta ${state.currentStep + 1} de ${totalSteps}`;
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Admin login
      document.getElementById('admin-login-btn').addEventListener('click', function() {
        const password = document.getElementById('admin-password').value;
        if (password) {
          const data = loadState();
          data.adminPassword = password;
          saveState(data);
          showAdminPage();
        }
      });

      // New survey button
      document.getElementById('new-survey-btn').addEventListener('click', function() {
        window.location.hash = '#/admin?edit=new';
      });

      // Logout button
      document.getElementById('logout-btn').addEventListener('click', function() {
        const data = loadState();
        data.adminPassword = null;
        saveState(data);
        window.location.hash = '#/admin';
      });

      // Close editor button
      document.getElementById('close-editor-btn').addEventListener('click', function() {
        window.location.hash = '#/admin';
      });

      // Save survey button
      document.getElementById('save-survey-btn').addEventListener('click', function() {
        const data = loadState();
        const surveyId = state.currentEditingSurvey;
        
        if (!surveyId) return;
        
        const survey = data.surveys[surveyId] || {};
        survey.title = {
          pt: document.getElementById('survey-title-pt').value,
          en: document.getElementById('survey-title-en').value,
          es: document.getElementById('survey-title-es').value
        };
        survey.eventDate = document.getElementById('survey-date').value;
        survey.brandColor = document.getElementById('survey-color').value;
        survey.status = document.getElementById('survey-status').value;
        
        data.surveys[surveyId] = survey;
        saveState(data);
        
        // Show success message
        alert('Pesquisa salva com sucesso!');
        
        // Regenerate links in case status changed
        const links = generateSurveyLinks(surveyId);
        document.getElementById('production-link').value = links.production;
        document.getElementById('test-link').value = links.test;
      });

      // NPS scale buttons
      document.querySelectorAll('#nps-scale .pill').forEach(button => {
        button.addEventListener('click', function() {
          // Remove active state from all buttons
          document.querySelectorAll('#nps-scale .pill').forEach(btn => {
            btn.setAttribute('aria-checked', 'false');
          });
          
          // Set active state on clicked button
          this.setAttribute('aria-checked', 'true');
          state.responses.nps = parseInt(this.dataset.value);
        });
      });

      // Next button
      document.getElementById('next-btn').addEventListener('click', function() {
        // Handle quiz navigation logic here
        console.log('Next clicked, responses:', state.responses);
      });

      // Initialize router
      window.addEventListener('hashchange', route);
      route();
    });
  </script>
</body>
</html>

